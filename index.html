<!DOCTYPE html>
<html>
  <head>
    <title>pv - JavaScript protein viewer</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <script src='js/jquery-2.0.2.min.js'></script>
    <script src='js/gl-matrix.js'></script>
    <script src='js/pv.js'></script>
    <style>
    body {
      font-family: Monospace;
      background-color: #fff;/*#f0f0f0;*/
      margin: 0px;
      overflow: hidden;
    }
    #gl {
      float: left;
    }
    #inspector {
      float : right;
      background-color:#eee;
      padding:10px;
    }

    #inspector ul {
      padding:0px;
    }

    #inspector ul li {
      list-style:none;
      cursor: pointer;
      color:#660000
    }
    #inspector ul li:hover {
      color:#662200;
    }
    </style>
    </head>
<body>
  <div id=gl>
  </div>
  <div id=inspector>
    <ul>
      <li id=preset>Preset</li>
      <li id=cartoon>Cartoon</li>
      <li id=tube>Tube</li>
      <li id=lines>Lines</li>
      <li id=line-trace>Line Trace</li>
      <li id=sline>Smooth Line Trace</li>
      <li id=trace>Trace</li>
    </ul>
  </div>
  <script type='x-shader/x-fragment' id='shader-fs'>
    precision mediump float;

    varying vec3 vert_color;
    varying vec3 vert_normal;
    uniform float fog_near;
    uniform float fog_far;
    uniform vec3 fog_color;

    void main(void) {
      float dp = dot(vert_normal, vec3(0.0, 0.0, 1.0));
      float hemi = max(0.0, dp)*0.5+0.5;
      gl_FragColor = vec4(vert_color*hemi, 1.0);
      float depth = gl_FragCoord.z / gl_FragCoord.w;
      float fog_factor = smoothstep(fog_near, fog_far, depth);
      gl_FragColor = mix(gl_FragColor, vec4(fog_color, gl_FragColor.w), 
                         fog_factor);
    }

  </script>
  <script type='x-shader/x-vertex' id='shader-vs'>
    attribute vec3 attr_pos;
    attribute vec3 attr_color;
    attribute vec3 attr_normal;

    uniform mat4 projection_mat;
    uniform mat4 modelview_mat;
    varying vec3 vert_color;
    varying vec3 vert_normal;
    void main(void) {
      gl_Position = projection_mat * modelview_mat * vec4(attr_pos, 1.0);
      vec4 n = (modelview_mat * vec4(attr_normal, 0.0));
      vert_normal = n.xyz;
      vert_color = attr_color;
    }
  </script>
  <script>
    var pv = pv.Viewer(document.getElementById('gl'), 
                       { quality : 'medium' });
    var mol;
    function lines() {
      pv.clear();
      mol.lines();
    }
    function cartoon() {
      pv.clear();
      mol.cartoon();
    }
    function line_trace() {
      pv.clear();
      mol.line_trace();
    }
    function sline() {
      pv.clear();
      mol.sline();
    }

    function tube() {
      pv.clear();
      mol.tube();
    }

    function trace() {
      pv.clear();
      mol.trace();
    }
    function preset() {
      pv.clear();
      var ligand = mol.select('ligand');
      mol.cartoon();
      ligand.spheres();
    }

    $('#cartoon').click(cartoon);
    $('#line-trace').click(line_trace);
    $('#preset').click(preset);
    $('#lines').click(lines);
    $('#trace').click(trace);
    $('#sline').click(sline);
    $('#tube').click(tube);

    function on_ready() {
      $.ajax({ url : 'pdbs/1ake.pdb', success : function(data) {
        mol = pv.pdb(data);
        preset();
        pv.center_on(mol);
      }});
    }
    document.addEventListener('DOMContentLoaded', on_ready);
  </script>
</body>
</html>
