function AtomVertexAssoc(a,b){this._structure=a,this._assocs=[],this._callBeginEnd=b}function TraceVertexAssoc(a,b,c){this._structure=a,this._assocs=[],this._callBeginEnd=c,this._interpolation=b||1,this._perResidueColors={}}function BackboneTrace(){this._trace=[]}function TraceSubset(a,b,c,d){this._fullTrace=a,this._fullTraceBegin=b,this._fullTraceEnd=c,this._trace=d,this._isNTerminal=0===this._fullTraceBegin,this._isCTerminal=this._fullTrace.length()===this._fullTraceEnd;var e=this._fullTraceEnd-this._fullTraceBegin;this._isCTerminal||++e,this._isNTerminal||(++e,this._fullTraceBegin-=1),this._length=e}!function(a){"use strict";var b={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(b.exports={},define(function(){return b.exports})):b.exports="undefined"!=typeof window?window:a:b.exports=exports,function(a){if(!b)var b=1e-6;if(!c)var c="undefined"!=typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var e={};e.setMatrixArrayType=function(a){c=a},"undefined"!=typeof a&&(a.glMatrix=e);var f={};f.create=function(){var a=new c(2);return a[0]=0,a[1]=0,a},f.clone=function(a){var b=new c(2);return b[0]=a[0],b[1]=a[1],b},f.fromValues=function(a,b){var d=new c(2);return d[0]=a,d[1]=b,d},f.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},f.set=function(a,b,c){return a[0]=b,a[1]=c,a},f.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},f.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},f.sub=f.subtract,f.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},f.mul=f.multiply,f.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},f.div=f.divide,f.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},f.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},f.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},f.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},f.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},f.dist=f.distance,f.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},f.sqrDist=f.squaredDistance,f.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},f.len=f.length,f.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},f.sqrLen=f.squaredLength,f.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},f.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},f.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},f.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},f.random=function(a,b){b=b||1;var c=2*d()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},f.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},f.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},f.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},f.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},f.forEach=function(){var a=f.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),f.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof a&&(a.vec2=f);var g={};g.create=function(){var a=new c(3);return a[0]=0,a[1]=0,a[2]=0,a},g.clone=function(a){var b=new c(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},g.fromValues=function(a,b,d){var e=new c(3);return e[0]=a,e[1]=b,e[2]=d,e},g.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},g.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},g.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},g.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},g.sub=g.subtract,g.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},g.mul=g.multiply,g.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},g.div=g.divide,g.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},g.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},g.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},g.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},g.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},g.dist=g.distance,g.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},g.sqrDist=g.squaredDistance,g.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},g.len=g.length,g.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},g.sqrLen=g.squaredLength,g.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},g.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},g.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},g.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},g.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},g.random=function(a,b){b=b||1;var c=2*d()*Math.PI,e=2*d()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},g.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12],a[1]=c[1]*d+c[5]*e+c[9]*f+c[13],a[2]=c[2]*d+c[6]*e+c[10]*f+c[14],a},g.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},g.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},g.forEach=function(){var a=g.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),g.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},"undefined"!=typeof a&&(a.vec3=g);var h={};h.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},h.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},h.fromValues=function(a,b,d,e){var f=new c(4);return f[0]=a,f[1]=b,f[2]=d,f[3]=e,f},h.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},h.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},h.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},h.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},h.sub=h.subtract,h.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},h.mul=h.multiply,h.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},h.div=h.divide,h.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},h.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},h.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},h.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},h.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},h.dist=h.distance,h.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},h.sqrDist=h.squaredDistance,h.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},h.len=h.length,h.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},h.sqrLen=h.squaredLength,h.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},h.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=b[0]*g,a[1]=b[1]*g,a[2]=b[2]*g,a[3]=b[3]*g),a},h.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},h.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},h.random=function(a,b){return b=b||1,a[0]=d(),a[1]=d(),a[2]=d(),a[3]=d(),h.normalize(a,a),h.scale(a,a,b),a},h.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},h.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},h.forEach=function(){var a=h.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),h.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.vec4=h);var i={};i.create=function(){var a=new c(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},i.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},i.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},i.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},i.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},i.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},i.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},i.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},i.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+e*j,a[1]=d*i+e*k,a[2]=f*h+g*j,a[3]=f*i+g*k,a},i.mul=i.multiply,i.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=d*-h+e*i,a[2]=f*i+g*h,a[3]=f*-h+g*i,a},i.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*i,a[2]=f*h,a[3]=g*i,a},i.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.mat2=i);var j={};j.create=function(){var a=new c(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},j.clone=function(a){var b=new c(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},j.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},j.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},j.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+e*l,a[1]=d*k+e*m,a[2]=f*j+g*l,a[3]=f*k+g*m,a[4]=j*h+l*i+n,a[5]=k*h+m*i+o,a},j.mul=j.multiply,j.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+e*j,a[1]=-d*j+e*k,a[2]=f*k+g*j,a[3]=-f*j+k*g,a[4]=k*h+j*i,a[5]=k*i-j*h,a},j.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=b[0]*d,a[1]=b[1]*e,a[2]=b[2]*d,a[3]=b[3]*e,a[4]=b[4]*d,a[5]=b[5]*e,a},j.translate=function(a,b,c){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4]+c[0],a[5]=b[5]+c[1],a},j.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},"undefined"!=typeof a&&(a.mat2d=j);var k={};k.create=function(){var a=new c(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},k.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},k.clone=function(a){var b=new c(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},k.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},k.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},k.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},k.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},k.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},k.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},k.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},k.mul=k.multiply,k.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},k.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},k.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},k.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},k.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[3]=k+r,a[6]=l-q,a[1]=k-r,a[4]=1-(j+o),a[7]=n+p,a[2]=l+q,a[5]=n-p,a[8]=1-(j+m),a},k.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},k.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},"undefined"!=typeof a&&(a.mat3=k);var l={};l.create=function(){var a=new c(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.clone=function(a){var b=new c(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},l.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},l.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},l.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},l.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},l.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},l.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},l.mul=l.multiply,l.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},l.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},l.rotate=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<b?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=c[0],j=c[1],k=c[2],l=c[3],m=c[4],n=c[5],o=c[6],p=c[7],q=c[8],r=c[9],s=c[10],t=c[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a)},l.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},l.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},l.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},l.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},l.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[1]=k+r,a[2]=l-q,a[3]=0,a[4]=k-r,a[5]=1-(j+o),a[6]=n+p,a[7]=0,a[8]=l+q,a[9]=n-p,a[10]=1-(j+m),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*g*f*j,a[15]=0,a},l.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},l.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},l.lookAt=function(a,c,d,e){var f,g,h,i,j,k,m,n,o,p,q=c[0],r=c[1],s=c[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];return Math.abs(q-w)<b&&Math.abs(r-x)<b&&Math.abs(s-y)<b?l.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,f=u*o-v*n,g=v*m-t*o,h=t*n-u*m,p=Math.sqrt(f*f+g*g+h*h),p?(p=1/p,f*=p,g*=p,h*=p):(f=0,g=0,h=0),i=n*h-o*g,j=o*f-m*h,k=m*g-n*f,p=Math.sqrt(i*i+j*j+k*k),p?(p=1/p,i*=p,j*=p,k*=p):(i=0,j=0,k=0),a[0]=f,a[1]=i,a[2]=m,a[3]=0,a[4]=g,a[5]=j,a[6]=n,a[7]=0,a[8]=h,a[9]=k,a[10]=o,a[11]=0,a[12]=-(f*q+g*r+h*s),a[13]=-(i*q+j*r+k*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},l.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},"undefined"!=typeof a&&(a.mat4=l);var m={};m.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},m.rotationTo=function(){var a=g.create(),b=g.fromValues(1,0,0),c=g.fromValues(0,1,0);return function(d,e,f){var h=g.dot(e,f);return-.999999>h?(g.cross(a,b,e),g.length(a)<1e-6&&g.cross(a,c,e),g.normalize(a,a),m.setAxisAngle(d,a,Math.PI),d):h>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(g.cross(a,e,f),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+h,m.normalize(d,d))}}(),m.setAxes=function(){var a=k.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=c[0],a[5]=c[1],a[8]=c[2],m.normalize(b,m.fromMat3(b,a))}}(),m.clone=h.clone,m.fromValues=h.fromValues,m.copy=h.copy,m.set=h.set,m.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},m.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},m.add=h.add,m.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},m.mul=m.multiply,m.scale=h.scale,m.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},m.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},m.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},m.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},m.dot=h.dot,m.lerp=h.lerp,m.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},m.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},m.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},m.length=h.length,m.len=m.length,m.squaredLength=h.squaredLength,m.sqrLen=m.squaredLength,m.normalize=h.normalize,m.fromMat3=function(){var a="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(b,c){var d,e=c[0]+c[4]+c[8];if(e>0)d=Math.sqrt(e+1),b[3]=.5*d,d=.5/d,b[0]=(c[7]-c[5])*d,b[1]=(c[2]-c[6])*d,b[2]=(c[3]-c[1])*d;else{var f=0;c[4]>c[0]&&(f=1),c[8]>c[3*f+f]&&(f=2);var g=a[f],h=a[g];d=Math.sqrt(c[3*f+f]-c[3*g+g]-c[3*h+h]+1),b[f]=.5*d,d=.5/d,b[3]=(c[3*h+g]-c[3*g+h])*d,b[g]=(c[3*g+f]+c[3*f+g])*d,b[h]=(c[3*h+f]+c[3*f+h])*d}return b}}(),m.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.quat=m)}(b.exports)}(this),function(a){return"undefined"===window.console&&(window.console={},window.console.log=function(){},window.console.error=function(){},window.console.time=function(){},window.console.timeEnd=function(){},window.console.info=function(){}),a.derive=function(a,b){for(var c in b.prototype)a.prototype[c]=b.prototype[c]},!0}(this);var geom=function(){"use strict";function a(a,b,c,d){d=d||!1,c=c||.5;var f=null;f=d?new Float32Array(a.length*b):new Float32Array(3*(b*(a.length/3-1)+1));var g,h,i,j=0,k=1/b,l=vec3.create(),m=vec3.create(),n=vec3.create(),o=vec3.create(),p=vec3.create(),q=vec3.create();for(vec3.set(o,a[0],a[1],a[2]),vec3.set(p,a[3],a[4],a[5]),d?(vec3.set(n,a[a.length-3],a[a.length-2],a[a.length-1]),vec3.sub(l,p,n),vec3.scale(l,l,c)):(vec3.set(n,a[0],a[1],a[2]),vec3.set(l,0,0,0)),g=1,i=a.length/3-1;i>g;++g){for(vec3.set(q,a[3*(g+1)],a[3*(g+1)+1],a[3*(g+1)+2]),vec3.sub(m,q,o),vec3.scale(m,m,c),h=0;b>h;++h)e(f,o,l,p,m,k*h,j),j+=3;vec3.copy(n,o),vec3.copy(o,p),vec3.copy(p,q),vec3.copy(l,m)}for(d?(vec3.set(q,a[0],a[1],a[3]),vec3.sub(m,q,o),vec3.scale(m,m,c)):vec3.set(m,0,0,0),h=0;b>h;++h)e(f,o,l,p,m,k*h,j),j+=3;if(!d)return f[j]=a[a.length-3],f[j+1]=a[a.length-2],f[j+2]=a[a.length-1],f;for(vec3.copy(n,o),vec3.copy(o,p),vec3.copy(p,q),vec3.copy(l,m),vec3.set(q,a[3],a[4],a[5]),vec3.sub(m,q,o),vec3.scale(m,m,c),h=0;b>h;++h)e(f,o,l,p,m,k*h,j),j+=3;return f}var b=function(){var a=vec3.create();return function(b,c,d){return vec3.cross(a,b,c),Math.atan2(vec3.dot(a,d),vec3.dot(b,c))}}(),c=function(){var a=vec3.create();return function(b,c){return vec3.copy(a,c),Math.abs(c[0])<Math.abs(c[1])?Math.abs(c[0])<Math.abs(c[2])?a[0]+=1:a[2]+=1:Math.abs(c[1])<Math.abs(c[2])?a[1]+=1:a[2]+=1,vec3.cross(b,c,a)}}(),d=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=f*f,j=f*g,k=f*h,l=g*g,m=g*h,n=h*h;return a[0]=i+e-i*e,a[1]=j-e*j-d*h,a[2]=k-e*k+d*g,a[3]=j-e*j+d*h,a[4]=l+e-e*l,a[5]=m-e*m-d*f,a[6]=k-e*k-d*g,a[7]=m-e*m+d*f,a[8]=n+e-e*n,a},e=function(){var a=vec3.create();return function(b,c,d,e,f,g,h){var i=g*g,j=3-2*g,k=i*j,l=1-k,m=i*(g-2)+g,n=i*(g-1);vec3.copy(a,c),vec3.scale(a,a,l),vec3.scaleAndAdd(a,a,d,m),vec3.scaleAndAdd(a,a,e,k),vec3.scaleAndAdd(a,a,f,n),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2]}}();return{signedAngle:b,axisRotation:d,ortho:c,catmullRomSpline:a,cubicHermiteInterpolate:e}}();!function(a){"use strict";function b(b,c){this._colors=b;for(var d=0;d<this._colors.length;++d)this._colors[d]=a.forceRGB(this._colors[d]);this._stops=c}function c(a,b,c){this.colorFor=a,this._beginFunc=b,this._endFunc=c}function d(a,b,c){var d=null,e=null;return a[b](function(a){var b=a.prop(c);return null===d&&null===e?(d=e=b,void 0):(d=Math.min(d,b),e=Math.max(e,b),void 0)}),{min:d,max:e}}function e(a,b,e,f,g){return b||(b=gradient("rainbow")),e=e||{},new c(function(c,d,e){var f=0;this._min!==this._max&&(f=(g(c).prop(a)-this._min)/(this._max-this._min)),h(d,e,b,f)},function(b){if(e.range)return this._min=e.range[0],this._max=e.range[1],void 0;var c=d(b,f,a);this._min=c.min,this._max=c.max},function(){})}a.rgb={},a.rgb.create=vec3.create,a.rgb.scale=vec3.scale,a.rgb.copy=vec3.copy,a.rgb.fromValues=vec3.fromValues,a.rgb.mix=function(a,b,c,d){var e=1-d;return a[0]=b[0]*d+c[0]*e,a[1]=b[1]*d+c[1]*e,a[2]=b[2]*d+c[2]*e,a};var f={white:rgb.fromValues(1,1,1),black:rgb.fromValues(0,0,0),grey:rgb.fromValues(.5,.5,.5),lightgrey:rgb.fromValues(.8,.8,.8),darkgrey:rgb.fromValues(.3,.3,.3),red:rgb.fromValues(1,0,0),darkred:rgb.fromValues(.5,0,0),lightred:rgb.fromValues(1,.5,.5),green:rgb.fromValues(0,1,0),darkgreen:rgb.fromValues(0,.5,0),lightgreen:rgb.fromValues(.5,1,.5),blue:rgb.fromValues(0,0,1),darkblue:rgb.fromValues(0,0,.5),lightblue:rgb.fromValues(.5,.5,1),yellow:rgb.fromValues(1,1,0),darkyellow:rgb.fromValues(.5,.5,0),lightyellow:rgb.fromValues(1,1,.5),cyan:rgb.fromValues(0,1,1),darkcyan:rgb.fromValues(0,.5,.5),lightcyan:rgb.fromValues(.5,1,1),magenta:rgb.fromValues(1,0,1),darkmagenta:rgb.fromValues(.5,0,.5),lightmagenta:rgb.fromValues(1,.5,1),orange:rgb.fromValues(1,.5,0),darkorange:rgb.fromValues(.5,.25,0),lightorange:rgb.fromValues(1,.75,.5)};a.forceRGB=function(a){return void 0!==f[a]?f[a]:a},b.prototype.colorAt=function(a,b){if(b<=this._stops[0])return vec3.copy(a,this._colors[0]);if(b>=this._stops[this._stops.length-1])return vec3.copy(a,this._colors[this._stops.length-1]);for(var c=0,d=0;d<this._stops.length&&!(this._stops[d]>b);++d)c=d;var e=c+1,f=this._stops[c],g=this._stops[e],h=(b-f)/(g-f);return rgb.mix(a,this._colors[e],this._colors[c],h)};var g={};a.gradient=function(a,c){if("string"==typeof a)return g[a];if(c=c||"equal","equal"===c){c=[];for(var d=0;d<a.length;++d)c.push(1*d/(a.length-1))}return new b(a,c)},g.rainbow=gradient(["red","yellow","green","blue"]),g.reds=gradient(["lightred","darkred"]),g.greens=gradient(["lightgreen","darkgreen"]),g.blues=gradient(["lightblue","darkblue"]),g.trafficlight=gradient(["green","yellow","red"]),g.heatmap=gradient(["red","white","blue"]),c.prototype.begin=function(a){this._beginFunc&&this._beginFunc(a)},c.prototype.end=function(a){this._endFunc&&this._endFunc(a)},a.color={},a.ColorOp=c,a.color.uniform=function(b){return b=a.forceRGB(b),new c(function(a,c,d){c[d]=b[0],c[d+1]=b[1],c[d+2]=b[2]},null,null)},a.color.byElement=function(){return new c(function(a,b,c){var d=a.element();return"C"===d?(b[c]=.8,b[c+1]=.8,b[c+2]=.8,b):"N"===d?(b[c]=0,b[c+1]=0,b[c+2]=1,b):"O"===d?(b[c]=1,b[c+1]=0,b[c+2]=0,b):"S"===d?(b[c]=.8,b[c+1]=.8,b[c+2]=0,b):"CA"===d?(b[c]=.533,b[c+1]=.533,b[c+2]=.666,b):(b[c]=1,b[c+1]=0,b[c+2]=1,b)
},null,null)},a.color.bySS=function(){return new c(function(a,b,c){switch(a.residue().ss()){case"C":return b[c]=.8,b[c+1]=.8,b[c+2]=.8,void 0;case"H":return b[c]=.6,b[c+1]=.6,b[c+2]=.9,void 0;case"E":return b[c]=.2,b[c+1]=.8,b[c+2]=.2,void 0}},null,null)},a.color.rainbow=function(a){a||(a=gradient("rainbow"));var b=new c(function(b,c,d){var e=b.residue().index(),f=this.chainLimits[b.residue().chain().name()],g=0;void 0!==f&&(g=(e-f[0])/(f[1]-f[0]));var h=[0,0,0];a.colorAt(h,g),c[d]=h[0],c[d+1]=h[1],c[d+2]=h[2]},function(a){var b=a.chains();this.chainLimits={};for(var c=0;c<b.length;++c){var d=b[c].backboneTraces();if(0!==d.length){for(var e=d[0].residueAt(0).index(),f=d[0].residueAt(d[0].length()-1).index(),g=1;g<d.length;++g){var h=d[g];e=Math.min(e,h.residueAt(0).index()),f=Math.max(f,h.residueAt(h.length()-1).index())}this.chainLimits[b[c].name()]=[e,f]}}},function(){this.chainLimits=null});return b},a.color.ssSuccession=function(a,b){a||(a=gradient("rainbow")),b||(b=forceRGB("lightgrey"));var d=new c(function(c,d,e){var f=c.residue().index(),g=this.chainLimits[c.residue().chain().name()],h=g.indices[f];if(-1===h)return d[e]=b[0],d[e+1]=b[1],d[e+2]=b[2],void 0;var i=0;null===g.max,null!==g.max&&(i=h/(g.max>0?g.max:1));var j=[0,0,0];a.colorAt(j,i),d[e]=j[0],d[e+1]=j[1],d[e+2]=j[2]},function(a){var b=a.chains();this.chainLimits={};for(var c=0;c<b.length;++c){for(var d=b[c].residues(),e=null,f={},g=0,h="C",i=0;i<d.length;++i){var j=d[i].ss();"C"===j?("C"!==h&&g++,f[d[i].index()]=-1):(e=g,f[d[i].index()]=g),h=j}this.chainLimits[b[c].name()]={indices:f,max:e}}},function(){this.chainLimits=null});return d},a.color.byChain=function(a){a||(a=gradient("rainbow"));var b=new c(function(b,c,d){b.residue().index();var e=this.chainIndices[b.residue().chain().name()],f=e*this.scale,g=[0,0,0];a.colorAt(g,f),c[d]=g[0],c[d+1]=g[1],c[d+2]=g[2]},function(a){var b=a.chains();this.chainIndices={};for(var c=0;c<b.length;++c)this.chainIndices[b[c].name()]=c;this.scale=b.length>1?1/(b.length-1):1},function(){this.chainIndices=null});return b};var h=function(){var a=vec3.create();return function(b,c,d,e){d.colorAt(a,e),b[c+0]=a[0],b[c+1]=a[1],b[c+2]=a[2]}}();return a.color.byAtomProp=function(a,b,c){return e(a,b,c,"eachAtom",function(a){return a})},a.color.byResidueProp=function(a,b,c){return e(a,b,c,"eachResidue",function(a){return a.residue()})},a.interpolateColor=function(a,b){for(var c=new Float32Array(3*(b*(a.length/3-1)+1)),d=0,e=vec3.create(),f=vec3.create(),g=1/b,h=0;h<a.length/3-1;++h){vec3.set(e,a[3*h],a[3*h+1],a[3*h+2]),vec3.set(f,a[3*h+3],a[3*h+4],a[3*h+5]);for(var i=0;b>i;++i){var j=g*i;c[d]=e[0]*(1-j)+f[0]*j,c[d+1]=e[1]*(1-j)+f[1]*j,c[d+2]=e[2]*(1-j)+f[2]*j,d+=3}}return c[d]=f[0],c[d+1]=f[1],c[d+2]=f[2],c},!0}(this),AtomVertexAssoc.prototype.addAssoc=function(a,b,c){this._assocs.push({atom:a,vertStart:b,vertEnd:c})},AtomVertexAssoc.prototype.recolor=function(a,b,c,d,e){var f=new Float32Array(3*b.atomCount());this._callBeginEnd&&a.begin(this._structure);var g={};b.eachAtom(function(b,c){g[b.index()]=c,a.colorFor(b,f,3*c)}),this._callBeginEnd&&a.end(this._structure);for(var h=0;h<this._assocs.length;++h){var i=this._assocs[h],j=g[i.atom.index()];if(void 0!==j)for(var k=f[3*j],l=f[3*j+1],m=f[3*j+2],n=i.vertStart;n<i.vertEnd;++n)c[d+n*e+0]=k,c[d+n*e+1]=l,c[d+n*e+2]=m}},TraceVertexAssoc.prototype.setPerResidueColors=function(a,b){this._perResidueColors[a]=b},TraceVertexAssoc.prototype.addAssoc=function(a,b,c,d){this._assocs.push({traceIndex:a,slice:b,vertStart:c,vertEnd:d})},TraceVertexAssoc.prototype.recolor=function(a,b,c,d,e){this._callBeginEnd&&a.begin(this._structure);for(var f,g,h=[],i=this._structure.chains(),j=0;j<i.length;++j){var k=i[j],l=k.backboneTraces();for(f=0;f<l.length;++f){var m=this._perResidueColors[f],n=0,o=l[f];for(g=0;g<o.length();++g)b.containsResidue(o.residueAt(g))?(a.colorFor(o.centralAtomAt(g),m,n),n+=3):n+=3;this._interpolation>1?h.push(interpolateColor(m,this._interpolation)):h.push(m)}}for(f=0;f<this._assocs.length;++f){var p=this._assocs[f],q=p.slice,r=h[p.traceIndex],s=r[3*q],t=r[3*q+1],u=r[3*q+2];for(g=p.vertStart;g<p.vertEnd;++g)c[d+g*e+0]=s,c[d+g*e+1]=t,c[d+g*e+2]=u}this._callBeginEnd&&a.end(this._structure)},function(a){function b(a){this._children=[],this._visible=!0,this._name=a||""}function c(a){b.prototype.constructor.call(this,a),this._gl=a,this._idRanges=[]}function d(a){c.prototype.constructor.call(this,a),this._data=[],this._ready=!1,this._interleavedBuffer=a.createBuffer(),this._numLines=0,this._vertAssoc=null,this._lineWidth=1}function e(a){c.prototype.constructor.call(this,null),this._geoms=[],this._structure=a}function f(a,b){this._arcs=b,this._stacks=a,this._indices=new Uint16Array(2*3*b*a),this._verts=new Float32Array(3*b*a);var c,d,e=Math.PI/(a-1),f=2*Math.PI/b;for(c=0;c<this._stacks;++c){var g=Math.sin(c*e),h=Math.cos(c*e);for(d=0;d<this._arcs;++d){var i=g*Math.cos(d*f),j=g*Math.sin(d*f);this._verts[3*(d+c*this._arcs)]=i,this._verts[3*(d+c*this._arcs)+1]=j,this._verts[3*(d+c*this._arcs)+2]=h}}var k=0;for(c=0;c<this._stacks-1;++c)for(d=0;d<this._arcs;++d)this._indices[k]=c*this._arcs+d,this._indices[k+1]=c*this._arcs+(d+1)%this._arcs,this._indices[k+2]=(c+1)*this._arcs+d,k+=3,this._indices[k]=c*this._arcs+(d+1)%this._arcs,this._indices[k+1]=(c+1)*this._arcs+(d+1)%this._arcs,this._indices[k+2]=(c+1)*this._arcs+d,k+=3}function g(a,b,c){var d=geom.catmullRomSpline(a,b,c,!0);this._indices=new Uint16Array(2*d.length),this._verts=d,this._normals=new Float32Array(d.length),this._arcs=d.length/3;var e=vec3.create();vec3.create();for(var f=0;f<this._arcs;++f){var g=0===f?this._arcs-1:f-1,h=f===this._arcs-1?0:f+1;e[0]=this._verts[3*h+1]-this._verts[3*g+1],e[1]=this._verts[3*g]-this._verts[3*h],vec3.normalize(e,e),this._normals[3*f]=e[0],this._normals[3*f+1]=e[1],this._normals[3*f+2]=e[2]}for(f=0;f<this._arcs;++f)this._indices[6*f]=f,this._indices[6*f+1]=f+this._arcs,this._indices[6*f+2]=(f+1)%this._arcs+this._arcs,this._indices[6*f+3]=f,this._indices[6*f+4]=(f+1)%this._arcs+this._arcs,this._indices[6*f+5]=(f+1)%this._arcs}function h(a){this._arcs=a,this._indices=new Uint16Array(2*3*a),this._verts=new Float32Array(2*3*a),this._normals=new Float32Array(2*3*a);for(var b=2*Math.PI/this._arcs,c=0;c<this._arcs;++c){var d=Math.cos(b*c),e=Math.sin(b*c);this._verts[3*c]=d,this._verts[3*c+1]=e,this._verts[3*c+2]=-.5,this._verts[3*a+3*c]=d,this._verts[3*a+3*c+1]=e,this._verts[3*a+3*c+2]=.5,this._normals[3*c]=d,this._normals[3*c+1]=e,this._normals[3*a+3*c]=d,this._normals[3*a+3*c+1]=e}for(c=0;c<this._arcs;++c)this._indices[6*c]=c%this._arcs,this._indices[6*c+1]=a+(c+1)%this._arcs,this._indices[6*c+2]=(c+1)%this._arcs,this._indices[6*c+3]=c%this._arcs,this._indices[6*c+4]=a+c%this._arcs,this._indices[6*c+5]=a+(c+1)%this._arcs}function i(a){c.prototype.constructor.call(this,a),this._interleavedBuffer=a.createBuffer(),this._indexBuffer=a.createBuffer(),this._vertData=[],this._indexData=[],this._numVerts=0,this._numTriangles=0,this._ready=!1,this._vertAssoc=null}function j(a,c,d,e,f){b.prototype.constructor.call(this,a),this._gl=a,this._pos=e,this._interleavedBuffer=this._gl.createBuffer(),this._interleavedData=new Float32Array(30),this._prepareText(c,d,f);var g=this._width/2,h=this._height/2;this._interleavedData[0]=e[0],this._interleavedData[1]=e[1],this._interleavedData[2]=e[2],this._interleavedData[3]=-g,this._interleavedData[4]=-h,this._interleavedData[5]=e[0],this._interleavedData[6]=e[1],this._interleavedData[7]=e[2],this._interleavedData[8]=g,this._interleavedData[9]=h,this._interleavedData[10]=e[0],this._interleavedData[11]=e[1],this._interleavedData[12]=e[2],this._interleavedData[13]=g,this._interleavedData[14]=-h,this._interleavedData[15]=e[0],this._interleavedData[16]=e[1],this._interleavedData[17]=e[2],this._interleavedData[18]=-g,this._interleavedData[19]=-h,this._interleavedData[20]=e[0],this._interleavedData[21]=e[1],this._interleavedData[22]=e[2],this._interleavedData[23]=-g,this._interleavedData[24]=h,this._interleavedData[25]=e[0],this._interleavedData[26]=e[1],this._interleavedData[27]=e[2],this._interleavedData[28]=g,this._interleavedData[29]=h}function k(a){for(var b=1;a>b;)b*=2;return b}function l(a,b,c){this._pool=a,this._start=b,this._next=b,this._end=c}function m(){this._objects={},this._unusedRangeStart=0,this._free=[]}b.prototype.add=function(a){this._children.push(a)},b.prototype.draw=function(a,b,c,d){for(var e=0,f=this._children.length;e!==f;++e)this._children[e].draw(a,b,c,d)},b.prototype.show=function(){this._visible=!0},b.prototype.hide=function(){this._visible=!1},b.prototype.name=function(a){return void 0!==a&&(this._name=a),this._name},b.prototype.destroy=function(){for(var a=0;a<this._children.length;++a)this._children[a].destroy()},derive(c,b),c.prototype.select=function(a){return this.structure().select(a)},c.prototype.structure=function(){return this._vertAssoc._structure},c.prototype.setVertAssoc=function(a){this._vertAssoc=a},c.prototype.addIdRange=function(a){this._idRanges.push(a)},c.prototype.destroy=function(){b.prototype.destroy.call(this);for(var a=0;a<this._idRanges.length;++a)this._idRanges[a].recycle()},derive(d,c),d.prototype.setLineWidth=function(a){this._lineWidth=a},d.prototype.shaderForStyleAndPass=function(a,b,c){return"outline"===c?null:"select"===c?a.select:a.lines},d.prototype._FLOATS_PER_VERT=7,d.prototype._POS_OFFSET=0,d.prototype._COLOR_OFFSET=3,d.prototype._ID_OFFSET=6,d.prototype.destroy=function(){c.prototype.destroy.call(this),this._gl.deleteBuffer(this._interleavedBuffer)},d.prototype.numVerts=function(){return 2*this._numLines},d.prototype.draw=function(a,b,c,d){if(this._visible){var e=this.shaderForStyleAndPass(b,c,d);if(e){a.bind(e),this.bind(),this._gl.lineWidth(this._lineWidth);var f=this._gl.getAttribLocation(e,"attrPos");this._gl.enableVertexAttribArray(f),this._gl.vertexAttribPointer(f,3,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._POS_OFFSET);var g=this._gl.getAttribLocation(e,"attrColor");this._gl.vertexAttribPointer(g,3,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._COLOR_OFFSET),this._gl.enableVertexAttribArray(g);var h=this._gl.getAttribLocation(e,"attrObjId");-1!==h&&(this._gl.vertexAttribPointer(h,1,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._ID_OFFSET),this._gl.enableVertexAttribArray(h)),this._gl.drawArrays(this._gl.LINES,0,2*this._numLines),this._gl.disableVertexAttribArray(f),this._gl.disableVertexAttribArray(g),-1!==h&&this._gl.disableVertexAttribArray(h)}}},d.prototype.colorBy=function(a,b){console.time("LineGeom.colorBy"),this._ready=!1,b=b||this.structure(),this._vertAssoc.recolor(a,b,this._data,this._COLOR_OFFSET,this._FLOATS_PER_VERT),console.timeEnd("LineGeom.colorBy")},d.prototype.bind=function(){if(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._interleavedBuffer),!this._ready){var a=new Float32Array(this._data);this._gl.bufferData(this._gl.ARRAY_BUFFER,a,this._gl.STATIC_DRAW),this._ready=!0}},d.prototype.addLine=function(a,b,c,d,e,f){this._data.push(a[0],a[1],a[2],b[0],b[1],b[2],e,c[0],c[1],c[2],d[0],d[1],d[2],f),this._numLines+=1,this._ready=!1},derive(e,c),e.prototype.addGeom=function(a){this._geoms.push(a)},e.prototype.destroy=function(){c.prototype.destroy.call(this);for(var a=0;a<this._geoms.length;++a)this._geoms[a].destroy();this._geoms=[]},e.prototype.structure=function(){return this._structure},e.prototype.forwardMethod=function(a,b){for(var c=0;c<this._geoms.length;++c)this._geoms[c][a].apply(this._geoms[c],b)},e.prototype.colorBy=function(){var a=arguments[0];a.begin(this._structure),this.forwardMethod("colorBy",arguments),a.end(this._structure)},e.prototype.draw=function(a,b,c,d){if(this._visible)for(var e=0;e<this._geoms.length;++e)this._geoms[e].draw(a,b,c,d)},f.prototype.addTransformed=function(){var a=vec3.create(),b=vec3.create();return function(c,d,e,f,g){for(var h=c.numVerts(),i=0;i<this._stacks*this._arcs;++i)vec3.set(b,this._verts[3*i],this._verts[3*i+1],this._verts[3*i+2]),vec3.copy(a,b),vec3.scale(a,a,e),vec3.add(a,a,d),c.addVertex(a,b,f,g);for(i=0;i<this._indices.length/3;++i)c.addTriangle(h+this._indices[3*i],h+this._indices[3*i+1],h+this._indices[3*i+2])}}(),f.prototype.num_indices=function(){return this._indices.length},f.prototype.num_vertices=function(){return this._verts.length},g.prototype.addTransformed=function(){var a=vec3.create(),b=vec3.create();return function(c,d,e,f,g,h,i,j){for(var k=c.numVerts()-this._arcs,l=0;l<this._arcs;++l)vec3.set(a,e*this._verts[3*l],e*this._verts[3*l+1],0),vec3.transformMat3(a,a,f),vec3.add(a,a,d),vec3.set(b,this._normals[3*l],this._normals[3*l+1],0),vec3.transformMat3(b,b,f),c.addVertex(a,b,g,j);if(!h)if(0!==i)for(l=0;l<this._arcs;++l)c.addTriangle(k+(l+i)%this._arcs,k+l+this._arcs,k+(l+1)%this._arcs+this._arcs),c.addTriangle(k+(l+i)%this._arcs,k+(l+1)%this._arcs+this._arcs,k+(l+1+i)%this._arcs);else for(l=0;l<this._indices.length/3;++l)c.addTriangle(k+this._indices[3*l],k+this._indices[3*l+1],k+this._indices[3*l+2])}}(),h.prototype.addTransformed=function(){var a=vec3.create(),b=vec3.create();return function(c,d,e,f,g,h,i,j,k){for(var l=c.numVerts(),m=0;m<2*this._arcs;++m){vec3.set(a,f*this._verts[3*m],f*this._verts[3*m+1],e*this._verts[3*m+2]),vec3.transformMat3(a,a,g),vec3.add(a,a,d),vec3.set(b,this._normals[3*m],this._normals[3*m+1],this._normals[3*m+2]),vec3.transformMat3(b,b,g);var n=m<this._arcs?j:k;c.addVertex(a,b,m<this._arcs?h:i,n)}for(m=0;m<this._indices.length/3;++m)c.addTriangle(l+this._indices[3*m],l+this._indices[3*m+1],l+this._indices[3*m+2])}}(),i.prototype._FLOATS_PER_VERT=10,i.prototype._COLOR_OFFSET=6,i.prototype._POS_OFFSET=0,i.prototype._NORMAL_OFFSET=3,derive(i,c),i.prototype.setVertAssoc=function(a){this._vertAssoc=a},i.prototype.destroy=function(){c.prototype.destroy.call(this),this._gl.deleteBuffer(this._interleavedBuffer),this._gl.deleteBuffer(this._indexBuffer)},i.prototype.numVerts=function(){return this._numVerts},i.prototype.shaderForStyleAndPass=function(a,b,c){if("outline"===c)return a.outline;if("select"===c)return a.select;var d=a[b];return void 0!==d?d:null},i.prototype.colorBy=function(a,b){console.time("MeshGeom.colorBy"),this._ready=!1,b=b||this.structure(),this._vertAssoc.recolor(a,b,this._vertData,this._COLOR_OFFSET,this._FLOATS_PER_VERT),console.timeEnd("MeshGeom.colorBy")},i.prototype.draw=function(a,b,c,d){if(this._visible){var e=this.shaderForStyleAndPass(b,c,d);e&&(a.bind(e),this.bind(),this._gl.enableVertexAttribArray(e.posAttrib),this._gl.vertexAttribPointer(e.posAttrib,3,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._POS_OFFSET),-1!==e.normalAttrib&&(this._gl.enableVertexAttribArray(e.normalAttrib),this._gl.vertexAttribPointer(e.normalAttrib,3,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._NORMAL_OFFSET)),-1!==e.colorAttrib&&(this._gl.vertexAttribPointer(e.colorAttrib,3,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,4*this._COLOR_OFFSET),this._gl.enableVertexAttribArray(e.colorAttrib)),-1!==e.objIdAttrib&&(this._gl.vertexAttribPointer(e.objIdAttrib,1,this._gl.FLOAT,!1,4*this._FLOATS_PER_VERT,36),this._gl.enableVertexAttribArray(e.objIdAttrib)),this._gl.drawElements(this._gl.TRIANGLES,3*this._numTriangles,this._gl.UNSIGNED_SHORT,0),this._gl.disableVertexAttribArray(e.posAttrib),-1!==e.colorAttrib&&this._gl.disableVertexAttribArray(e.colorAttrib),-1!==e.normalAttrib&&this._gl.disableVertexAttribArray(e.normalAttrib),-1!==e.objIdAttrib&&this._gl.disableVertexAttribArray(e.objIdAttrib))}},i.prototype.addVertex=function(a,b,c,d){this._vertData.push(a[0],a[1],a[2],b[0],b[1],b[2],c[0],c[1],c[2],d),this._numVerts+=1},i.prototype.addTriangle=function(a,b,c){this._indexData.push(a,b,c),this._numTriangles+=1},i.prototype.bind=function(){if(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._interleavedBuffer),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),!this._ready){var a=new Float32Array(this._vertData);this._gl.bufferData(this._gl.ARRAY_BUFFER,a,this._gl.STATIC_DRAW);var b=new Uint16Array(this._indexData);this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,b,this._gl.STATIC_DRAW),this._ready=!0}},derive(j,b),j.prototype._setupTextParameters=function(a){a.fillStyle="black",a.textAlign="left",a.textBaseline="bottom",a.font='24px "Helvetica Neue"',a.fontWeight="lighter"},j.prototype._prepareText=function(a,b,c){this._setupTextParameters(b);var d=b.measureText(c).width,e=24;a.width=k(d),a.height=k(e),this._setupTextParameters(b),b.fillText(c,0,a.height),this._texture=this._gl.createTexture(),this._textureFromCanvas(this._texture,a),this._xScale=d/a.width,this._yScale=e/a.height,this._width=.1*d,this._height=.1*e},j.prototype._textureFromCanvas=function(a,b){this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,!0),this._gl.bindTexture(this._gl.TEXTURE_2D,a),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},j.prototype.bind=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._interleavedBuffer),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._texture),this._ready||(this._gl.bufferData(this._gl.ARRAY_BUFFER,this._interleavedData,this._gl.STATIC_DRAW),this._ready=!0)},j.prototype.draw=function(a,b,c,d){if(this._visible&&"normal"===d){var e=b.text;a.bind(e),this.bind(),this._gl.uniform1f(this._gl.getUniformLocation(e,"xScale"),this._xScale),this._gl.uniform1f(this._gl.getUniformLocation(e,"yScale"),this._yScale),this._gl.uniform1i(this._gl.getUniformLocation(e,"sampler"),0);var f=this._gl.getAttribLocation(e,"attrCenter");this._gl.enableVertexAttribArray(f),this._gl.vertexAttribPointer(f,3,this._gl.FLOAT,!1,20,0);var g=this._gl.getAttribLocation(e,"attrCorner");this._gl.vertexAttribPointer(g,2,this._gl.FLOAT,!1,20,12),this._gl.enableVertexAttribArray(g),this._gl.enable(this._gl.BLEND),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.disableVertexAttribArray(f),this._gl.disableVertexAttribArray(g),this._gl.disable(this._gl.BLEND)}},l.prototype.nextId=function(a){var b=this._next;return this._next++,this._pool._objects[b]=a,b},l.prototype.recycle=function(){this._pool.recycle(this)},l.prototype.length=function(){return this._end-this._start},m.prototype.getContinuousRange=function(a){for(var b=-1,c=null,d=0;d<this._free.length;++d){var e=this._free[d],f=e.length();f>=a&&(null===c||c>f)&&(c=f,b=d)}if(-1!==b){var g=this._free[b];return this._free.splice(b,1),g}var h=this._unusedRangeStart,i=h+a;return this._unusedRangeStart=i,new l(this,h,i)},m.prototype.recycle=function(a){for(var b=a._start;b<a._next;++b)delete this._objects[b];a._next=a._start,this._free.push(a)},m.prototype.objectForId=function(a){return this._objects[a]},a.SceneNode=b,a.AtomVertexAssoc=AtomVertexAssoc,a.TraceVertexAssoc=TraceVertexAssoc,a.MeshGeom=i,a.LineGeom=d,a.CompositeGeom=e,a.TubeProfile=g,a.ProtoSphere=f,a.ProtoCylinder=h,a.TextLabel=j,a.UniqueObjectIdPool=m}(this),function(a){"use strict";function b(a){var b=s[a.toUpperCase()];return void 0!==b?b:1.5}function c(){}function d(a,b){for(var c=0;c<b.length;++c)if(!b[c](a))return!1;return!0}function e(){}function f(){}function g(){}function h(a){c.prototype.constructor.call(this),this._chains=[],this._pv=a,this._nextAtomIndex=0}function i(a,b){e.prototype.constructor.call(this),this._structure=a,this._name=b,this._cachedTraces=[],this._residues=[]}function j(a,b,c){f.prototype.constructor.call(this),this._name=b,this._num=c,this._atoms=[],this._ss="C",this._chain=a,this._index=a.residues().length}function k(a,b,c,d,e){g.prototype.constructor.call(this),this._residue=a,this._bonds=[],this._name=b,this._pos=c,this._index=e,this._element=d}function l(a){c.prototype.constructor.call(this),this._mol=a,this._chains=[]}function m(a,b){e.prototype.constructor.call(this),this._chain=b,this._residues=[],this._molView=a,this._residueMap={}}function n(a,b){f.prototype.constructor.call(this),this._chainView=a,this._atoms=[],this._residue=b}function o(a,b){g.prototype.constructor.call(this),this._resView=a,this._atom=b,this._bonds=[]}function p(a){var b=parseInt(a.substr(21,4),10),c=parseInt(a.substr(33,4),10),d=a[19];return{first:b,last:c,chainName:d}}function q(a){var b=parseInt(a.substr(22,4),10),c=parseInt(a.substr(33,4),10),d=a[21];return{first:b,last:c,chainName:d}}function r(a){function b(a){var b=a[16];if(" "===b||"A"===b){var f=a[21],g=a.substr(17,3),h=a.substr(12,4).trim(),i=parseInt(a.substr(22,4),10);a[26];var j=!1,k=!1;d&&d.name()===f||(k=!0,j=!0),e&&e.num()===i||(j=!0),k&&(d=c.chain(f)||c.addChain(f)),j&&(e=d.addResidue(g,i,d.residues().length));for(var l=vec3.create(),m=0;3>m;++m)l[m]=parseFloat(a.substr(30+8*m,8));e.addAtom(h,l,a.substr(76,2).trim())}}console.time("pdb");var c=new h,d=null,e=null,f=[],g=[],i=a.split(/\r\n|\r|\n/g),j=0;for(j=0;j<i.length;j++){var k=i[j],l=k.substr(0,6);if("ATOM  "!==l)if("HETATM"!==l)if("HELIX "!==l)if("SHEET "!==l){if("END"===l)break}else g.push(q(k));else f.push(p(k));else b(k,!0);else b(k,!1)}var m=null;for(j=0;j<g.length;++j){var n=g[j];m=c.chain(n.chainName),m&&m.assign_ss(n.first,n.last,"E")}for(j=0;j<f.length;++j){var o=f[j];m=c.chain(o.chainName),m&&m.assign_ss(o.first,o.last,"H")}return c.deriveConnectivity(),console.log("imported",c.chains().length,"chain(s),",c.residueCount(),"residue(s)"),console.timeEnd("pdb"),c}var s={H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69};c.prototype.eachResidue=function(a){for(var b=0;b<this._chains.length;b+=1)this._chains[b].eachResidue(a)},c.prototype.eachAtom=function(a,b){b|=0;for(var c=0;c<this._chains.length;c+=1)b=this._chains[c].eachAtom(a,b)},c.prototype.residueCount=function(){for(var a=this.chains(),b=0,c=0;c<a.length;++c)b+=a[c].residues().length;return b},c.prototype.atomCount=function(){for(var a=this.chains(),b=0,c=0;c<a.length;++c)for(var d=a[c].residues(),e=0;e<d.length;++e)b+=d[e].atoms().length;return b},c.prototype.center=function(){var a=vec3.create(),b=0;return this.eachAtom(function(c){vec3.add(a,a,c.pos()),b+=1}),b&&vec3.scale(a,a,1/b),a},c.prototype.select=function(a){return"protein"===a?this.residueSelect(function(a){return a.isAminoacid()}):"water"===a?this.residueSelect(function(a){return a.isWater()}):"ligand"===a?this.residueSelect(function(a){return!a.isAminoacid()&&!a.isWater()}):this._dictSelect(a)},c.prototype.selectWithin=function(){var a=vec3.create();return function(b,c){console.time("Mol.selectWithin"),c=c||{};var d=c.radius||4,e=d*d,f=!!c.matchResidues,g=[];b.eachAtom(function(a){g.push(a)});for(var h=new l(this.full()),i=null,j=null,k=this.chains(),m=!1,n=0;n<k.length;++n){var o=k[n].residues();j=null;for(var p=0;p<o.length;++p){i=null,m=!1;for(var q=o[p].atoms(),r=0;r<q.length&&!m;++r)for(var s=0;s<g.length;++s)if(vec3.sub(a,q[r].pos(),g[s].pos()),!(vec3.sqrLen(a)>e)){if(j||(j=h.addChain(k[n].full(),!1)),i||(i=j.addResidue(o[p].full(),f)),f){m=!0;break}i.addAtom(q[r].full())}}}return console.timeEnd("Mol.selectWithin"),h}}(),c.prototype.residueSelect=function(a){console.time("Mol.residueSelect");for(var b=new l(this.full()),c=0;c<this._chains.length;++c)for(var d=this._chains[c],e=null,f=d.residues(),g=0;g<f.length;++g)a(f[g])&&(e||(e=b.addChain(d,!1)),e.addResidue(f[g],!0));return console.timeEnd("Mol.residueSelect"),b},c.prototype._atomPredicates=function(a){var b=[];return void 0!==a.aname&&b.push(function(b){return b.name()===a.aname}),void 0!==a.anames&&b.push(function(b){for(var c=b.name(),d=0;d<a.anames.length;++d)if(c===a.anames[d])return!0;return!1}),b},c.prototype._residuePredicates=function(a){var b=[];return void 0!==a.rname&&b.push(function(b){return b.name()===a.rname}),void 0!==a.rnames&&b.push(function(b){for(var c=b.name(),d=0;d<a.rnames.length;++d)if(c===a.rnames[d])return!0;return!1}),b},c.prototype._chainPredicates=function(a){var b=[];return void 0!==a.chain&&b.push(function(b){return b.name()===a.chain}),void 0!==a.chains&&b.push(function(b){for(var c=b.name(),d=0;d<a.chains.length;++d)if(c===a.chains[d])return!0;return!1}),b},c.prototype._dictSelect=function(a){for(var b=new l(this),c=this._residuePredicates(a),e=this._atomPredicates(a),f=this._chainPredicates(a),g=0;g<this._chains.length;++g){var h=this._chains[g];if(d(h,f)){var i,j,k=null,m=h.residues(),n=[];if(void 0!==a.rindexRange){for(i=a.rindexRange[0],j=Math.min(m.length,a.rindexRange[1]);j>i;++i)n.push(m[i]);m=n}else if(a.rindices&&void 0!==a.rindices.length){for(n=[],i=0;i<a.rindices.length;++i)n.push(m[a.rindices[i]]);m=n}for(var o=0;o<m.length;++o)if(d(m[o],c)){k||(k=b.addChain(h,!1));for(var p=null,q=m[o].atoms(),r=0;r<q.length;++r)d(q[r],e)&&(p||(p=k.addResidue(m[o],!1)),p.addAtom(q[r]))}}}return b},e.prototype.eachAtom=function(a,b){b|=0;for(var c=0;c<this._residues.length;c+=1)b=this._residues[c].eachAtom(a,b);return b},e.prototype.eachResidue=function(a){for(var b=0;b<this._residues.length;b+=1)a(this._residues[b])},e.prototype.residues=function(){return this._residues},e.prototype.structure=function(){return this._structure},e.prototype.asView=function(){var a=new l(this.structure().full());return a.addChain(this,!0),a},e.prototype.prop=function(a){return this[a]()},f.prototype.prop=function(a){return this[a]()},f.prototype.isWater=function(){return"HOH"===this.name()||"DOD"===this.name()},f.prototype.eachAtom=function(a,b){b|=0;for(var c=0;c<this._atoms.length;c+=1)a(this._atoms[c],b),b+=1;return b},f.prototype.qualifiedName=function(){return this.chain().name()+"."+this.name()+this.num()},f.prototype.atom=function(a){if("string"==typeof a)for(var b=0;b<this._atoms.length;++b)if(this._atoms[b].name()===a)return this._atoms[b];return this._atoms[a]},f.prototype.center=function(){var a=0,b=vec3.create();return this.eachAtom(function(c){vec3.add(b,b,c.pos()),a+=1}),a>0&&vec3.scale(b,b,1/a),b},f.prototype.isAminoacid=function(){return this.atom("N")&&this.atom("CA")&&this.atom("C")&&this.atom("O")},g.prototype.name=function(){return this._name},g.prototype.pos=function(){return this._pos},g.prototype.element=function(){return this._element},g.prototype.index=function(){return this._index},g.prototype.prop=function(a){return this[a]()},g.prototype.eachBond=function(a){for(var b=this.bonds(),c=0,d=b.length;d>c;++c)a(b[c])},derive(h,c),h.prototype.chains=function(){return this._chains},h.prototype.full=function(){return this},h.prototype.containsResidue=function(a){return a.full().structure()===this},h.prototype.chain=function(a){for(var b=0;b<this._chains.length;++b)if(this._chains[b].name()===a)return this._chains[b];return null},h.prototype.nextAtomIndex=function(){var a=this._nextAtomIndex;return this._nextAtomIndex+=1,a},h.prototype.addChain=function(a){var b=new i(this,a);return this._chains.push(b),b},h.prototype.connect=function(a,b){var c=new t(a,b);return a.addBond(c),b.addBond(c),c},h.prototype.deriveConnectivity=function(){console.time("Mol.deriveConnectivity");var a,c=this;this.eachResidue(function(d){var e;vec3.create();for(var f=0;f<d.atoms().length;f+=1)for(var g=d.atom(f),h=b(g.element()),i=0;f>i;i+=1){var j=d.atom(i),k=b(j.element());e=vec3.sqrDist(g.pos(),j.pos());var l=h+k-.3,m=h+k+.3;m*m>e&&e>l*l&&c.connect(d.atom(f),d.atom(i))}if(a){var n=a.atom("C"),o=d.atom("N");n&&o&&(e=vec3.sqrDist(n.pos(),o.pos()),1.6*1.6>e&&c.connect(o,n))}a=d}),console.timeEnd("Mol.deriveConnectivity")},derive(i,e),i.prototype.name=function(){return this._name},i.prototype.full=function(){return this},i.prototype.addResidue=function(a,b){var c=new j(this,a,b);return this._residues.push(c),c},i.prototype.assign_ss=function(a,b,c){for(var d=1;d<this._residues.length-1;++d){var e=this._residues[d];e.num()<=a||e.num()>=b||e.set_ss(c)}},i.prototype.eachBackboneTrace=function(a){this._cacheBackboneTraces();for(var b=0;b<this._cachedTraces.length;++b)a(this._cachedTraces[b])},i.prototype._cacheBackboneTraces=function(){if(!(this._cachedTraces.length>0)){for(var a=new BackboneTrace,b=0;b<this._residues.length;b+=1){var c=this._residues[b];if(c.isAminoacid())if(0!==a.length()){var d=this._residues[b-1].atom("C"),e=c.atom("N");Math.abs(vec3.sqrDist(d.pos(),e.pos())-2.25)<1?a.push(c):a.length()>1&&(this._cachedTraces.push(a),a=new BackboneTrace)}else a.push(c);else a.length()>1&&(this._cachedTraces.push(a),a=new BackboneTrace)}a.length()>1&&this._cachedTraces.push(a)}},i.prototype.backboneTraces=function(){var a=[];return this.eachBackboneTrace(function(b){a.push(b)}),a},derive(j,f),j.prototype.name=function(){return this._name},j.prototype.num=function(){return this._num},j.prototype.full=function(){return this},j.prototype.addAtom=function(a,b,c){var d=new k(this,a,b,c,this.structure().nextAtomIndex());return this._atoms.push(d),d},j.prototype.ss=function(){return this._ss},j.prototype.set_ss=function(a){this._ss=a},j.prototype.index=function(){return this._index},j.prototype.atoms=function(){return this._atoms},j.prototype.chain=function(){return this._chain},j.prototype.structure=function(){return this._chain.structure()},derive(k,g),k.prototype.addBond=function(a){this._bonds.push(a)},k.prototype.name=function(){return this._name},k.prototype.bonds=function(){return this._bonds},k.prototype.residue=function(){return this._residue},k.prototype.structure=function(){return this._residue.structure()},k.prototype.full=function(){return this},k.prototype.qualifiedName=function(){return this.residue().qualifiedName()+"."+this.name()};var t=function(a,b){var c={atom_one:a,atom_two:b};return{atom_one:function(){return c.atom_one},atom_two:function(){return c.atom_two},mid_point:function(a){return a||(a=vec3.create()),vec3.add(a,c.atom_one.pos(),c.atom_two.pos()),vec3.scale(a,a,.5),a}}};return derive(l,c),l.prototype.full=function(){return this._mol},l.prototype.addChain=function(a,b){var c=new m(this,a.full());if(this._chains.push(c),b)for(var d=a.residues(),e=0;e<d.length;++e)c.addResidue(d[e],!0);return c},l.prototype.containsResidue=function(a){if(!a)return!1;var b=this.chain(a.chain().name());return b?b.containsResidue(a):!1},l.prototype.chains=function(){return this._chains},l.prototype.chain=function(a){for(var b=0;b<this._chains.length;++b)if(this._chains[b].name()===a)return this._chains[b];return null},derive(m,e),m.prototype.addResidue=function(a,b){var c=new n(this,a.full());if(this._residues.push(c),this._residueMap[a.full().index()]=c,b)for(var d=a.atoms(),e=0;e<d.length;++e)c.addAtom(d[e].full());return c},m.prototype.containsResidue=function(a){var b=this._residueMap[a.full().index()];return void 0===b?!1:b.full()===a.full()},m.prototype.eachBackboneTrace=function(a){for(var b=this._chain.backboneTraces(),c=0;c<b.length;++c)for(var d=b[c].subsets(this._residues),e=0;e<d.length;++e)a(d[e])},m.prototype.backboneTraces=function(){var a=[];return this.eachBackboneTrace(function(b){a.push(b)}),a},m.prototype.full=function(){return this._chain},m.prototype.name=function(){return this._chain.name()},m.prototype.structure=function(){return this._molView},derive(n,f),n.prototype.addAtom=function(a){var b=new o(this,a.full());this._atoms.push(b)},n.prototype.full=function(){return this._residue},n.prototype.num=function(){return this._residue.num()
},n.prototype.ss=function(){return this._residue.ss()},n.prototype.index=function(){return this._residue.index()},n.prototype.chain=function(){return this._chainView},n.prototype.name=function(){return this._residue.name()},n.prototype.atoms=function(){return this._atoms},n.prototype.qualifiedName=function(){return this._residue.qualifiedName()},derive(o,g),o.prototype.full=function(){return this._atom},o.prototype.name=function(){return this._atom.name()},o.prototype.pos=function(){return this._atom.pos()},o.prototype.element=function(){return this._atom.element()},o.prototype.residue=function(){return this._resView},o.prototype.bonds=function(){return this._atom.bonds()},o.prototype.index=function(){return this._atom.index()},o.prototype.qualifiedName=function(){return this._atom.qualifiedName()},a.mol={},a.mol.Mol=h,a.mol.Chain=i,a.mol.Residue=j,a.mol.Atom=k,a.mol.MolView=l,a.mol.ChainView=m,a.mol.ResidueView=n,a.mol.AtomView=o,a.mol.pdb=r,!0}(this),BackboneTrace.prototype.push=function(a){this._trace.push(a)},BackboneTrace.prototype.length=function(){return this._trace.length},BackboneTrace.prototype.residueAt=function(a){return this._trace[a]},BackboneTrace.prototype.posAt=function(a,b){return vec3.copy(a,this._trace[b].atom("CA").pos()),a},BackboneTrace.prototype.normalAt=function(a,b){return vec3.sub(a,this._trace[b].atom("O").pos(),this._trace[b].atom("C").pos()),vec3.normalize(a,a),a},BackboneTrace.prototype.smoothPosAt=BackboneTrace.prototype.posAt,BackboneTrace.prototype.smoothNormalAt=BackboneTrace.prototype.normalAt,BackboneTrace.prototype.centralAtomAt=function(a){return this._trace[a].atom("CA")},BackboneTrace.prototype.tangentAt=function(){var a=vec3.create(),b=vec3.create();return function(c,d){d>0?this.posAt(a,d-1):this.posAt(a,d),d<this._trace.length-1?this.posAt(b,d+1):this.posAt(b,d),vec3.sub(c,b,a)}}(),BackboneTrace.prototype.fullTraceIndex=function(a){return a},BackboneTrace.prototype.subsets=function(a){for(var b=0,c=0,d=[];c<a.length&&b<this._trace.length;){for(var e=a[c].full().index();this._trace.length>b&&this._trace[b].index()<e;)++b;if(b>=this._trace.length)break;for(var f=this._trace[b].index();a.length>c&&a[c].full().index()<f;)++c;if(c>=a.length)break;for(var g=b,h=c;a.length>c&&this._trace.length>b&&a[c].full().index()===this._trace[b].index();)++c,++b;var i=c,j=b;d.push(new TraceSubset(this,g,j,a.slice(h,i)))}return d},TraceSubset.prototype.length=function(){return this._length},TraceSubset.prototype.residueAt=function(a){return this._fullTrace.residueAt(this._fullTraceBegin+a)},TraceSubset.prototype._interpolate=function(){vec3.create();var a=vec3.create(),b=vec3.create();return function(c,d,e,f){return this.tangentAt(a,d),this.tangentAt(b,e),vec3.scale(a,a,f),vec3.scale(b,b,f),geom.cubicHermiteInterpolate(c,this.centralAtomAt(d).pos(),a,this.centralAtomAt(e).pos(),b,.5,0),c}}(),TraceSubset.prototype.smoothPosAt=function(){return vec3.create(),vec3.create(),vec3.create(),function(a,b,c){if(0===b&&!this._isNTerminal)return this._interpolate(a,b,b+1,c);if(b===this._length-1&&!this._isCTerminal)return this._interpolate(a,b-1,b,c);var d=this.centralAtomAt(b);return vec3.copy(a,d.pos()),a}}(),TraceSubset.prototype.smoothNormalAt=function(){return function(a,b){return this._fullTrace.normalAt(a,b+this._fullTraceBegin),a}}(),TraceSubset.prototype.posAt=function(a,b){var c=this.centralAtomAt(b),d=null;return vec3.copy(a,c.pos()),0!==b||this._isNTerminal||(d=this.centralAtomAt(b+1),vec3.add(a,a,d.pos()),vec3.scale(a,a,.5)),b!==this._length-1||this._isCTerminal||(d=this.centralAtomAt(b-1),vec3.add(a,a,d.pos()),vec3.scale(a,a,.5)),a},TraceSubset.prototype.centralAtomAt=function(a){return this.residueAt(a).atom("CA")},TraceSubset.prototype.fullTraceIndex=function(a){return this._fullTraceBegin+a},TraceSubset.prototype.tangentAt=function(a,b){return this._fullTrace.tangentAt(a,b+this._fullTraceBegin)};var render=function(){"use strict";var a={},b=.7071,c=[-b,-b,0,b,-b,0,b,b,0,-b,b,0],d=[-6*b,-1*b,0,6*b,-1*b,0,6*b,1*b,0,-6*b,1*b,0];!function(){var a=vec3.create(),b=vec3.create(),c=vec3.create();return function(d,e,f){vec3.set(a,d[3*(e-1)],d[3*(e-1)+1],d[3*(e-1)+2]),vec3.set(c,d[3*e],d[3*e+1],d[3*e+2]);for(var g=e+1;f>g;++g)vec3.set(b,d[3*g],d[3*g+1],d[3*g+2]),d[3*(g-1)]=.25*b[0]+.5*c[0]+.25*a[0],d[3*(g-1)+1]=.25*b[1]+.5*c[1]+.25*a[1],d[3*(g-1)+2]=.25*b[2]+.5*c[2]+.25*a[2],vec3.copy(a,c),vec3.copy(c,b)}}();var e=function(){return function(a,b,c,d,e){e?vec3.cross(d,b,c):geom.ortho(d,b),vec3.cross(c,d,b),vec3.normalize(d,d),vec3.normalize(c,c),a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=d[0],a[4]=d[1],a[5]=d[2],a[6]=b[0],a[7]=b[1],a[8]=b[2]}}();a.spheres=function(a,b,c){console.time("spheres");var d=vec3.create(),e=new MeshGeom(b),f=new ProtoSphere(c.sphereDetail,c.sphereDetail),g=new AtomVertexAssoc(a,!0);c.color.begin(a);var h=a.atomCount(),i=c.idPool.getContinuousRange(h);return e.addIdRange(i),a.eachAtom(function(a){c.color.colorFor(a,d,0);var b=e.numVerts(),h=i.nextId(a);f.addTransformed(e,a.pos(),1.5,d,h);var j=e.numVerts();g.addAssoc(a,b,j)}),e.setVertAssoc(g),console.timeEnd("spheres"),c.color.end(a),e},a.ballsAndSticks=function(){var a=vec3.create(),b=vec3.create(),c=vec3.create(),d=vec3.create(),f=vec3.create(),g=mat3.create();return function(h,i,j){console.time("ballsAndSticks");var k=new MeshGeom(i),l=new AtomVertexAssoc(h,!0),m=new ProtoSphere(j.sphereDetail,j.sphereDetail),n=new ProtoCylinder(j.arcDetail),o=h.atomCount(),p=j.idPool.getContinuousRange(o);return k.addIdRange(p),j.color.begin(h),h.eachAtom(function(h){var i=p.nextId(h),o=k.numVerts();j.color.colorFor(h,c,0),m.addTransformed(k,h.pos(),j.radius,c,i),h.eachBond(function(l){l.mid_point(a),vec3.sub(b,h.pos(),a);var m=vec3.length(b);vec3.scale(b,b,1/m),e(g,b,d,f,!1),vec3.add(a,a,h.pos()),vec3.scale(a,a,.5),n.addTransformed(k,a,m,j.radius,g,c,c,i)});var q=k.numVerts();l.addAssoc(h,o,q)}),k.setVertAssoc(l),j.color.end(h),console.timeEnd("ballsAndSticks"),k}}(),a.lines=function(a,b,c){console.time("lines");var d=vec3.create(),e=new LineGeom(b);e.setLineWidth(c.lineWidth);var f=vec3.create(),g=new AtomVertexAssoc(a,!0);c.color.begin(a);var h=a.atomCount(),i=c.idPool.getContinuousRange(h);return e.addIdRange(i),a.eachAtom(function(a){var b=e.numVerts(),h=i.nextId(a);if(a.bonds().length)a.eachBond(function(b){b.mid_point(d),c.color.colorFor(a,f,0),e.addLine(a.pos(),f,d,f,h,h)});else{var j=.2,k=a.pos();c.color.colorFor(a,f,0),e.addLine([k[0]-j,k[1],k[2]],f,[k[0]+j,k[1],k[2]],f,h,h),e.addLine([k[0],k[1]-j,k[2]],f,[k[0],k[1]+j,k[2]],f,h,h),e.addLine([k[0],k[1],k[2]-j],f,[k[0],k[1],k[2]+j],f,h,h)}var l=e.numVerts();g.addAssoc(a,b,l)}),e.setVertAssoc(g),c.color.end(a),console.timeEnd("lines"),e},a.lineTrace=function(){var a=vec3.create(),b=vec3.create(),c=vec3.create(),d=vec3.create();return function(e,f,g){function h(e){j.addAssoc(l,0,i.numVerts(),i.numVerts()+1);var f,h=new Float32Array(3*e.length()),k=g.idPool.getContinuousRange(e.length()),m=k.nextId(e.residueAt(0));i.addIdRange(k);for(var n=1;n<e.length();++n){g.color.colorFor(e.centralAtomAt(n-1),a,0),h[3*(n-1)]=a[0],h[3*(n-1)+1]=a[1],h[3*(n-1)+2]=a[2],g.color.colorFor(e.centralAtomAt(n),b,0),e.posAt(c,n-1),e.posAt(d,n),f=k.nextId(e.residueAt(n)),i.addLine(c,a,d,b,m,f),m=f,f=null;var o=i.numVerts();j.addAssoc(l,n,o-1,o+(n===e.length()-1?0:1))}h[3*e.length()-3]=b[0],h[3*e.length()-2]=b[1],h[3*e.length()-1]=b[2],j.setPerResidueColors(l,h),l+=1}console.time("lineTrace");var i=new LineGeom(f),j=new TraceVertexAssoc(e,1,!0);i.setLineWidth(g.lineWidth),g.color.begin(e);for(var k=e.chains(),l=0,m=0;m<k.length;++m){var n=k[m];n.eachBackboneTrace(h)}return i.setVertAssoc(j),g.color.end(e),console.timeEnd("lineTrace"),i}}(),a.sline=function(a,b,c){function d(a){var b=a.fullTraceIndex(0),d=new Float32Array(3*a.length()),m=new Float32Array(3*a.length()),o=[],p=c.idPool.getContinuousRange(a.length());for(e.addIdRange(p),g=0;g<a.length();++g){var q=a.centralAtomAt(g);a.smoothPosAt(i,g,c.strength),c.color.colorFor(q,m,3*g),d[3*g]=i[0],d[3*g+1]=i[1],d[3*g+2]=i[2],o.push(p.nextId(q.residue()))}var r=o[0],s=0;f.setPerResidueColors(n,m);var t=geom.catmullRomSpline(d,c.splineDetail,c.strength,!1),u=interpolateColor(m,c.splineDetail),v=e.numVerts();f.addAssoc(n,b,v,v+1);var w=Math.floor(c.splineDetail/2);for(g=1,h=t.length/3;h>g;++g){i[0]=t[3*(g-1)],i[1]=t[3*(g-1)+1],i[2]=t[3*(g-1)+2],j[0]=t[3*(g-0)],j[1]=t[3*(g-0)+1],j[2]=t[3*(g-0)+2],k[0]=u[3*(g-1)],k[1]=u[3*(g-1)+1],k[2]=u[3*(g-1)+2],l[0]=u[3*(g-0)],l[1]=u[3*(g-0)+1],l[2]=u[3*(g-0)+2];var x=Math.floor((g+w)/c.splineDetail);s=o[Math.min(o.length-1,x)],e.addLine(i,k,j,l,r,s),r=s;var y=e.numVerts();f.addAssoc(n,b+g,y-1,y+(g===a.length-1?0:1))}n+=1}console.time("sline");var e=new LineGeom(b);c.color.begin(a);var f=new TraceVertexAssoc(a,c.splineDetail,1,!0);e.setLineWidth(c.lineWidth);for(var g,h,i=vec3.create(),j=vec3.create(),k=vec3.create(),l=vec3.create(),m=a.chains(),n=0,o=0;o<m.length;++o){var p=m[o];p.eachBackboneTrace(d)}return e.setVertAssoc(f),c.color.end(a),console.timeEnd("sline"),e},a.trace=function(a,b,c){console.time("trace");var d=new CompositeGeom(a);c.protoCyl=new ProtoCylinder(c.arcDetail),c.protoSphere=new ProtoSphere(c.sphereDetail,c.sphereDetail),c.color.begin(a);for(var e=a.chains(),f=0;f<e.length;++f){var g=e[f],h=i(g,b,c);h&&d.addGeom(h)}return c.color.end(a),console.timeEnd("trace"),d},a.cartoon=function(a,b,e){console.time("cartoon"),e.coilProfile=new TubeProfile(c,e.arcDetail,1),e.helixProfile=new TubeProfile(d,e.arcDetail,.1),e.strandProfile=new TubeProfile(d,e.arcDetail,.1);var f=new CompositeGeom(a),g=a.chains();e.color.begin(a);for(var i=0,j=g.length;j>i;++i){var k=h(g[i],b,e);k&&f.addGeom(k)}return console.timeEnd("cartoon"),e.color.end(a),f};var f=function(){var a=mat3.create(),b=vec3.create();return function(c,d,f,g,h,i,j,k,l,m){var n=g.ss(),o=k.coilProfile;"H"!==n||k.forceTube?"E"!==n||k.forceTube?j?geom.ortho(f,h):vec3.cross(f,b,h):o=k.strandProfile:o=k.helixProfile,e(a,h,f,b,!0),o.addTransformed(c,d,k.radius,a,i,j,l,m)}}(),g=function(){var a=vec3.create(),b=vec3.create(),c=vec3.create();return function(d,e,f,g,h,i,j){var k=null,l=null;vec3.set(c,0,0,0);for(var m=0;m<d.length();++m){h.push(i.nextId(d.residueAt(m))),d.smoothPosAt(a,m,j.strength),f[3*m]=a[0],f[3*m+1]=a[1],f[3*m+2]=a[2],d.smoothNormalAt(b,m,j.strength);var n=d.centralAtomAt(m);j.color.colorFor(n,e,3*m),vec3.dot(b,c)<0&&vec3.scale(b,b,-1),"E"!==d.residueAt(m).ss()||j.force_tube||(null===k&&(k=m),l=m),g[3*m]=f[3*m]+b[0]+c[0],g[3*m+1]=f[3*m+1]+b[1]+c[1],g[3*m+2]=f[3*m+2]+b[2]+c[2],vec3.copy(c,b)}}}(),h=function(){var a=vec3.create(),b=vec3.create(),c=(vec3.create(),vec3.create()),d=vec3.create(),e=vec3.create();return mat3.create(),function(h,i,j){var k=h.backboneTraces();if(0===k.length)return null;for(var l=new MeshGeom(i),m=new TraceVertexAssoc(h.asView(),j.splineDetail,!1),n=0;n<k.length;++n){var o=k[n],p=new Float32Array(3*o.length()),q=new Float32Array(3*o.length()),r=new Float32Array(3*o.length()),s=[],t=j.idPool.getContinuousRange(o.length());g(o,q,p,r,s,t,j),l.addIdRange(t);var u=geom.catmullRomSpline(p,j.splineDetail,j.strength,!1),v=geom.catmullRomSpline(r,j.splineDetail,j.strength,!1);m.setPerResidueColors(n,q);var w=interpolateColor(q,j.splineDetail);vec3.set(a,u[3]-u[0],u[4]-u[1],u[5]-u[2]),vec3.set(b,u[0],u[1],u[2]),vec3.set(d,v[0]-u[0],v[1]-u[0],v[2]-u[2]),vec3.normalize(a,a),vec3.normalize(d,d),vec3.set(c,w[0],w[1],w[2]);var x=l.numVerts();f(l,b,d,o.residueAt(0),a,c,!0,j,0,s[0]);var y=l.numVerts(),z=0;m.addAssoc(n,z,x,y),z+=1;for(var A=Math.floor(j.splineDetail/2),B=1,C=u.length/3;C>B;++B){var D=3*B,E=3*(B+1),F=3*(B-1);vec3.set(b,u[D],u[D+1],u[D+2]),vec3.set(a,u[E]-u[F],u[E+1]-u[F+1],u[E+2]-u[F+2]),vec3.normalize(a,a),vec3.set(c,w[D],w[D+1],w[D+2]);var G=0,H=Math.floor(B/j.splineDetail),I=Math.floor((B-1)/j.splineDetail);if(H!==I&&!j.forceTube&&"C"===o.residueAt(I).ss()&&("H"===o.residueAt(H).ss()||"E"===o.residueAt(H).ss())){vec3.set(e,v[F]-u[F],v[F+1]-u[F+1],v[F+2]-u[F+2]),vec3.normalize(e,e);var J=2*Math.PI/(4*j.arcDetail),K=geom.signedAngle(d,e,a);G=Math.round(K/J),G=(G+4*j.arcDetail)%(4*j.arcDetail)}vec3.set(d,v[3*B]-u[D],v[D+1]-u[D+1],v[D+2]-u[D+2]),vec3.normalize(d,d),x=l.numVerts();var L=Math.floor((B+A)/j.splineDetail),M=s[Math.min(s.length-1,L)];f(l,b,d,o.residueAt(H),a,c,!1,j,G,M),y=l.numVerts(),m.addAssoc(n,z,x,y),z+=1}}return l.setVertAssoc(m),l}}(),i=function(){var a=mat3.create(),b=vec3.create(),c=vec3.create(),d=vec3.create(),f=vec3.create(),g=vec3.create(),h=vec3.create(),i=vec3.create(),j=vec3.create();return function(k,l,m){var n=k.backboneTraces();if(0===n.length)return null;for(var o=new MeshGeom(l),p=new TraceVertexAssoc(k.asView(),1,!1),q=0,r=0;r<n.length;++r){var s=n[r],t=m.idPool.getContinuousRange(s.length());o.addIdRange(t),m.color.colorFor(s.centralAtomAt(0),i,0);var u=o.numVerts();s.posAt(g,0);var v=t.nextId(s.residueAt(0)),w=0;m.protoSphere.addTransformed(o,g,m.radius,i,v);var x=null;p.addAssoc(q,0,u,x);var y=new Float32Array(3*s.length());y[0]=i[0],y[1]=i[1],y[2]=i[2];for(var z=1;z<s.length();++z){w=t.nextId(s.residueAt(z)),s.posAt(g,z-1),s.posAt(h,z),m.color.colorFor(s.centralAtomAt(z),j,0),y[3*z]=j[0],y[3*z+1]=j[1],y[3*z+2]=j[2],vec3.sub(b,h,g);var A=vec3.length(b);vec3.scale(b,b,1/A),e(a,b,c,d,!1),vec3.copy(f,g),vec3.add(f,f,h),vec3.scale(f,f,.5);var B=o.numVerts();m.protoCyl.addTransformed(o,f,A,m.radius,a,i,j,v,w),x=o.numVerts(),x-=(x-B)/2,m.protoSphere.addTransformed(o,h,m.radius,j,w),v=w,p.addAssoc(q,z,u,x),u=x,vec3.copy(i,j)}p.setPerResidueColors(q,y),p.addAssoc(q,s.length()-1,u,o.numVerts()),q+=1}return o.setVertAssoc(p),o}}();return a}();!function(a){"use strict";function b(a){this._projection=mat4.create(),this._modelview=mat4.create(),this._near=.1,this._far=400,this._fogNear=-5,this._fogFar=10,this._fog=!0,this._fogColor=vec3.fromValues(1,1,1),this._outlineColor=vec3.fromValues(.1,.1,.1),this._center=vec3.create(),this._zoom=50,this._rotation=mat4.create(),this._translation=mat4.create(),this._updateMat=!0,this._gl=a,this._currentShader=null,this.setViewportSize(a.viewportWidth,a.viewportHeight),mat4.translate(this._modelview,this._modelview,[0,0,-20])}b.prototype._updateIfRequired=function(){return this._updateMat?(mat4.identity(this._modelview),mat4.translate(this._modelview,this._modelview,[-this._center[0],-this._center[1],-this._center[2]]),mat4.mul(this._modelview,this._rotation,this._modelview),mat4.identity(this._translation),mat4.translate(this._translation,this._translation,[0,0,-this._zoom]),mat4.mul(this._modelview,this._translation,this._modelview),this._updateMat=!1,!0):!1},b.prototype.setViewportSize=function(a,b){this._updateMat=!0,mat4.identity(this._projection),mat4.perspective(this._projection,45,a/b,this._near,this._far)},b.prototype.setCenter=function(a){this._updateMat=!0,vec3.copy(this._center,a)},b.prototype.fog=function(a){return void 0!==a&&(this._fog=a),this._fog},b.prototype.rotateZ=function(){var a=mat4.create();return function(b){mat4.identity(a),this._updateMat=!0,mat4.rotate(a,a,b,[0,0,1]),mat4.mul(this._rotation,a,this._rotation)}}(),b.prototype.rotateX=function(){var a=mat4.create();return function(b){mat4.identity(a),this._updateMat=!0,mat4.rotate(a,a,b,[1,0,0]),mat4.mul(this._rotation,a,this._rotation)}}(),b.prototype.rotateY=function(){var a=mat4.create();return function(b){mat4.identity(a),this._updateMat=!0,mat4.rotate(a,a,b,[0,1,0]),mat4.mul(this._rotation,a,this._rotation)}}(),b.prototype.panX=function(a){return this.panXY(a,0)},b.prototype.panY=function(a){return this.panXY(0,a)},b.prototype.panXY=function(){var a=mat4.create(),b=vec3.create();return function(c,d){mat4.transpose(a,this._rotation),this._updateMat=!0,vec3.set(b,-c,d,0),vec3.transformMat4(b,b,a),vec3.add(b,b,this._center),this.setCenter(b)}}(),b.prototype.zoom=function(a){this._updateMat=!0;var b=1+.01*a;this._zoom=Math.min(1e3,Math.max(2,b*this._zoom))},b.prototype.currentShader=function(){return this._currentShader},b.prototype.bind=function(a){var b=!1;this._currentShader!==a&&(this._currentShader=a,this._gl.useProgram(a),b=!0),(this._updateIfRequired()||b)&&(this._gl.uniformMatrix4fv(a.projection,!1,this._projection),this._gl.uniformMatrix4fv(a.modelview,!1,this._modelview),a.rotation&&this._gl.uniformMatrix4fv(a.rotation,!1,this._rotation),this._gl.uniform1i(a.fog,this._fog),this._gl.uniform1f(a.fogFar,this._fogFar+this._zoom),this._gl.uniform1f(a.fogNear,this._fogNear+this._zoom),this._gl.uniform3fv(a.fogColor,this._fogColor),this._gl.uniform3fv(a.outlineColor,this._outlineColor))},a.Cam=b}(this),function(a){"use strict";function b(a,b){this._width=b.width,this._height=b.height,this._colorBufferWidth=this._width,this._colorBufferHeight=this._height,this._gl=a,this._colorHandle=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._colorHandle),this._depthHandle=this._gl.createRenderbuffer(),this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,this._depthHandle),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this._width,this._height),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,this._depthHandle),this._colorTexture=this._gl.createTexture(),this._initColorBuffer()}b.prototype.width=function(){return this._width},b.prototype.height=function(){return this._height},b.prototype.bind=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._colorHandle),this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,this._depthHandle),(this._colorBufferWidth!==this._width||this._colorBufferHeight!==this._height)&&this._resizeBuffers(),this._gl.viewport(0,0,this._width,this._height)},b.prototype._initColorBuffer=function(){this.bind(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._colorTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._width,this._height,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._colorTexture,0),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.release()},b.prototype._resizeBuffers=function(){this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,this._depthHandle),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this._width,this._height),this._gl.bindTexture(this._gl.TEXTURE_2D,this._colorTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._width,this._height,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._colorTexture,0),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,this._depthHandle),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._colorBufferWidth=this._width,this._colorBufferHeight=this._height},b.prototype.resize=function(a,b){this._width=a,this._height=b},b.prototype.release=function(){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,null)},a.FrameBuffer=b}(this),function(a){"use strict";a.shaders={},a.shaders.LINES_FS="\nprecision mediump float;\n\nvarying vec3 vertColor;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\n\nvoid main(void) {\n  gl_FragColor = vec4(vertColor, 1.0);\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) {\n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",a.shaders.HEMILIGHT_FS="\nprecision mediump float;\n\nvarying vec3 vertColor;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\n\nvoid main(void) {\n  float dp = dot(vertNormal, vec3(0.0, 0.0, 1.0));\n  float hemi = max(0.0, dp)*0.5+0.5;\n  gl_FragColor = vec4(vertColor*hemi, 1.0);\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) {\n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",a.shaders.HEMILIGHT_VS="\nattribute vec3 attrPos;\nattribute vec3 attrColor;\nattribute vec3 attrNormal;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec3 vertColor;\nvarying vec3 vertNormal;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 n = (modelviewMat * vec4(attrNormal, 0.0));\n  vertNormal = n.xyz;\n  vertColor = attrColor;\n}",a.shaders.OUTLINE_FS="\nprecision mediump float;\n\nuniform vec3 outlineColor;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\n\nvoid main() {\n  gl_FragColor = vec4(outlineColor, 1.0);\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) { \n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",a.shaders.OUTLINE_VS="\nprecision mediump float;\n\nattribute vec3 attrPos;\nattribute vec3 attrNormal;\n                                                                       \nuniform vec3 outlineColor;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 normal = modelviewMat * vec4(attrNormal, 0.0);\n  gl_Position.xy += normal.xy*0.200;\n}",a.shaders.TEXT_VS="\nprecision mediump float;\n\nattribute vec3 attrCenter;\nattribute vec2 attrCorner;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform mat4 rotationMat;\nvarying vec2 vertTex;\nvoid main() { \n  vec4 rotated = vec4(attrCorner.x, attrCorner.y, 0.0, 0.0)*rotationMat;\n  vec4 adjustedPos = vec4(attrCenter, 1.0)+rotated;\n  gl_Position = projectionMat* modelviewMat* adjustedPos;\n  vertTex = (attrCorner+abs(attrCorner))/(2.0*abs(attrCorner)); \n}",a.shaders.TEXT_FS="\nprecision mediump float;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform sampler2D sampler;\nuniform float xScale;\nuniform float yScale;\nvarying vec2 vertTex;\nvoid main() { \n  gl_FragColor = texture2D(sampler, vec2(vertTex.x*xScale, vertTex.y*yScale));\n}",a.shaders.SELECT_VS="\nprecision mediump float;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nattribute vec3 attrPos;\nattribute float attrObjId;\n\nvarying float objId;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  objId = attrObjId;\n}",a.shaders.SELECT_FS="\nprecision mediump float;\n\nvarying float objId;\n\nint intMod(int x, int y) { \n  int z = x/y;\n  return x-y*z;\n}\nvoid main(void) {\n  int integralObjId = int(objId+0.5);\n  int red = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int green = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int blue = intMod(integralObjId, 256);\n  gl_FragColor = vec4(float(red), float(green), float(blue), 255.0)/255.0;\n}"}(this);var pv=function(){"use strict";function a(a,b){return function(){return b.apply(a,arguments)}}function b(b,c){c=c||{},this._options={width:c.width||500,height:c.height||500,antialias:c.antialias,quality:c.quality||"low",style:c.style||"hemilight"},this._objects=[],this._domElement=b,this._redrawRequested=!1,this._resize=!1,this._canvas=document.createElement("canvas"),this._textureCanvas=document.createElement("canvas"),this._textureCanvas.style.display="none",this._2dcontext=this._textureCanvas.getContext("2d"),this._objectIdManager=new UniqueObjectIdPool;var d=b.getBoundingClientRect();"auto"===this._options.width&&(this._options.width=d.width),"auto"===this._options.height&&(this._options.height=d.height),this._options.outline="outline"in c?c.outline:!0,this._ok=!1,this.quality(this._options.quality),this._canvas.width=this._options.width,this._canvas.height=this._options.height,this._domElement.appendChild(this._canvas),this._domElement.appendChild(this._textureCanvas),document.addEventListener("DOMContentLoaded",a(this,this._initPV))}var c='<div style="vertical-align:middle; text-align:center;"><h1>Oink</h1><p>Your browser does not support WebGL. You might want to try Chrome, Firefox, IE 11, or newer versions of Safari</p><p>If you are using a recent version of one of the above browsers, your graphic card might be blocked. Check the browser documentation for details</p></div>',d=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();return b.prototype._ensureSize=function(){this._resize&&(this._resize=!1,this._options.realWidth=this._options.width*this._options.samples,this._options.realHeight=this._options.height*this._options.samples,this._gl.viewport(0,0,this._options.realWidth,this._options._realHeight),this._canvas.width=this._options.realWidth,this._canvas.height=this._options.realHeight,this._cam.setViewportSize(this._options.realWidth,this._options.realHeight),this._options.samples>1&&this._initManualAntialiasing(this._options.samples),this._pickBuffer.resize(this._options.width,this._options.height))},b.prototype.resize=function(a,b){(a!==this._options.width||b!==this._options.height)&&(this._resize=!0,this._options.width=a,this._options.height=b,this.requestRedraw())},b.prototype.fitParent=function(){var a=this._domElement.getBoundingClientRect();this.resize(a.width,a.height)},b.prototype.gl=function(){return this._gl},b.prototype.ok=function(){return this._ok},b.prototype.options=function(a,b){return void 0!==b?("fog"===a?this._cam.fog(b):this._options[a]=b,b):this._options[a]},b.prototype.quality=function(a){return this._options.quality=a,console.info("setting quality to",a),"high"===a?(this._options.arcDetail=4,this._options.sphereDetail=16,this._options.splineDetail=8,void 0):"medium"===a?(this._options.arcDetail=3,this._options.sphereDetail=10,this._options.splineDetail=4,void 0):"low"===a?(this._options.arcDetail=2,this._options.sphereDetail=8,this._options.splineDetail=2,void 0):(console.error("invalid quality argument",a),void 0)},b.prototype.imageData=function(){return this._canvas.toDataURL()},b.prototype._initContext=function(){try{var a={antialias:this._options.antialias,preserveDrawingBuffer:!0};this._gl=this._canvas.getContext("experimental-webgl",a)}catch(b){return console.error("WebGL not supported",b),!1}return this._gl?!0:(console.error("WebGL not supported"),!1)},b.prototype._initManualAntialiasing=function(a){var b=1/a,c=.5*-(1-b)*this._options.realWidth,d=.5*-(1-b)*this._options.realHeight,e="translate("+c+"px, "+d+"px)",f="scale("+b+", "+b+")",g=e+" "+f;this._canvas.style.webkitTransform=g,this._canvas.style.transform=g,this._canvas.style.ieTransform=g,this._canvas.width=this._options.realWidth,this._canvas.height=this._options.realHeight},b.prototype._initPickBuffer=function(){var a={width:this._options.width,height:this._options.height};this._pickBuffer=new FrameBuffer(this._gl,a)},b.prototype._initGL=function(){var a=1;return this._initContext()?(!this._gl.getContextAttributes().antialias&&this._options.antialias&&(console.info("hardware antialising not supported.","will use manual antialiasing instead."),a=2),this._options.realWidth=this._options.width*a,this._options.realHeight=this._options.height*a,this._options.samples=a,a>1&&this._initManualAntialiasing(a),this._gl.viewportWidth=this._options.realWidth,this._gl.viewportHeight=this._options.realHeight,this._gl.clearColor(1,1,1,1),this._gl.lineWidth(2),this._gl.cullFace(this._gl.FRONT),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.DEPTH_TEST),this._initPickBuffer(),!0):!1},b.prototype._shaderFromString=function(a,b){var c;if("fragment"===b)c=this._gl.createShader(this._gl.FRAGMENT_SHADER);else{if("vertex"!==b)return console.error("could not determine type for shader"),null;c=this._gl.createShader(this._gl.VERTEX_SHADER)}return this._gl.shaderSource(c,a),this._gl.compileShader(c),this._gl.getShaderParameter(c,this._gl.COMPILE_STATUS)?c:(console.error(this._gl.getShaderInfoLog(c)),null)},b.prototype._initShader=function(b,c){var d=this._shaderFromString(c,"fragment"),e=this._shaderFromString(b,"vertex"),f=this._gl.createProgram();if(this._gl.attachShader(f,e),this._gl.attachShader(f,d),this._gl.linkProgram(f),!this._gl.getProgramParameter(f,this._gl.LINK_STATUS))return console.error("could not initialise shaders"),console.error(this._gl.getShaderInfoLog(f)),null;var g=a(this._gl,this._gl.getAttribLocation),h=a(this._gl,this._gl.getUniformLocation);return f.posAttrib=g(f,"attrPos"),f.colorAttrib=g(f,"attrColor"),f.normalAttrib=g(f,"attrNormal"),f.objIdAttrib=g(f,"attrObjId"),f.projection=h(f,"projectionMat"),f.modelview=h(f,"modelviewMat"),f.rotation=h(f,"rotationMat"),f.fog=h(f,"fog"),f.fogFar=h(f,"fogFar"),f.fogNear=h(f,"fogNear"),f.fogColor=h(f,"fogColor"),f.outlineColor=h(f,"outlineColor"),f},b.prototype._mouseUp=function(){this._canvas.removeEventListener("mousemove",this._mouseRotateListener,!1),this._canvas.removeEventListener("mousemove",this._mousePanListener,!1),this._canvas.removeEventListener("mouseup",this._mouseUpListener,!1),document.removeEventListener("mouseup",this._mouseUpListener,!1),document.removeEventListener("mousemove",this._mouseRotateListener),document.removeEventListener("mousemove",this._mousePanListener)},b.prototype._initPV=function(){return this._initGL()?(this._ok=!0,this._cam=new Cam(this._gl),this._shaderCatalog={hemilight:this._initShader(shaders.HEMILIGHT_VS,shaders.HEMILIGHT_FS),outline:this._initShader(shaders.OUTLINE_VS,shaders.OUTLINE_FS),lines:this._initShader(shaders.HEMILIGHT_VS,shaders.LINES_FS),text:this._initShader(shaders.TEXT_VS,shaders.TEXT_FS),select:this._initShader(shaders.SELECT_VS,shaders.SELECT_FS)},this._mousePanListener=a(this,this._mousePan),this._mouseRotateListener=a(this,this._mouseRotate),this._mouseUpListener=a(this,this._mouseUp),this._boundDraw=a(this,this._draw),"onwheel"in this._canvas?this._canvas.addEventListener("wheel",a(this,this._mouseWheelFF),!1):this._canvas.addEventListener("mousewheel",a(this,this._mouseWheel),!1),this._canvas.addEventListener("dblclick",a(this,this._mouseDoubleClick),!1),this._canvas.addEventListener("mousedown",a(this,this._mouseDown),!1),!0):(this._domElement.removeChild(this._canvas),this._domElement.innerHTML=c,this._domElement.style.width=this._options.width+"px",this._domElement.style.height=this._options.height+"px",!1)},b.prototype.requestRedraw=function(){this._redrawRequested||(this._redrawRequested=!0,d(this._boundDraw))},b.prototype._drawWithPass=function(a){for(var b=0,c=this._objects.length;b!==c;++b)this._objects[b].draw(this._cam,this._shaderCatalog,this._options.style,a)},b.prototype._draw=function(){this._ensureSize(),this._redrawRequested=!1,this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.viewport(0,0,this._options.realWidth,this._options.realHeight),this._gl.cullFace(this._gl.FRONT),this._gl.enable(this._gl.CULL_FACE),this._drawWithPass("normal"),this._options.outline&&(this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._drawWithPass("outline"))},b.prototype.centerOn=function(a){this._cam.setCenter(a.center())},b.prototype.clear=function(){for(var a=0;a<this._objects.length;++a)this._objects[a].destroy();this._objects=[]},b.prototype._mouseWheel=function(a){this._cam.zoom(.05*a.wheelDelta),this.requestRedraw()},b.prototype._mouseWheelFF=function(a){this._cam.zoom(2*-a.deltaY),this.requestRedraw()},b.prototype._mouseDoubleClick=function(a){var b=this._canvas.getBoundingClientRect(),c=this.pick({x:a.clientX-b.left,y:a.clientY-b.top});c.length>0&&(c[0].pos?this._cam.setCenter(c[0].pos()):this._cam.setCenter(c[0].atom("CA").pos()),this.requestRedraw())},b.prototype._mouseDown=function(a){0===a.button&&(a.preventDefault(),a.shiftKey===!0?(this._canvas.addEventListener("mousemove",this._mousePanListener,!1),document.addEventListener("mousemove",this._mousePanListener,!1)):(this._canvas.addEventListener("mousemove",this._mouseRotateListener,!1),document.addEventListener("mousemove",this._mouseRotateListener,!1)),this._canvas.addEventListener("mouseup",this._mouseUpListener,!1),document.addEventListener("mouseup",this._mouseUpListener,!1),this._lastMousePos={x:a.pageX,y:a.pageY})
},b.prototype._mouseRotate=function(a){var b={x:a.pageX,y:a.pageY},c={x:b.x-this._lastMousePos.x,y:b.y-this._lastMousePos.y},d=.005;this._cam.rotateX(d*c.y),this._cam.rotateY(d*c.x),this._lastMousePos=b,this.requestRedraw()},b.prototype._mousePan=function(a){var b={x:a.pageX,y:a.pageY},c={x:b.x-this._lastMousePos.x,y:b.y-this._lastMousePos.y},d=.05;this._cam.panXY(d*c.x,d*c.y),this._lastMousePos=b,this.requestRedraw()},b.prototype.RENDER_MODES=["sline","line","trace","lineTrace","cartoon","tube","spheres"],b.prototype.renderAs=function(a,b,c){for(var d=!1,e=0;e<this.RENDER_MODES.length;++e)if(this.RENDER_MODES[e]===b){d=!0;break}return d?this[b](a,c):(console.error("render mode",b,"not supported"),void 0)},b.prototype.lineTrace=function(a,b,c){c=c||{};var d={color:c.color||color.uniform([1,0,1]),lineWidth:c.lineWidth||4,idPool:this._objectIdManager},e=render.lineTrace(b,this._gl,d);return this.add(a,e)},b.prototype.spheres=function(a,b,c){c=c||{};var d={color:c.color||color.byElement(),sphereDetail:this.options("sphereDetail"),idPool:this._objectIdManager},e=render.spheres(b,this._gl,d);return this.add(a,e)},b.prototype.sline=function(a,b,c){c=c||{};var d={color:c.color||color.uniform([1,0,1]),splineDetail:c.splineDetail||this.options("splineDetail"),strength:c.strength||1,lineWidth:c.lineWidth||4,idPool:this._objectIdManager},e=render.sline(b,this._gl,d);return this.add(a,e)},b.prototype.cartoon=function(a,b,c){c=c||{};var d={color:c.color||color.bySS(),strength:c.strength||1,splineDetail:c.splineDetail||this.options("splineDetail"),arcDetail:c.arcDetail||this.options("arcDetail"),radius:c.radius||.3,forceTube:c.forceTube||!1,idPool:this._objectIdManager},e=render.cartoon(b,this._gl,d);return this.add(a,e)},b.prototype.tube=function(a,b,c){return c=c||{},c.forceTube=!0,this.cartoon(a,b,c)},b.prototype.ballsAndSticks=function(a,b,c){c=c||{};var d={color:c.color||color.byElement(),radius:c.radius||.3,arcDetail:2*(c.arcDetail||this.options("arcDetail")),sphereDetail:c.sphereDetail||this.options("sphereDetail"),idPool:this._objectIdManager},e=render.ballsAndSticks(b,this._gl,d);return this.add(a,e)},b.prototype.lines=function(a,b,c){c=c||{};var d={color:c.color||color.byElement(),lineWidth:c.lineWidth||4,idPool:this._objectIdManager},e=render.lines(b,this._gl,d);return this.add(a,e)},b.prototype.trace=function(a,b,c){c=c||{};var d={color:c.color||color.uniform([1,0,0]),radius:c.radius||.3,arcDetail:2*(c.arcDetail||this.options("arcDetail")),sphereDetail:c.sphereDetail||this.options("sphereDetail"),idPool:this._objectIdManager},e=render.trace(b,this._gl,d);return this.add(a,e)},b.prototype.label=function(a,b){return new TextLabel(this._gl,this._textureCanvas,this._2dcontext,a,b)},b.prototype._drawPickingScene=function(){this._gl.clearColor(0,0,0,0),this._gl.disable(this._gl.BLEND),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.clearColor(1,1,1,1),this._gl.cullFace(this._gl.FRONT),this._gl.enable(this._gl.CULL_FACE),this._drawWithPass("select")},b.prototype.pick=function(a){this._pickBuffer.bind(),this._drawPickingScene();var b=new Uint8Array(64);this._gl.readPixels(a.x-2,this._options.height-(a.y-2),4,4,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b),b.data&&(b=b.data);for(var c={},d=[],e=0;4>e;++e)for(var f=0;4>f;++f){var g=4*(4*e+f);if(0!==b[g+3]){var h=b[g+0]|b[g+1]<<8|b[g+2]<<16;if(void 0===c[h]){var i=this._objectIdManager.objectForId(h);void 0!==i&&(d.push(i),c[h]=!0)}}}return this._pickBuffer.release(),d},b.prototype.add=function(a,b){return b.name(a),this._objects.push(b),this.requestRedraw(),b},b.prototype._globToRegex=function(a){var b=a.replace(".","\\.").replace("*",".*");return new RegExp("^"+b+"$")},b.prototype.forEach=function(){var a,b="*";2===arguments.length?(a=arguments[1],b=arguments[0]):a=arguments[0];for(var c=this._globToRegex(b),d=0;d<this._objects.length;++d){var e=this._objects[d];c.test(e.name())&&a(e,d)}},b.prototype.get=function(a){for(var b=0;b<this._objects.length;++b)if(this._objects[b].name()===a)return this._objects[b];return console.error("could not find object with name",a),null},b.prototype.hide=function(a){this.forEach(a,function(a){a.hide()})},b.prototype.show=function(a){this.forEach(a,function(a){a.show()})},b.prototype.rm=function(){for(var a=[],b=this._globToRegex(pattern),c=0;c<this._objects.length;++c){var d=this._objects[c];b.test(d.name())||a.push(d),d.destroy()}this._objects=a},b.prototype.all=function(){return this._objects},{Viewer:function(a,c){return new b(a,c)}}}();