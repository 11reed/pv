var geom=function(){"use strict";function a(a,b,c,d){d=d||!1,c=c||.5;var f=null;f=d?new Float32Array(a.length*b):new Float32Array((a.length-3)*b);var g,h,i,j=0,k=1/b,l=vec3.create(),m=vec3.create(),n=vec3.create(),o=vec3.create(),p=vec3.create(),q=vec3.create();for(vec3.set(o,a[0],a[1],a[2]),vec3.set(p,a[3],a[4],a[5]),d?(vec3.set(n,a[a.length-3],a[a.length-2],a[a.length-1]),vec3.sub(l,p,n),vec3.scale(l,l,c)):(vec3.set(n,a[0],a[1],a[2]),vec3.set(l,0,0,0)),g=1,i=a.length/3-1;i>g;++g){for(vec3.set(q,a[3*(g+1)],a[3*(g+1)+1],a[3*(g+1)+2]),vec3.sub(m,q,o),vec3.scale(m,m,c),h=0;b>h;++h)e(f,o,l,p,m,k*h,j),j+=3;vec3.copy(n,o),vec3.copy(o,p),vec3.copy(p,q),vec3.copy(l,m)}for(d?(vec3.set(q,a[0],a[1],a[3]),vec3.sub(m,q,o),vec3.scale(m,m,c)):vec3.set(m,0,0,0),h=0;b>h;++h)e(f,o,l,p,m,k*h,j),j+=3;if(!d)return f[j]=a[a.length-3],f[j+1]=a[a.length-2],f[j+2]=a[a.length-1],f;for(vec3.copy(n,o),vec3.copy(o,p),vec3.copy(p,q),vec3.copy(l,m),vec3.set(q,a[3],a[4],a[5]),vec3.sub(m,q,o),vec3.scale(m,m,c),h=0;b>h;++h)e(f,o,l,p,m,k*h,j),j+=3;return f}var b=function(){var a=vec3.create();return function(b,c,d){return vec3.cross(a,b,c),Math.atan2(vec3.dot(a,d),vec3.dot(b,c))}}(),c=function(){var a=vec3.create();return function(b,c){return vec3.copy(a,c),Math.abs(c[0])<Math.abs(c[1])?Math.abs(c[0])<Math.abs(c[2])?a[0]+=1:a[2]+=1:Math.abs(c[1])<Math.abs(c[2])?a[1]+=1:a[2]+=1,vec3.cross(b,c,a)}}(),d=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=f*f,j=f*g,k=f*h,l=g*g,m=g*h,n=h*h;return a[0]=i+e-i*e,a[1]=j-e*j-d*h,a[2]=k-e*k+d*g,a[3]=j-e*j+d*h,a[4]=l+e-e*l,a[5]=m-e*m-d*f,a[6]=k-e*k-d*g,a[7]=m-e*m+d*f,a[8]=n+e-e*n,a},e=function(){var a=vec3.create();return function(b,c,d,e,f,g,h){var i=g*g,j=3-2*g,k=i*j,l=1-k,m=i*(g-2)+g,n=i*(g-1);vec3.copy(a,c),vec3.scale(a,a,l),vec3.scaleAndAdd(a,a,d,m),vec3.scaleAndAdd(a,a,e,k),vec3.scaleAndAdd(a,a,f,n),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2]}}();return{signedAngle:b,axisRotation:d,ortho:c,catmullRomSpline:a}}(),mol=function(){"use strict";function a(){}function b(){}function c(){}function d(){}function e(a){this._chains=[],this._pv=a,this._next_atom_index=0}function f(a,b){for(var c=0;c<b.length;++c)if(!b[c](a))return!1;return!0}function g(a,b){this._structure=a,this._name=b,this._residues=[]}function h(a,b,c){this._name=b,this._num=c,this._atoms=[],this._ss="C",this._chain=a}function i(a,b,c,d){this._residue=a,this._bonds=[],this._name=b,this._pos=c,this._element=d}function j(a){this._mol=a,this._pv=a._pv,this._chains=[]}function k(a,b){this._chain=b,this._residues=[],this._mol_view=a}function l(a,b){this._chain_view=a,this._atoms=[],this._residue=b}function m(a,b){this._res_view=a,this._atom=b,this._bonds=[]}function n(a){var b=parseInt(a.substr(21,4),10),c=parseInt(a.substr(33,4),10),d=a[19];return{first:b,last:c,chain_name:d}}function o(a){var b=parseInt(a.substr(22,4),10),c=parseInt(a.substr(33,4),10),d=a[21];return{first:b,last:c,chain_name:d}}function p(a){function b(a){var b=a[16];if(" "==b||"A"==b){var e=a[21],g=a.substr(17,3),h=a.substr(12,4).trim(),i=parseInt(a.substr(22,4),10);a[26];var j=!1,k=!1;d&&d.name()==e||(k=!0,j=!0),f&&f.num()==i||(j=!0),k&&(d=c.addChain(e)),j&&(f=d.addResidue(g,i));for(var l=vec3.create(),m=0;3>m;++m)l[m]=parseFloat(a.substr(30+8*m,8));f.addAtom(h,l,a.substr(76,2).trim())}}console.time("pdb");var c=new e,d=null,f=null,g=[],h=[],i=a.split(/\r\n|\r|\n/g),j=0;for(j=0;j<i.length;j++){var k=i[j],l=k.substr(0,6);if("ATOM  "!=l)if("HETATM"!=l)if("HELIX "!=l)if("SHEET "!=l){if("END"==l)break}else h.push(o(k));else g.push(n(k));else b(k,!0);else b(k,!1)}var m=null;for(j=0;j<h.length;++j){var p=h[j];m=c.chain(p.chain_name),m&&m.assign_ss(p.first,p.last,"E")}for(j=0;j<g.length;++j){var q=g[j];m=c.chain(q.chain_name),m&&m.assign_ss(q.first,q.last,"H")}return c.derive_connectivity(),console.timeEnd("PV.pdb"),c}a.prototype.eachResidue=function(a){for(var b=0;b<this._chains.length;b+=1)this._chains[b].eachResidue(a)},a.prototype.eachAtom=function(a){for(var b=0;b<this._chains.length;b+=1)this._chains[b].eachAtom(a)},a.prototype.center=function(){var a=vec3.create(),b=1;return this.eachAtom(function(c){vec3.add(a,a,c.pos()),b+=1}),b&&vec3.scale(a,a,1/b),a},b.prototype.eachAtom=function(a){for(var b=0;b<this._residues.length;b+=1)this._residues[b].eachAtom(a)},b.prototype.eachResidue=function(a){for(var b=0;b<this._residues.length;b+=1)a(this._residues[b])},b.prototype.residues=function(){return this._residues},b.prototype.structure=function(){return this._structure},b.prototype.eachBackboneTrace=function(a){for(var b=[],c=0;c<this._residues.length;c+=1){var d=this._residues[c];if(d.isAminoacid())if(0!==b.length){var e=this._residues[c-1].atom("C"),f=d.atom("N");Math.abs(vec3.sqrDist(e.pos(),f.pos())-2.25)<1?b.push(d):b.length>1&&(a(b),b=[])}else b.push(d);else b.length>1&&(a(b),b=[])}b.length>1&&a(b)},b.prototype.backboneTraces=function(){var a=[];return this.eachBackboneTrace(function(b){a.push(b)}),a},c.prototype.isWater=function(){return"HOH"==this.name()||"DOD"==this.name()},c.prototype.eachAtom=function(a){for(var b=0;b<this._atoms.length;b+=1)a(this._atoms[b])},c.prototype.qualifiedName=function(){return this.chain().name()+"."+this.name()+this.num()},c.prototype.atom=function(a){if("string"==typeof a)for(var b=0;b<this._atoms.length;++b)if(this._atoms[b].name()==a)return this._atoms[b];return this._atoms[a]},c.prototype.isAminoacid=function(){return this.atom("N")&&this.atom("CA")&&this.atom("C")&&this.atom("O")},d.prototype.name=function(){return this._name},d.prototype.pos=function(){return this._pos},d.prototype.element=function(){return this._element},d.prototype.index=function(){return this._index},d.prototype.eachBond=function(a){for(var b=0;b<this._bonds.length;++b)a(this._bonds[b])},e.prototype=new a,e.prototype.chains=function(){return this._chains},e.prototype.residueSelect=function(a){console.time("Mol.residueSelect");for(var b=new j(this),c=0;c<this._chains.length;++c)for(var d=this._chains[c],e=null,f=d.residues(),g=0;g<f.length;++g)a(f[g])&&(e||(e=b.addChain(d,!1)),e.addResidue(f[g],!0));return console.timeEnd("Mol.residueSelect"),b},e.prototype._atomPredicates=function(a){var b=[];return void 0!==a.aname&&b.push(function(b){return b.name()===a.aname}),void 0!==a.anames&&b.push(function(b){for(var c=b.name(),d=0;d<a.anames.length;++d)if(c===a.anames[d])return!0;return!1}),b},e.prototype._residuePredicates=function(a){var b=[];return void 0!==a.rname&&b.push(function(b){return b.name()===a.rname}),void 0!==a.rnames&&b.push(function(b){for(var c=b.name(),d=0;d<a.rnames.length;++d)if(c===a.rnames[d])return!0;return!1}),b},e.prototype._chainPredicates=function(a){var b=[];return void 0!==a.chain&&b.push(function(b){return b.name()===a.chain}),void 0!==a.chains&&b.push(function(b){for(var c=b.name(),d=0;d<a.chains.length;++d)if(c===a.chains[d])return!0;return!1}),b},e.prototype._dictSelect=function(a){for(var b=new j(this),c=this._residuePredicates(a),d=this._atomPredicates(a),e=this._chainPredicates(a),g=0;g<this._chains.length;++g){var h=this._chains[g];if(f(h,e)){var i,k,l=null,m=h.residues(),n=[];if(void 0!==a.rindexRange){for(i=a.rindexRange[0],k=Math.min(m.length,a.rindexRange[1]);k>i;++i)n.push(m[i]);m=n}else if(a.rindex&&void 0!==a.rindices.length){for(n=[],i=0;i<a.rindices.length;++i)n.push(m[a.rindices[i]]);m=n}for(var o=0;o<m.length;++o)if(f(m[o],c)){l||(l=b.addChain(h,!1));for(var p=null,q=m[o].atoms(),r=0;r<q.length;++r)f(q[r],d)&&(p||(p=l.addResidue(m[o],!1)),p.addAtom(q[r]))}}}return b},e.prototype.select=function(a){return"protein"==a?this.residueSelect(function(a){return a.isAminoacid()}):"water"==a?this.residueSelect(function(a){return a.isWater()}):"ligand"==a?this.residueSelect(function(a){return!a.isAminoacid()&&!a.isWater()}):this._dictSelect(a)},e.prototype.chain=function(a){for(var b=0;b<this._chains.length;++b)if(this._chains[b].name()==a)return this._chains[b];return null},e.prototype.next_atom_index=function(){var a=this._next_atom_index;return this._next_atom_index+=1,a},e.prototype.addChain=function(a){var b=new g(this,a);return this._chains.push(b),b},e.prototype.connect=function(a,b){var c=new q(a,b);return a.addBond(c),b.addBond(c),c},e.prototype.derive_connectivity=function(){console.time("Mol.derive_connectivity");var a,b=this;this.eachResidue(function(c){var d;vec3.create();for(var e=0;e<c.atoms().length;e+=1)for(var f=0;e>f;f+=1)d=vec3.sqrDist(c.atom(e).pos(),c.atom(f).pos()),1.6*1.6>d&&b.connect(c.atom(e),c.atom(f));if(a){var g=a.atom("C"),h=c.atom("N");g&&h&&(d=vec3.sqrDist(g.pos(),h.pos()),1.6*1.6>d&&b.connect(h,g))}a=c}),console.timeEnd("Mol.derive_connectivity")},g.prototype=new b,g.prototype.name=function(){return this._name},g.prototype.addResidue=function(a,b){var c=new h(this,a,b);return this._residues.push(c),c},g.prototype.assign_ss=function(a,b,c){for(var d=1;d<this._residues.length-1;++d){var e=this._residues[d];e.num()<=a||e.num()>=b||e.set_ss(c)}},h.prototype=new c,h.prototype.name=function(){return this._name},h.prototype.num=function(){return this._num},h.prototype.addAtom=function(a,b,c){var d=new i(this,a,b,c);return this._atoms.push(d),d},h.prototype.ss=function(){return this._ss},h.prototype.set_ss=function(a){this._ss=a},h.prototype.atoms=function(){return this._atoms},h.prototype.chain=function(){return this._chain},h.prototype.structure=function(){return this._chain.structure()},j.prototype=new a,j.prototype.addChain=function(a,b){var c=new k(this,a);if(this._chains.push(c),b)for(var d=a.residues(),e=0;e<d.length;++e)c.addResidue(d[e],!0);return c},k.prototype=new b,k.prototype.addResidue=function(a,b){var c=new l(this,a);if(this._residues.push(c),b)for(var d=a.atoms(),e=0;e<d.length;++e)c.addAtom(d[e]);return c},l.prototype=new c,l.prototype.addAtom=function(a){var b=new m(this,a);this._atoms.push(b)},i.prototype=new d,i.prototype.addBond=function(a){this._bonds.push(a)},i.prototype.name=function(){return this._name},i.prototype.bonds=function(){return this._bonds},i.prototype.residue=function(){return this._residue},i.prototype.structure=function(){return this._residue.structure()};var q=function(a,b){var c={atom_one:a,atom_two:b};return{atom_one:function(){return c.atom_one},atom_two:function(){return c.atom_two},mid_point:function(a){return a||(a=vec3.create()),vec3.add(a,c.atom_one.pos(),c.atom_two.pos()),vec3.scale(a,a,.5),a}}};k.prototype.name=function(){return this._chain.name()},m.prototype=new d,m.prototype.name=function(){return this._atom.name()},m.prototype.pos=function(){return this._atom.pos()},m.prototype.element=function(){return this._atom.element()},m.prototype.bonds=function(){return this._bonds};var r={};return r.Mol=e,r.Chain=g,r.Residue=h,r.Atom=i,r.MolView=j,r.ChainView=k,r.ResidueView=l,r.AtomView=m,r.pdb=p,r}(),render=function(){"use strict";function a(a,b){for(var c=new Float32Array((a.length-3)*b),d=0,e=vec3.create(),f=vec3.create(),g=1/b,h=0;h<a.length/3-1;++h){vec3.set(e,a[3*h],a[3*h+1],a[3*h+2]),vec3.set(f,a[3*h+3],a[3*h+4],a[3*h+5]);for(var i=0;b>i;++i){var j=g*i;c[d]=e[0]*(1-j)+f[0]*j,c[d+1]=e[1]*(1-j)+f[1]*j,c[d+2]=e[2]*(1-j)+f[2]*j,d+=3}}return c[d]=f[0],c[d+1]=f[1],c[d+2]=f[2],c}function b(){this._children=[]}!function(){var a=vec3.create(),b=vec3.create(),c=vec3.create();return function(d,e,f){vec3.set(a,d[3*(e-1)],d[3*(e-1)+1],d[3*(e-1)+2]),vec3.set(c,d[3*e],d[3*e+1],d[3*e+2]);for(var g=e+1;f>g;++g)vec3.set(b,d[3*g],d[3*g+1],d[3*g+2]),d[3*(g-1)]=.25*b[0]+.5*c[0]+.25*a[0],d[3*(g-1)+1]=.25*b[1]+.5*c[1]+.25*a[1],d[3*(g-1)+2]=.25*b[2]+.5*c[2]+.25*a[2],vec3.copy(a,c),vec3.copy(c,b)}}();var c=function(){return function(a,b,c,d,e){e?vec3.cross(d,b,c):geom.ortho(d,b),vec3.cross(c,d,b),vec3.normalize(d,d),vec3.normalize(c,c),a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=d[0],a[4]=d[1],a[5]=d[2],a[6]=b[0],a[7]=b[1],a[8]=b[2]}}(),d=function(a){var b={data:[],ready:!1,interleavedBuffer:a.createBuffer(),num_lines:0};return{draw:function(c){this.bind();var d=a.getAttribLocation(c,"attrPos");a.enableVertexAttribArray(d),a.vertexAttribPointer(d,3,a.FLOAT,!1,24,0);var e=a.getAttribLocation(c,"attrColor");a.vertexAttribPointer(e,3,a.FLOAT,!1,24,12),a.enableVertexAttribArray(e),a.drawArrays(a.LINES,0,2*b.num_lines),a.disableVertexAttribArray(d),a.disableVertexAttribArray(e)},requires_outline_pass:function(){return!1},bind:function(){if(a.bindBuffer(a.ARRAY_BUFFER,b.interleavedBuffer),!b.ready){var c=new Float32Array(b.data);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW),b.ready=!0,b.data=[]}},addLine:function(a,c,d,e){b.data.push(a[0]),b.data.push(a[1]),b.data.push(a[2]),b.data.push(c[0]),b.data.push(c[1]),b.data.push(c[2]),b.data.push(d[0]),b.data.push(d[1]),b.data.push(d[2]),b.data.push(e[0]),b.data.push(e[1]),b.data.push(e[2]),b.num_lines+=1,b.ready=!1}}},e=function(a,b){var c,d,e={arcs:b,stacks:a,indices:new Uint16Array(2*3*b*a),verts:new Float32Array(3*b*a)},f=Math.PI/(a-1),g=2*Math.PI/b;for(c=0;c<e.stacks;++c){var h=Math.sin(c*f),i=Math.cos(c*f);for(d=0;d<e.arcs;++d){var j=h*Math.cos(d*g),k=h*Math.sin(d*g);e.verts[3*(d+c*e.arcs)]=j,e.verts[3*(d+c*e.arcs)+1]=k,e.verts[3*(d+c*e.arcs)+2]=i}}var l=0;for(c=0;c<e.stacks-1;++c)for(d=0;d<e.arcs;++d)e.indices[l]=c*e.arcs+d,e.indices[l+1]=c*e.arcs+(d+1)%e.arcs,e.indices[l+2]=(c+1)*e.arcs+d,l+=3,e.indices[l]=c*e.arcs+(d+1)%e.arcs,e.indices[l+1]=(c+1)*e.arcs+(d+1)%e.arcs,e.indices[l+2]=(c+1)*e.arcs+d,l+=3;var m=vec3.create(),n=vec3.create();return{addTransformed:function(a,b,c,d){for(var f=a.numVerts(),g=0;g<e.stacks*e.arcs;++g)vec3.set(n,e.verts[3*g],e.verts[3*g+1],e.verts[3*g+2]),vec3.copy(m,n),vec3.scale(m,m,c),vec3.add(m,m,b),a.addVertex(m,n,d);for(g=0;g<e.indices.length/3;++g)a.addTriangle(f+e.indices[3*g],f+e.indices[3*g+1],f+e.indices[3*g+2])},num_indices:function(){return e.indices.length},num_vertices:function(){return e.verts.length}}},f=function(a,b,c){for(var d=geom.catmullRomSpline(a,b,c,!0),e={indices:new Uint16Array(2*d.length),verts:d,normals:new Float32Array(d.length),arcs:d.length/3},f=vec3.create(),g=0;g<e.arcs;++g){var h=0===g?e.arcs-1:g-1,i=g===e.arcs-1?0:g+1;f[0]=e.verts[3*i+1]-e.verts[3*h+1],f[1]=e.verts[3*h]-e.verts[3*i],vec3.normalize(f,f),e.normals[3*g]=f[0],e.normals[3*g+1]=f[1],e.normals[3*g+2]=f[2]}for(g=0;g<e.arcs;++g)e.indices[6*g]=g,e.indices[6*g+1]=g+e.arcs,e.indices[6*g+2]=(g+1)%e.arcs+e.arcs,e.indices[6*g+3]=g,e.indices[6*g+4]=(g+1)%e.arcs+e.arcs,e.indices[6*g+5]=(g+1)%e.arcs;var j=vec3.create();return{addTransformed:function(a,b,c,d,g,h,i){for(var k=a.numVerts()-e.arcs,l=0;l<e.arcs;++l)vec3.set(j,c*e.verts[3*l],c*e.verts[3*l+1],0),vec3.transformMat3(j,j,d),vec3.add(j,j,b),vec3.set(f,e.normals[3*l],e.normals[3*l+1],0),vec3.transformMat3(f,f,d),a.addVertex(j,f,g);if(!h)if(0!==i)for(l=0;l<e.arcs;++l)a.addTriangle(k+(l+i)%e.arcs,k+l+e.arcs,k+(l+1)%e.arcs+e.arcs),a.addTriangle(k+(l+i)%e.arcs,k+(l+1)%e.arcs+e.arcs,k+(l+1+i)%e.arcs);else for(l=0;l<e.indices.length/3;++l)a.addTriangle(k+e.indices[3*l],k+e.indices[3*l+1],k+e.indices[3*l+2])}}},g=.7071,h=[-g,-g,0,g,-g,0,g,g,0,-g,g,0],i=[-6*g,-1.2*g,0,6*g,-1.2*g,0,6*g,1.2*g,0,-6*g,1.2*g,0],j=function(a){for(var b={arcs:a,indices:new Uint16Array(2*3*a),verts:new Float32Array(2*3*a),normals:new Float32Array(2*3*a)},c=2*Math.PI/b.arcs,d=0;d<b.arcs;++d){var e=Math.cos(c*d),f=Math.sin(c*d);b.verts[3*d]=e,b.verts[3*d+1]=f,b.verts[3*d+2]=-.5,b.verts[3*a+3*d]=e,b.verts[3*a+3*d+1]=f,b.verts[3*a+3*d+2]=.5,b.normals[3*d]=e,b.normals[3*d+1]=f,b.normals[3*a+3*d]=e,b.normals[3*a+3*d+1]=f}for(d=0;d<b.arcs;++d)b.indices[6*d]=d%b.arcs,b.indices[6*d+1]=a+(d+1)%b.arcs,b.indices[6*d+2]=(d+1)%b.arcs,b.indices[6*d+3]=d%b.arcs,b.indices[6*d+4]=a+d%b.arcs,b.indices[6*d+5]=a+(d+1)%b.arcs;return{addTransformed:function(a,c,d,e,f,g,h){for(var i=a.numVerts(),j=vec3.create(),k=vec3.create(),l=0;l<2*b.arcs;++l)vec3.set(j,e*b.verts[3*l],e*b.verts[3*l+1],d*b.verts[3*l+2]),vec3.transformMat3(j,j,f),vec3.add(j,j,c),vec3.set(k,b.normals[3*l],b.normals[3*l+1],b.normals[3*l+2]),vec3.transformMat3(k,k,f),a.addVertex(j,k,l<b.arcs?g:h);for(l=0;l<b.indices.length/3;++l)a.addTriangle(i+b.indices[3*l],i+b.indices[3*l+1],i+b.indices[3*l+2])}}},k=function(a){var b={interleavedBuffer:a.createBuffer(),index_buffer:a.createBuffer(),vertData:[],index_data:[],num_triangles:0,numVerts:0,ready:!1};return{numVerts:function(){return b.numVerts},requires_outline_pass:function(){return!0},draw:function(c){this.bind();var d=a.getAttribLocation(c,"attrPos");a.enableVertexAttribArray(d),a.vertexAttribPointer(d,3,a.FLOAT,!1,36,0);var e=a.getAttribLocation(c,"attrNormal");-1!==e&&(a.enableVertexAttribArray(e),a.vertexAttribPointer(e,3,a.FLOAT,!1,36,12));var f=a.getAttribLocation(c,"attrColor");-1!==f&&(a.vertexAttribPointer(f,3,a.FLOAT,!1,36,24),a.enableVertexAttribArray(f)),a.drawElements(a.TRIANGLES,3*b.num_triangles,a.UNSIGNED_SHORT,0),a.disableVertexAttribArray(d),-1!==f&&a.disableVertexAttribArray(f),-1!==e&&a.disableVertexAttribArray(e)},addVertex:function(a,c,d){b.vertData.push(a[0],a[1],a[2],c[0],c[1],c[2],d[0],d[1],d[2]),b.numVerts+=1},addTriangle:function(a,c,d){b.index_data.push(a,c,d),b.num_triangles+=1},bind:function(){if(a.bindBuffer(a.ARRAY_BUFFER,b.interleavedBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.index_buffer),!b.ready){var c=new Float32Array(b.vertData);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);var d=new Uint16Array(b.index_data);a.bufferData(a.ELEMENT_ARRAY_BUFFER,d,a.STATIC_DRAW),b.ready=!0,b.index_data=[],b.vertData=[]}}}};b.prototype.add=function(a){this._children.push(a)},b.prototype.draw=function(a,b){for(var c=0;c<this._children.length;++c)(!b||this._children[c].requires_outline_pass())&&this._children[c].draw(a,b)};var l={};l.SceneNode=b,l.lineTrace=function(a,b,c){console.time("lineTrace");for(var e=vec3.create(),f=vec3.create(),g=d(b),h=a.chains(),i=0;i<h.length;++i){var j=h[i];j.eachBackboneTrace(function(a){for(var b=1;b<a.length;++b)c.color(a[b-1].atom("CA"),e,0),c.color(a[b].atom("CA"),f,0),g.addLine(a[b-1].atom("CA").pos(),e,a[b-0].atom("CA").pos(),f)})}return console.time("lineTrace"),g},l.spheres=function(a,b,c){console.time("spheres");var d=vec3.create(),f=k(b),g=e(c.sphereDetail,c.sphereDetail);return a.eachAtom(function(a){c.color(a,d,0),g.addTransformed(f,a.pos(),1.5,d)}),console.timeEnd("spheres"),f},l.sline=function(b,c,e){console.time("sline");for(var f,g,h=d(c),i=vec3.create(),j=vec3.create(),k=vec3.create(),l=vec3.create(),m=b.chains(),n=0;n<m.length;++n){var o=m[n];o.eachBackboneTrace(function(b){var c=new Float32Array(3*b.length),d=new Float32Array(3*b.length);for(f=0;f<b.length;++f){var m=b[f].atom("CA");e.color(m,d,3*f);var n=m.pos();c[3*f]=n[0],c[3*f+1]=n[1],c[3*f+2]=n[2]}var o=geom.catmullRomSpline(c,e.splineDetail,e.strength,!1),p=a(d,e.splineDetail);for(f=1,g=o.length/3;g>f;++f)i[0]=o[3*(f-1)],i[1]=o[3*(f-1)+1],i[2]=o[3*(f-1)+2],j[0]=o[3*(f-0)],j[1]=o[3*(f-0)+1],j[2]=o[3*(f-0)+2],k[0]=p[3*(f-1)],k[1]=p[3*(f-1)+1],k[2]=p[3*(f-1)+2],l[0]=p[3*(f-0)],l[1]=p[3*(f-0)+1],l[2]=p[3*(f-0)+2],h.addLine(i,k,j,l)})}return console.timeEnd("sline"),h};var m=function(){var a=mat3.create(),b=vec3.create();return function(d,e,f,g,h,i,j,k,l){var m=g.ss(),n=k.coilProfile;"H"!=m||k.forceTube?"E"!=m||k.forceTube?j?geom.ortho(f,h):vec3.cross(f,b,h):n=k.strandProfile:n=k.helixProfile,c(a,h,f,b,!0),n.addTransformed(d,e,k.radius,a,i,j,l)}}(),n=function(a,b,c,d,e,f){for(var g=0,h=0,i=0,j=0;j<a.length;++j){var k=a[j].atom("CA").pos(),l=a[j].atom("C").pos(),m=a[j].atom("O").pos();e[j]="E"===a[j].ss()?.5:1,c[3*j]=k[0],c[3*j+1]=k[1],c[3*j+2]=k[2];var n=m[0]-l[0],o=m[1]-l[1],p=m[2]-l[2],q=1/Math.sqrt(n*n+o*o+p*p);if(n*=q,o*=q,p*=q,j>0){var r=g*n+h*o+i*p;0>r&&(n*=-1,o*=-1,p*=-1)}g=n,h=o,i=p,d[3*j]=c[3*j]+n,d[3*j+1]=c[3*j+1]+o,d[3*j+2]=c[3*j+2]+p,f.color(a[j].atom("CA"),b,3*j)}},o=function(){var b=vec3.create(),c=vec3.create(),d=(vec3.create(),vec3.create()),e=vec3.create(),f=vec3.create();return mat3.create(),function(g,h,i){var j=g.backboneTraces();if(0===j.length)return null;for(var l=k(h),o=0;o<j.length;++o){var p=j[o],q=new Float32Array(3*p.length),r=new Float32Array(3*p.length),s=new Float32Array(3*p.length),t=new Float32Array(p.length);n(p,r,q,s,t,i);var u=geom.catmullRomSpline(q,i.splineDetail,i.strength,!1),v=geom.catmullRomSpline(s,i.splineDetail,i.strength,!1),w=a(r,i.splineDetail);vec3.set(b,u[3]-u[0],u[4]-u[1],u[5]-u[2]),vec3.set(c,u[0],u[1],u[2]),vec3.set(e,v[0]-u[0],v[1]-u[0],v[2]-u[2]),vec3.normalize(b,b),vec3.normalize(e,e),vec3.set(d,w[0],w[1],w[2]),m(l,c,e,p[0],b,d,!0,i,0);for(var x=1,y=u.length/3-1;y>x;++x){var z=3*x,A=3*(x+1),B=3*(x-1);vec3.set(c,u[z],u[z+1],u[z+2]),vec3.set(b,u[A]-u[B],u[A+1]-u[B+1],u[A+2]-u[B+2]),vec3.normalize(b,b),vec3.set(d,w[z],w[z+1],w[z+2]);var C=0,D=Math.floor(x/i.splineDetail),E=Math.floor((x-1)/i.splineDetail);if(D!=E&&"C"===p[E].ss()&&("H"===p[D].ss()||"E"===p[D].ss())){vec3.set(f,v[B]-u[B],v[B+1]-u[B+1],v[B+2]-u[B+2]),vec3.normalize(f,f);var F=2*Math.PI/(4*i.arcDetail),G=geom.signedAngle(e,f,b);C=Math.round(G/F),C=(C+4*i.arcDetail)%(4*i.arcDetail)}vec3.set(e,v[3*x]-u[z],v[z+1]-u[z+1],v[z+2]-u[z+2]),vec3.normalize(e,e),m(l,c,e,p[D],b,d,!1,i,C)}x=u.length,vec3.set(b,u[3*x-3]-u[3*x-6],u[3*x-2]-u[3*x-5],u[3*x-1]-u[3*x-4]),vec3.set(c,u[3*x-3],u[3*x-2],u[3*x-1]),vec3.set(e,v[3*x]-u[3*x],v[3*x-3]-u[3*x-3],v[3*x-2]-u[3*x-2]),vec3.normalize(e,e),vec3.normalize(b,b),vec3.set(d,w[w.length-3],w[w.length-2],w[w.length-1]),m(l,c,e,p[p.length-1],b,d,!1,i,0)}return l}}();l.cartoon=function(a,c,d){console.time("cartoon"),d.coilProfile=f(h,d.arcDetail,1),d.helixProfile=f(i,d.arcDetail,.1),d.strandProfile=f(i,d.arcDetail,.1);for(var e=new b,g=a.chains(),j=0,k=g.length;k>j;++j){var l=o(g[j],c,d);l&&e.add(l)}return console.timeEnd("cartoon"),e},l.lines=function(a,b,c){console.time("lines");var e=vec3.create(),f=d(b),g=vec3.create();return a.eachAtom(function(a){if(a.bonds().length)a.eachBond(function(a){a.mid_point(e),c.color(a.atom_one(),g,0),f.addLine(a.atom_one().pos(),g,e,g),c.color(a.atom_two(),g,0),f.addLine(e,g,a.atom_two().pos(),g)});else{var b=.2,d=a.pos();c.color(a,g,0),f.addLine([d[0]-b,d[1],d[2]],g,[d[0]+b,d[1],d[2]],g),f.addLine([d[0],d[1]-b,d[2]],g,[d[0],d[1]+b,d[2]],g),f.addLine([d[0],d[1],d[2]-b],g,[d[0],d[1],d[2]+b],g)}}),console.timeEnd("lines"),f};var p=function(){var a=mat3.create(),b=vec3.create(),d=vec3.create(),e=vec3.create(),f=vec3.create(),g=vec3.create();return function(h,i,j){var l=h.backboneTraces();if(0===l.length)return null;for(var m=k(i),n=0;n<l.length;++n){var o=l[n];j.color(o[0].atom("CA"),f,0),j.protoSphere.addTransformed(m,o[0].atom("CA").pos(),j.radius,f);for(var p=1;p<o.length;++p){var q=o[p-1].atom("CA").pos(),r=o[p].atom("CA").pos();j.color(o[p].atom("CA"),g,0),j.protoSphere.addTransformed(m,r,j.radius,g),vec3.sub(b,r,q);var s=vec3.length(b);vec3.scale(b,b,1/s),c(a,b,d,e,!1);var t=vec3.clone(q);vec3.add(t,t,r),vec3.scale(t,t,.5),j.protoCyl.addTransformed(m,t,s,j.radius,a,f,g),vec3.copy(f,g)}}return m}}();return l.trace=function(a,c,d){var f=new b;d.protoCyl=j(d.arcDetail),d.protoSphere=e(d.sphereDetail,d.sphereDetail);for(var g=a.chains(),h=0;h<g.length;++h){var i=g[h],k=p(i,c,d);k&&f.add(k)}return f},l}(),pv=function(){"use strict";function a(a,b){return function(){return b.apply(a,arguments)}}function b(){return function(a,b,c){switch(a.residue().ss()){case"C":return b[c]=.8,b[c+1]=.8,b[c+2]=.8,void 0;case"H":return b[c]=.3,b[c+1]=.3,b[c+2]=.8,void 0;case"E":return b[c]=.2,b[c+1]=.8,b[c+2]=.2,void 0}}}function c(a){return function(b,c,d){c[d]=a[0],c[d+1]=a[1],c[d+2]=a[2]}}function d(a,b){return b||(b=vec3.create()),"C"==a?(vec3.set(b,.8,.8,.8),b):"N"==a?(vec3.set(b,0,0,1),b):"O"==a?(vec3.set(b,1,0,0),b):"S"==a?(vec3.set(b,.8,.8,0),b):"CA"==a?(vec3.set(b,.533,.533,.666),b):(vec3.set(b,1,0,1),b)}function e(){return function(a,b){d(a.element(),b)}}function f(b,c){c=c||{},this._options={width:c.width||500,height:c.height||500,antialias:c.antialias,quality:c.quality||"low"},this._domElement=b,this._canvas=document.createElement("canvas"),this._options.outline="outline"in c?c.outline:!0,this._ok=!1,this.quality(this._options.quality),this._canvas.width=this._options.width,this._canvas.height=this._options.height,this._domElement.appendChild(this._canvas),document.addEventListener("DOMContentLoaded",a(this,this._initPV))}var g='<div style="vertical-align:middle; text-align:center;"><h1>Oink</h1><p>Your browser does not support WebGL. You might want to try Chrome, Firefox, IE 11, or newer versions of Safari</p><p>If you are using a recent version of one of the above browsers, your graphic card might be blocked. Check the browser documentation for details</p></div>',h="\nprecision mediump float;\n\nvarying vec3 vertColor;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\n\nvoid main(void) {\n  float dp = dot(vertNormal, vec3(0.0, 0.0, 1.0));\n  float hemi = max(0.0, dp)*0.5+0.5;\n  gl_FragColor = vec4(vertColor*hemi, 1.0);\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  float fog_factor = smoothstep(fogNear, fogFar, depth);\n  gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                      fog_factor);\n}",i="\nattribute vec3 attrPos;\nattribute vec3 attrColor;\nattribute vec3 attrNormal;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec3 vertColor;\nvarying vec3 vertNormal;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 n = (modelviewMat * vec4(attrNormal, 0.0));\n  vertNormal = n.xyz;\n  vertColor = attrColor;\n}",j="\nprecision mediump float;\n\nuniform vec3 outlineColor;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\n\nvoid main() {\n  gl_FragColor = vec4(outlineColor, 1.0);\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  float fog_factor = smoothstep(fogNear, fogFar, depth);\n  gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                      fog_factor);\n}",k="\n\nattribute vec3 attrPos;\nattribute vec3 attrNormal;\n                                                                       \nuniform vec3 outlineColor;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 normal = modelviewMat * vec4(attrNormal, 0.0);\n  gl_Position.xy += normal.xy*0.200;\n}",l=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),m=function(a){function b(){c.updateMat&&(mat4.identity(c.modelview),mat4.translate(c.modelview,c.modelview,[-c.center[0],-c.center[1],-c.center[2]]),mat4.mul(c.modelview,c.rotation,c.modelview),mat4.identity(c.translation),mat4.translate(c.translation,c.translation,[0,0,-c.zoom]),mat4.mul(c.modelview,c.translation,c.modelview),c.updateMat=!1)}var c={projection:mat4.create(),modelview:mat4.create(),near:.1,far:400,fogNear:-5,fogFar:10,fogColor:vec3.fromValues(1,1,1),center:vec3.create(),zoom:50,rotation:mat4.create(),translation:mat4.create(),updateMat:!0};return mat4.perspective(c.projection,45,a.viewportWidth/a.viewportHeight,c.near,c.far),mat4.translate(c.modelview,c.modelview,[0,0,-20]),{set_center:function(a){c.updateMat=!0,vec3.copy(c.center,a)},rotate_z:function(a){c.updateMat=!0;var b=mat4.create();mat4.rotate(b,b,a,[0,0,1]),mat4.mul(c.rotation,b,c.rotation)},rotate_x:function(a){c.updateMat=!0;var b=mat4.create();mat4.rotate(b,b,a,[1,0,0]),mat4.mul(c.rotation,b,c.rotation)},rotate_y:function(a){c.updateMat=!0;var b=mat4.create();mat4.rotate(b,b,a,[0,1,0]),mat4.mul(c.rotation,b,c.rotation)},zoom:function(a){c.updateMat=!0,c.zoom+=a},bind:function(d){b(),a.useProgram(d),a.viewport(0,0,a.viewportWidth,a.viewportHeight),d.projection=a.getUniformLocation(d,"projectionMat"),d.modelview=a.getUniformLocation(d,"modelviewMat"),a.uniformMatrix4fv(d.projection,!1,c.projection),a.uniformMatrix4fv(d.modelview,!1,c.modelview),a.uniform1f(a.getUniformLocation(d,"fogFar"),c.fogFar+c.zoom),a.uniform1f(a.getUniformLocation(d,"fogNear"),c.fogNear+c.zoom),a.uniform3fv(a.getUniformLocation(d,"fogColor"),c.fogColor)}}};return f.prototype.gl=function(){return this._gl},f.prototype.ok=function(){return this._ok},f.prototype.options=function(a){return this._options[a]},f.prototype.quality=function(a){return this._options.quality=a,console.info("setting quality to",a),"high"==a?(this._options.arcDetail=4,this._options.sphereDetail=16,this._options.splineDetail=8,void 0):"medium"==a?(this._options.arcDetail=3,this._options.sphereDetail=10,this._options.splineDetail=4,void 0):"low"==a?(this._options.arcDetail=2,this._options.sphereDetail=8,this._options.splineDetail=2,void 0):(console.error("invalid quality argument",a),void 0)},f.prototype._initGL=function(){var a=1;try{var b={antialias:this._options.antialias};this._gl=this._canvas.getContext("experimental-webgl",b),!this._gl.getContextAttributes().antialias&&this._options.antialias&&(console.info("hardware antialising not supported.","will use manual antialiasing instead."),a=2)}catch(c){return console.error("WebGL not supported",c),!1}if(!this._gl)return console.error("WebGL not supported"),!1;if(this._options.real_width=this._options.width*a,this._options.real_height=this._options.height*a,a>1){var d=1/a,e=.5*-(1-d)*this._options.real_width,f=.5*-(1-d)*this._options.real_height,g="translate("+e+"px, "+f+"px)",h="scale("+d+", "+d+")",i=g+" "+h;this._domElement.style.width=this._options.width+"px",this._domElement.style.height=this._options.height+"px",this._domElement.style.overflow="hidden",this._canvas.style.webkitTransform=i,this._canvas.style.transform=i,this._canvas.style.ieTransform=i,this._canvas.width=this._options.real_width,this._canvas.height=this._options.real_height}return this._gl.viewportWidth=this._options.real_width,this._gl.viewportHeight=this._options.real_height,this._gl.clearColor(1,1,1,1),this._gl.lineWidth(2),this._gl.cullFace(this._gl.FRONT),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.DEPTH_TEST),!0},f.prototype._shaderFromString=function(a,b){var c;if("fragment"===b)c=this._gl.createShader(this._gl.FRAGMENT_SHADER);else{if("vertex"!==b)return console.error("could not determine type for shader"),null;c=this._gl.createShader(this._gl.VERTEX_SHADER)}return this._gl.shaderSource(c,a),this._gl.compileShader(c),this._gl.getShaderParameter(c,this._gl.COMPILE_STATUS)?c:(console.error(this._gl.getShaderInfoLog(c)),null)},f.prototype._initShader=function(a,b){var c=this._shaderFromString(b,"fragment"),d=this._shaderFromString(a,"vertex"),e=this._gl.createProgram();return this._gl.attachShader(e,d),this._gl.attachShader(e,c),this._gl.linkProgram(e),this._gl.getProgramParameter(e,this._gl.LINK_STATUS)||console.error("could not initialise shaders"),e},f.prototype._mouseUp=function(){this._canvas.removeEventListener("mousemove",this._mouseMoveListener,!1),this._canvas.removeEventListener("mouseup",this._mouseUpListener,!1),document.removeEventListener("mousemove",this._mouseMoveListener)},f.prototype._initPV=function(){return this._initGL()?(this._ok=!0,this._cam=m(this._gl),this._hemilightShader=this._initShader(i,h),this._outlineShader=this._initShader(k,j),this._mouseMoveListener=a(this,this._mouseMove),this._mouseUpListener=a(this,this._mouseUp),"onwheel"in this._canvas?this._canvas.addEventListener("wheel",a(this,this._mouseWheelFF),!1):this._canvas.addEventListener("mousewheel",a(this,this._mouseWheel),!1),this._canvas.addEventListener("mousedown",a(this,this._mouseDown),!1),!0):(this._domElement.removeChild(this._canvas),this._domElement.innerHTML=g,this._domElement.style.width=this._options.width+"px",this._domElement.style.height=this._options.height+"px",!1)},f.prototype._add=function(a){this._objects.push(a),this.requestRedraw()},f.prototype.requestRedraw=function(){l(a(this,this._draw))},f.prototype._draw=function(){this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._cam.bind(this._hemilightShader),this._gl.cullFace(this._gl.FRONT),this._gl.enable(this._gl.CULL_FACE);for(var a=0;a<this._objects.length;a+=1)this._objects[a].draw(this._hemilightShader,!1);
if(this._options.outline)for(this._cam.bind(this._outlineShader),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),a=0;a<this._objects.length;a+=1)this._objects[a].draw(this._outlineShader,!0)},f.prototype.centerOn=function(a){this._cam.set_center(a.center())},f.prototype.clear=function(){this._objects=[]},f.prototype._mouseWheel=function(a){this._cam.zoom(.05*a.wheelDelta),this.requestRedraw()},f.prototype._mouseWheelFF=function(a){this._cam.zoom(.6*-a.deltaY),this.requestRedraw()},f.prototype._mouseDown=function(a){a.preventDefault(),this._canvas.addEventListener("mousemove",this._mouseMoveListener,!1),document.addEventListener("mousemove",this._mouseMoveListener,!1),this._canvas.addEventListener("mouseup",this._mouseUpListener,!1),document.addEventListener("mouseup",this._mouseUpListener,!1),this._lastMousePos={x:a.pageX,y:a.pageY}},f.prototype._mouseMove=function(a){var b={x:a.pageX,y:a.pageY},c={x:b.x-this._lastMousePos.x,y:b.y-this._lastMousePos.y},d=.005;this._cam.rotate_x(d*c.y),this._cam.rotate_y(d*c.x),this._lastMousePos=b,this.requestRedraw()},f.prototype.RENDER_MODES=["sline","line","trace","lineTrace","cartoon","tube","spheres"],f.prototype.renderAs=function(a,b,c){for(var d=!1,e=0;e<this.RENDER_MODES.length;++e)if(this.RENDER_MODES[e]===b){d=!0;break}return d?this[b](a,c):(console.error("render mode",b,"not supported"),void 0)},f.prototype.lineTrace=function(a,b){b=b||{};var d={color:b.color||c([1,0,1])};return render.lineTrace(a,this._gl,d)},f.prototype.spheres=function(a,b){b=b||{};var c={color:b.color||e(),sphereDetail:this.options("sphereDetail")};return render.spheres(a,this._gl,c)},f.prototype.sline=function(a,b){b=b||{};var d={color:b.color||c([1,0,1]),splineDetail:b.splineDetail||this.options("splineDetail"),strength:b.strength||.5};return render.sline(a,this._gl,d)},f.prototype.cartoon=function(a,c){c=c||{};var d={color:c.color||b(),strength:c.strength||1,splineDetail:c.splineDetail||this.options("splineDetail"),arcDetail:c.arcDetail||this.options("arcDetail"),radius:c.radius||.3,forceTube:c.forceTube||!1};return render.cartoon(a,this._gl,d)},f.prototype.tube=function(a,b){return b=b||{},b.forceTube=!0,this.cartoon(a,b)},f.prototype.lines=function(a,b){b=b||{};var c={color:b.color||e()};return render.lines(a,this._gl,c)},f.prototype.trace=function(a,b){b=b||{};var d={color:b.color||c([1,0,0]),radius:b.radius||.3,arcDetail:2*(b.arcDetail||this.options("arcDetail")),sphereDetail:b.sphereDetail||this.options("sphereDetail")};return render.trace(a,this._gl,d)},f.prototype.add=function(a,b){this._objects.push(b),this.requestRedraw()},{Viewer:function(a,b){return new f(a,b)}}}();