function BackboneTrace(){this._r=[]}function TraceSubset(a,b,c,d){this._bs=a,this._P=b,this._cz=c,this._r=d,this._bM=0===this._P,this._bN=this._bs.length()===this._cz;var e=this._cz-this._P;this._bN||++e,this._bM||(++e,this._P-=1),this._bL=e}function AtomVertexAssoc(a,b){this._o=a,this._x=[],this._bg=b}function TraceVertexAssoc(a,b,c){this._o=a,this._x=[],this._bg=c,this._ct=b||1,this._bG={}}!function(a){"use strict";var b={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(b.exports={},define(function(){return b.exports})):b.exports="undefined"!=typeof window?window:a:b.exports=exports,function(a){if(!b)var b=1e-6;if(!c)var c="undefined"!=typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var e={};e.setMatrixArrayType=function(a){c=a},"undefined"!=typeof a&&(a.glMatrix=e);var f={};f.create=function(){var a=new c(3);return a[0]=0,a[1]=0,a[2]=0,a},f.clone=function(a){var b=new c(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},f.fromValues=function(a,b,d){var e=new c(3);return e[0]=a,e[1]=b,e[2]=d,e},f.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},f.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},f.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},f.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},f.sub=f.subtract,f.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},f.mul=f.multiply,f.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},f.div=f.divide,f.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},f.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},f.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},f.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},f.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},f.dist=f.distance,f.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},f.sqrDist=f.squaredDistance,f.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},f.len=f.length,f.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},f.sqrLen=f.squaredLength,f.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},f.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},f.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},f.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},f.random=function(a,b){b=b||1;var c=2*d()*Math.PI,e=2*d()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},f.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12],a[1]=c[1]*d+c[5]*e+c[9]*f+c[13],a[2]=c[2]*d+c[6]*e+c[10]*f+c[14],a},f.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},f.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},f.forEach=function(){var a=f.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),f.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},"undefined"!=typeof a&&(a.vec3=f);var g={};g.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},g.clone=function(a){var b=new c(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},g.fromValues=function(a,b,d,e){var f=new c(4);return f[0]=a,f[1]=b,f[2]=d,f[3]=e,f},g.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},g.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},g.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},g.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},g.sub=g.subtract,g.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},g.mul=g.multiply,g.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},g.div=g.divide,g.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},g.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},g.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},g.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},g.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},g.dist=g.distance,g.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},g.sqrDist=g.squaredDistance,g.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},g.len=g.length,g.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},g.sqrLen=g.squaredLength,g.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},g.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=b[0]*g,a[1]=b[1]*g,a[2]=b[2]*g,a[3]=b[3]*g),a},g.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},g.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},g.random=function(a,b){return b=b||1,a[0]=d(),a[1]=d(),a[2]=d(),a[3]=d(),g.normalize(a,a),g.scale(a,a,b),a},g.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},g.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},g.forEach=function(){var a=g.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),g.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.vec4=g);var h={};h.create=function(){var a=new c(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},h.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},h.clone=function(a){var b=new c(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},h.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},h.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},h.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},h.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},h.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},h.mul=h.multiply,h.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},h.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},h.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[3]=k+r,a[6]=l-q,a[1]=k-r,a[4]=1-(j+o),a[7]=n+p,a[2]=l+q,a[5]=n-p,a[8]=1-(j+m),a},h.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},h.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},"undefined"!=typeof a&&(a.mat3=h);var i={};i.create=function(){var a=new c(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},i.fromValues=function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=new c(16);return r[0]=a,r[1]=b,r[2]=d,r[3]=e,r[4]=f,r[5]=g,r[6]=h,r[7]=i,r[8]=j,r[9]=k,r[10]=l,r[11]=m,r[12]=n,r[13]=o,r[14]=p,r[15]=q,r},i.clone=function(a){var b=new c(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},i.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},i.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},i.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},i.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},i.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},i.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},i.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},i.mul=i.multiply,i.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},i.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},i.rotate=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<b?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=c[0],j=c[1],k=c[2],l=c[3],m=c[4],n=c[5],o=c[6],p=c[7],q=c[8],r=c[9],s=c[10],t=c[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a)},i.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},i.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},i.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},i.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},i.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-(m+o),a[1]=k+r,a[2]=l-q,a[3]=0,a[4]=k-r,a[5]=1-(j+o),a[6]=n+p,a[7]=0,a[8]=l+q,a[9]=n-p,a[10]=1-(j+m),a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},i.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*g*f*j,a[15]=0,a},i.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},i.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},i.lookAt=function(a,c,d,e){var f,g,h,j,k,l,m,n,o,p,q=c[0],r=c[1],s=c[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];return Math.abs(q-w)<b&&Math.abs(r-x)<b&&Math.abs(s-y)<b?i.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,f=u*o-v*n,g=v*m-t*o,h=t*n-u*m,p=Math.sqrt(f*f+g*g+h*h),p?(p=1/p,f*=p,g*=p,h*=p):(f=0,g=0,h=0),j=n*h-o*g,k=o*f-m*h,l=m*g-n*f,p=Math.sqrt(j*j+k*k+l*l),p?(p=1/p,j*=p,k*=p,l*=p):(j=0,k=0,l=0),a[0]=f,a[1]=j,a[2]=m,a[3]=0,a[4]=g,a[5]=k,a[6]=n,a[7]=0,a[8]=h,a[9]=l,a[10]=o,a[11]=0,a[12]=-(f*q+g*r+h*s),a[13]=-(j*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},i.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},"undefined"!=typeof a&&(a.mat4=i);var j={};j.create=function(){var a=new c(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},j.rotationTo=function(){var a=f.create(),b=f.fromValues(1,0,0),c=f.fromValues(0,1,0);return function(d,e,g){var h=f.dot(e,g);return-.999999>h?(f.cross(a,b,e),f.length(a)<1e-6&&f.cross(a,c,e),f.normalize(a,a),j.setAxisAngle(d,a,Math.PI),d):h>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(f.cross(a,e,g),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+h,j.normalize(d,d))}}(),j.setAxes=function(){var a=h.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=c[0],a[5]=c[1],a[8]=c[2],j.normalize(b,j.fromMat3(b,a))}}(),j.clone=g.clone,j.fromValues=g.fromValues,j.copy=g.copy,j.set=g.set,j.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},j.setAxisAngle=function(a,b,c){c=.5*c;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},j.add=g.add,j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},j.mul=j.multiply,j.scale=g.scale,j.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},j.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},j.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},j.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},j.dot=g.dot,j.lerp=g.lerp,j.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,0>f&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},j.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},j.length=g.length,j.len=j.length,j.squaredLength=g.squaredLength,j.sqrLen=j.squaredLength,j.normalize=g.normalize,j.fromMat3=function(){var a="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(b,c){var d,e=c[0]+c[4]+c[8];if(e>0)d=Math.sqrt(e+1),b[3]=.5*d,d=.5/d,b[0]=(c[7]-c[5])*d,b[1]=(c[2]-c[6])*d,b[2]=(c[3]-c[1])*d;else{var f=0;c[4]>c[0]&&(f=1),c[8]>c[3*f+f]&&(f=2);var g=a[f],h=a[g];d=Math.sqrt(c[3*f+f]-c[3*g+g]-c[3*h+h]+1),b[f]=.5*d,d=.5/d,b[3]=(c[3*h+g]-c[3*g+h])*d,b[g]=(c[3*g+f]+c[3*f+g])*d,b[h]=(c[3*h+f]+c[3*f+h])*d}return b}}(),j.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof a&&(a.quat=j)}(b.exports)}(this),function(a){"use strict";function b(a,b){return b>a}return a.derive=function(a,b,c){for(var d in b.prototype)a.prototype[d]=b.prototype[d];if(void 0!==c)for(var e in c)a.prototype[e]=c[e]},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.copy=function(a){a=a||{};var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},a.binarySearch=function(a,c,d){if(0===a.length)return-1;d=d||b;for(var e=0,f=a.length,g=e+f>>1;;){var h=a[g];if(d(c,h))f=g;else{if(!d(h,c))return g;e=g}var i=e+f>>1;if(i===g)return-1;g=i}return-1},a.indexFirstLargerEqualThan=function(a,c,d){if(d=d||b,0===a.length||d(c,a[0]))return-1;for(var e=0,f=a.length,g=e+f>>1;;){var h=a[g];d(c,h)?f=g:d(h,c)?e=g:f=g+1;var i=e+f>>1;if(i===g)return g;g=i}},a.indexLastSmallerThan=function(a,c,d){if(d=d||b,0===a.length||d(a[a.length-1],c))return a.length-1;for(var e=0,f=a.length,g=e+f>>1;;){var h=a[g];d(c,h)?f=g:e=g;var i=e+f>>1;if(i===g)return g-1;g=i}},a.indexLastSmallerEqualThan=function(a,c,d){if(d=d||b,0===a.length||d(a[a.length-1],c))return a.length-1;if(d(c,a[0]))return-1;for(var e=0,f=a.length,g=e+f>>1;;){var h=a[g];d(c,h)?f=g:e=g;var i=e+f>>1;if(i===g)return g;g=i}},!0}(this);var geom=function(){"use strict";function a(a,b,c){return c?a*b:b*(a-1)+1}function b(b,c,d,e,f,h){f=f||!1,e=e||.5;var i=null,j=3*a(c,d,f);i=h?h.request(j):new Float32Array(j);var k,l,m,n=0,o=1/d,p=vec3.create(),q=vec3.create(),r=vec3.create(),s=vec3.create(),t=vec3.create(),u=vec3.create();for(vec3.set(s,b[0],b[1],b[2]),vec3.set(t,b[3],b[4],b[5]),f?(vec3.set(r,b[b.length-3],b[b.length-2],b[b.length-1]),vec3.sub(p,t,r),vec3.scale(p,p,e)):(vec3.set(r,b[0],b[1],b[2]),vec3.set(p,0,0,0)),k=1,m=c-1;m>k;++k){for(vec3.set(u,b[3*(k+1)],b[3*(k+1)+1],b[3*(k+1)+2]),vec3.sub(q,u,s),vec3.scale(q,q,e),l=0;d>l;++l)g(i,s,p,t,q,o*l,n),n+=3;vec3.copy(r,s),vec3.copy(s,t),vec3.copy(t,u),vec3.copy(p,q)}for(f?(vec3.set(u,b[0],b[1],b[3]),vec3.sub(q,u,s),vec3.scale(q,q,e)):vec3.set(q,0,0,0),l=0;d>l;++l)g(i,s,p,t,q,o*l,n),n+=3;if(!f)return i[n]=b[3*(c-1)+0],i[n+1]=b[3*(c-1)+1],i[n+2]=b[3*(c-1)+2],i;for(vec3.copy(r,s),vec3.copy(s,t),vec3.copy(t,u),vec3.copy(p,q),vec3.set(u,b[3],b[4],b[5]),vec3.sub(q,u,s),vec3.scale(q,q,e),l=0;d>l;++l)g(i,s,p,t,q,o*l,n),n+=3;return i}function c(a,b){this._L=a||vec3.create(),this._c1=b||1}var d=function(){var a=vec3.create();return function(b,c,d){return vec3.cross(a,b,c),Math.atan2(vec3.dot(a,d),vec3.dot(b,c))}}(),e=function(){var a=vec3.create();return function(b,c){return vec3.copy(a,c),Math.abs(c[0])<Math.abs(c[1])?Math.abs(c[0])<Math.abs(c[2])?a[0]+=1:a[2]+=1:Math.abs(c[1])<Math.abs(c[2])?a[1]+=1:a[2]+=1,vec3.cross(b,c,a)}}(),f=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=f*f,j=f*g,k=f*h,l=g*g,m=g*h,n=h*h;return a[0]=i+e-i*e,a[1]=j-e*j-d*h,a[2]=k-e*k+d*g,a[3]=j-e*j+d*h,a[4]=l+e-e*l,a[5]=m-e*m-d*f,a[6]=k-e*k-d*g,a[7]=m-e*m+d*f,a[8]=n+e-e*n,a},g=function(){var a=vec3.create();return function(b,c,d,e,f,g,h){var i=g*g,j=3-2*g,k=i*j,l=1-k,m=i*(g-2)+g,n=i*(g-1);vec3.copy(a,c),vec3.scale(a,a,l),vec3.scaleAndAdd(a,a,d,m),vec3.scaleAndAdd(a,a,e,k),vec3.scaleAndAdd(a,a,f,n),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2]}}();return c.prototype.center=function(){return this._L},c.prototype.radius=function(){return this._c1},{signedAngle:d,axisRotation:f,ortho:e,catmullRomSpline:b,cubicHermiteInterpolate:g,catmullRomSplineNumPoints:a,Sphere:c}}();"undefined"!=typeof exports&&(module.exports=geom),"undefined"!=typeof exports&&(exports.backboneTrace=BackboneTrace),BackboneTrace.prototype={push:function(a){this._r.push(a)},length:function(){return this._r.length},residueAt:function(a){return this._r[a]},posAt:function(a,b){return vec3.copy(a,this._r[b].centralAtom().pos()),a},normalAt:function(a,b){var c=this._r[b];return c.isAminoacid()&&vec3.sub(a,c.atom("O").pos(),c.atom("C").pos()),vec3.normalize(a,a),a},centralAtomAt:function(a){return this._r[a].centralAtom()},tangentAt:function(){var a=vec3.create(),b=vec3.create();return function(c,d){d>0?this.posAt(a,d-1):this.posAt(a,d),d<this._r.length-1?this.posAt(b,d+1):this.posAt(b,d),vec3.sub(c,b,a)}}(),fullTraceIndex:function(a){return a},subsets:function(a){for(var b=0,c=0,d=[];c<a.length&&b<this._r.length;){for(var e=a[c].full().index();this._r.length>b&&this._r[b].index()<e;)++b;if(b>=this._r.length)break;for(var f=this._r[b].index();a.length>c&&a[c].full().index()<f;)++c;if(c>=a.length)break;for(var g=b,h=c;a.length>c&&this._r.length>b&&a[c].full().index()===this._r[b].index();)++c,++b;var i=c,j=b;d.push(new TraceSubset(this,g,j,a.slice(h,i)))}return d}},BackboneTrace.prototype.smoothPosAt=BackboneTrace.prototype.posAt,BackboneTrace.prototype.smoothNormalAt=BackboneTrace.prototype.normalAt,TraceSubset.prototype={length:function(){return this._bL},residueAt:function(a){return this._bs.residueAt(this._P+a)},_cu:function(){vec3.create();var a=vec3.create(),b=vec3.create();return function(c,d,e,f){return this.tangentAt(a,d),this.tangentAt(b,e),vec3.scale(a,a,f),vec3.scale(b,b,f),geom.cubicHermiteInterpolate(c,this.centralAtomAt(d).pos(),a,this.centralAtomAt(e).pos(),b,.5,0),c}}(),smoothPosAt:function(){return vec3.create(),vec3.create(),vec3.create(),function(a,b,c){if(0===b&&!this._bM)return this._cu(a,b,b+1,c);if(b===this._bL-1&&!this._bN)return this._cu(a,b-1,b,c);var d=this.centralAtomAt(b);return vec3.copy(a,d.pos()),a}}(),smoothNormalAt:function(){return function(a,b){return this._bs.normalAt(a,b+this._P),a}}(),posAt:function(a,b){var c=this.centralAtomAt(b),d=null;return vec3.copy(a,c.pos()),0!==b||this._bM||(d=this.centralAtomAt(b+1),vec3.add(a,a,d.pos()),vec3.scale(a,a,.5)),b!==this._bL-1||this._bN||(d=this.centralAtomAt(b-1),vec3.add(a,a,d.pos()),vec3.scale(a,a,.5)),a},centralAtomAt:function(a){return this.residueAt(a).centralAtom()},fullTraceIndex:function(a){return this._P+a},tangentAt:function(a,b){return this._bs.tangentAt(a,b+this._P)}},function(a){"use strict";function b(a,b){this._m=a||[],this._bK=b||[]}function c(a){this._C=a,this._bR=[]}return b.prototype={addChain:function(a){this._m.push(a)},chains:function(){return this._m},addMatrix:function(a){this._bK.push(a)},matrices:function(){return this._bK},matrix:function(a){return this._bK[a]}},c.prototype={name:function(){return this._C},generators:function(){return this._bR},generator:function(a){return this._bR[a]},addGenerator:function(a){this._bR.push(a)}},a.SymGenerator=b,a.Assembly=c,!0}(this),function(a){"use strict";function b(a){var b=A[a.toUpperCase()];return void 0!==b?b:1.5}function c(a,b){return a<<8|b.charCodeAt(0)}function d(a,b){for(var c=0;c<b.length;++c)if(!b[c](a))return!1;return!0}function e(a,b){return a.num()<b.num()}function f(a){return{num:function(){return a}}}function g(a){var b=[];return void 0!==a.aname&&b.push(function(b){return b.name()===a.aname}),void 0!==a.anames&&b.push(function(b){for(var c=b.name(),d=0;d<a.anames.length;++d)if(c===a.anames[d])return!0;return!1}),b}function h(a){var b=[];if(void 0!==a.rname&&b.push(function(b){return b.name()===a.rname}),void 0!==a.rnames&&b.push(function(b){for(var c=b.name(),d=0;d<a.rnames.length;++d)if(c===a.rnames[d])return!0;return!1}),void 0!==a.rnums){for(var c={},d=0;d<a.rnums.length;++d)c[a.rnums[d]]=!0;b.push(function(a){var b=a.num();return c[b]===!0})}return b}function i(a){var b=[];return void 0!==a.cname&&(a.chain=a.cname),void 0!==a.cnames&&(a.chains=a.cnames),void 0!==a.chain&&b.push(function(b){return b.name()===a.chain}),void 0!==a.chains&&b.push(function(b){for(var c=b.name(),d=0;d<a.chains.length;++d)if(c===a.chains[d])return!0;return!1}),b}function j(a,b){for(var c=new u(a),e=h(b),f=g(b),j=i(b),k=0;k<a._m.length;++k){var l=a._m[k];if(d(l,j)){var m=null,n=l.residues();b.rindex&&(b.rindices=[b.rindex]),b.rnumRange&&(n=l.residuesInRnumRange(b.rnumRange[0],b.rnumRange[1]));var o,p,q=[];if(void 0!==b.rindexRange){for(o=b.rindexRange[0],p=Math.min(n.length,b.rindexRange[1]);p>o;++o)q.push(n[o]);n=q}else if(b.rindices&&void 0!==b.rindices.length){for(q=[],o=0;o<b.rindices.length;++o)q.push(n[b.rindices[o]]);n=q}for(var r=0;r<n.length;++r)if(d(n[r],e)){m||(m=c.addChain(l,!1));for(var s=null,t=n[r].atoms(),v=0;v<t.length;++v)d(t[v],f)&&(s||(s=m.addResidue(n[r],!1)),s.addAtom(t[v]))}}}return c}function k(){}function l(){}function m(){}function n(){}function o(a,b,c){var d=b.atom("C"),e=c.atom("N");if(d&&e){var f=vec3.sqrDist(d.pos(),e.pos());1.6*1.6>f&&a.connect(e,d)}}function p(a,b,c){var d=b.atom("O3'"),e=c.atom("P");if(d&&e){var f=vec3.sqrDist(d.pos(),e.pos());1.7*1.7>f&&a.connect(d,e)}}function q(a){k.call(this),this._m=[],this._M=[],this._dH=a,this._cl=0}function r(a,b){l.call(this),this._o=a,this._C=b,this._5=[],this._k=[],this._bk=!0}function s(a,b,c,d){m.call(this),this._C=b,this._c5=c,this._df=d,this._A=[],this._cb="C",this._F=a,this._cs=!1,this._cr=!1,this._bO=a.residues().length}function t(a,b,c,d,e){n.call(this),this._B=a,this._b2=[],this._C=b,this._ch=c,this._bO=e,this._2=d}function u(a){k.call(this),this._cn=a,this._m=[]}function v(a,b){l.call(this),this._F=b,this._k=[],this._dc=a,this._cf={}}function w(a,b){m.call(this),this._dr=a,this._A=[],this._B=b}function x(a,b){n.call(this),this._c0=a,this._T=b,this._b2=[]}function y(a){for(var b=0;b<a.length();++b)D(a,b)?a.residueAt(b).setSS("H"):E(a,b)?a.residueAt(b).setSS("E"):a.residueAt(b).setSS("C")}function z(a){for(var b=a.chains(),c=0;c<b.length;++c){var d=b[c];d.eachBackboneTrace(y)}}var A={H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69};
k.prototype={eachResidue:function(a){for(var b=0;b<this._m.length;b+=1)if(this._m[b].eachResidue(a)===!1)return!1},eachAtom:function(a,b){b|=0;for(var c=0;c<this._m.length;c+=1)if(b=this._m[c].eachAtom(a,b),b===!1)return!1},residueCount:function(){for(var a=this.chains(),b=0,c=0;c<a.length;++c)b+=a[c].residues().length;return b},eachChain:function(a){for(var b=this.chains(),c=0;c<b.length;++c)if(a(b[c])===!1)return},atomCount:function(){for(var a=this.chains(),b=0,c=0;c<a.length;++c)b+=a[c].atomCount();return b},atoms:function(){var a=[];return this.eachAtom(function(b){a.push(b)}),a},atom:function(a){var b=a.split("."),c=this.chain(b[0]);if(null===c)return null;var d=c.residueByRnum(parseInt(b[1],10));return null===d?null:d.atom(b[2])},center:function(){var a=vec3.create(),b=0;return this.eachAtom(function(c){vec3.add(a,a,c.pos()),b+=1}),b&&vec3.scale(a,a,1/b),a},boundingSphere:function(){var a=this.center(),b=0;return this.eachAtom(function(c){b=Math.max(b,vec3.sqrDist(a,c.pos()))}),new Sphere(a,b)},backboneTraces:function(){for(var a=this.chains(),b=[],c=0;c<a.length;++c)Array.prototype.push.apply(b,a[c].backboneTraces());return b},select:function(a){return"protein"===a?this.residueSelect(function(a){return a.isAminoacid()}):"water"===a?this.residueSelect(function(a){return a.isWater()}):"ligand"===a?this.residueSelect(function(a){return!a.isAminoacid()&&!a.isWater()}):j(structure,a)},selectWithin:function(){var a=vec3.create();return function(b,c){c=c||{};var d=c.radius||4,e=d*d,f=!!c.matchResidues,g=[];b.eachAtom(function(a){g.push(a)});for(var h=new u(this.full()),i=null,j=null,k=this.chains(),l=!1,m=0;m<k.length;++m){var n=k[m].residues();j=null;for(var o=0;o<n.length;++o){i=null,l=!1;for(var p=n[o].atoms(),q=0;q<p.length&&!l;++q)for(var r=0;r<g.length;++r)if(vec3.sub(a,p[q].pos(),g[r].pos()),!(vec3.sqrLen(a)>e)){if(j||(j=h.addChain(k[m].full(),!1)),i||(i=j.addResidue(n[o].full(),f)),f){l=!0;break}i.addAtom(p[q].full())}}}return h}}(),residueSelect:function(a){for(var b=new u(this.full()),c=0;c<this._m.length;++c)for(var d=this._m[c],e=null,f=d.residues(),g=0;g<f.length;++g)a(f[g])&&(e||(e=b.addChain(d,!1)),e.addResidue(f[g],!0));return b},assembly:function(a){for(var b=this.assemblies(),c=0;c<b.length;++c)if(b[c].name()===a)return b[c];return null},chainsByName:function(a){for(var b={},c=this.chains(),d=0;d<c.length;++d)b[c[d].name()]=c[d];for(var e=[],f=0;f<a.length;++f){var g=b[a[f]];void 0!==g&&e.push(g)}return e}},l.prototype={eachAtom:function(a,b){b|=0;for(var c=0;c<this._k.length;c+=1)if(b=this._k[c].eachAtom(a,b),b===!1)return!1;return b},atomCount:function(){for(var a=0,b=this.residues(),c=0;c<b.length;++c)a+=b[c].atoms().length;return a},eachResidue:function(a){for(var b=0;b<this._k.length;b+=1)if(a(this._k[b])===!1)return!1},residues:function(){return this._k},structure:function(){return this._o},asView:function(){var a=new u(this.structure().full());return a.addChain(this,!0),a},residueByRnum:function(a){var b=this.residues();if(this._bk){var c=binarySearch(b,f(a),e);return-1===c?null:b[c]}for(var d=0;d<b.length;++d)if(b[d].num()===a)return b[d];return null},prop:function(a){return this[a]()}},m.prototype={prop:function(a){return this[a]()},isWater:function(){return"HOH"===this.name()||"DOD"===this.name()},eachAtom:function(a,b){b|=0;for(var c=0;c<this._A.length;c+=1){if(a(this._A[c],b)===!1)return!1;b+=1}return b},qualifiedName:function(){return this.chain().name()+"."+this.name()+this.num()},atom:function(a){if("string"==typeof a){for(var b=0;b<this._A.length;++b)if(this._A[b].name()===a)return this._A[b];return null}return a>=this._A.length&&0>a?null:this._A[a]},centralAtom:function(){return this.isAminoacid()?this.atom("CA"):this.isNucleotide()?this.atom("C3'"):null},center:function(){var a=0,b=vec3.create();return this.eachAtom(function(c){vec3.add(b,b,c.pos()),a+=1}),a>0&&vec3.scale(b,b,1/a),b},isAminoacid:function(){return this._cs},isNucleotide:function(){return this._cr}},n.prototype={name:function(){return this._C},pos:function(){return this._ch},element:function(){return this._2},index:function(){return this._bO},prop:function(a){return this[a]()},bondCount:function(){return this.bonds().length},eachBond:function(a){for(var b=this.bonds(),c=0,d=b.length;d>c;++c)a(b[c])}},derive(q,k,{addAssembly:function(a){this._M.push(a)},setAssemblies:function(a){this._M=a},assemblies:function(){return this._M},chains:function(){return this._m},full:function(){return this},containsResidue:function(a){return a.full().structure()===this},chainByName:function(a){for(var b=0;b<this._m.length;++b)if(this._m[b].name()===a)return this._m[b];return null},chain:function(a){return this.chainByName(a)},nextAtomIndex:function(){var a=this._cl;return this._cl+=1,a},addChain:function(a){var b=new r(this,a);return this._m.push(b),b},connect:function(a,b){var c=new B(a,b);return a.addBond(c),b.addBond(c),c},deriveConnectivity:function(){var a=this,c=null;this.eachResidue(function(d){var e;vec3.create();for(var f=0;f<d.atoms().length;f+=1)for(var g=d.atom(f),h=b(g.element()),i=0;f>i;i+=1){var j=d.atom(i),k=b(j.element());e=vec3.sqrDist(g.pos(),j.pos());var l=h+k-.3,m=h+k+.3;m*m>e&&e>l*l&&a.connect(d.atom(f),d.atom(i))}d._dq(),null!==c&&(d.isAminoacid()&&c.isAminoacid()&&o(a,c,d),d.isNucleotide()&&c.isNucleotide()&&p(a,c,d)),c=d})}}),derive(r,l,{name:function(){return this._C},full:function(){return this},addResidue:function(a,b,d){d=d||"\0";var e=new s(this,a,b,d);if(this._k.length>0&&this._bk){var f=c(b,d),g=this._k[this._k.length-1],h=c(g.num(),g.insCode());this._bk=f>h}return this._k.push(e),e},residuesInRnumRange:function(a,b){var c,d,g=[];if(this._bk===!0){var h=indexFirstLargerEqualThan(this._k,f(a),e);if(-1===h)return g;var i=indexLastSmallerEqualThan(this._k,f(b),e);if(-1===i)return g;for(c=h;i>=c;++c)g.push(this._k[c])}else for(c=0,d=this._k.length;c!==d;++c){var j=this._k[c];j.num()>=a&&j.num()<=b&&g.push(j)}return g},assignSS:function(a,b,d){for(var e=c(a[0],a[1]),f=c(b[0],b[1]),g=1;g<this._k.length-1;++g){var h=this._k[g],i=c(h.num(),h.insCode());e>=i||i>=f||h.setSS(d)}},eachBackboneTrace:function(a){this._du();for(var b=0;b<this._5.length;++b)a(this._5[b])},_du:function(){if(!(this._5.length>0)){for(var a=new BackboneTrace,b=null,c=0;c<this._k.length;c+=1){var d=this._k[c],e=d.isAminoacid(),f=d.isNucleotide();if(b===!0&&!e||b===!1&&!f||null===b&&!f&&!e)a.length()>1&&this._5.push(a),b=null,a=new BackboneTrace;else if(0!==a.length()){var g,h;b?(g=this._k[c-1].atom("C"),h=d.atom("N")):(g=this._k[c-1].atom("O3'"),h=d.atom("P"));var i=vec3.sqrDist(g.pos(),h.pos());Math.abs(i-2.25)<1?a.push(d):a.length()>1&&(this._5.push(a),a=new BackboneTrace)}else a.push(d),b=d.isAminoacid()}a.length()>1&&this._5.push(a)}},backboneTraces:function(){var a=[];return this.eachBackboneTrace(function(b){a.push(b)}),a}}),derive(s,m,{_dq:function(){this._cr=null!==this.atom("P")&&null!==this.atom("C3'"),this._cs=null!==this.atom("N")&&null!==this.atom("CA")&&null!==this.atom("C")&&null!==this.atom("O")},name:function(){return this._C},insCode:function(){return this._df},num:function(){return this._c5},full:function(){return this},addAtom:function(a,b,c){var d=new t(this,a,b,c,this.structure().nextAtomIndex());return this._A.push(d),d},ss:function(){return this._cb},setSS:function(a){this._cb=a},index:function(){return this._bO},atoms:function(){return this._A},chain:function(){return this._F},structure:function(){return this._F.structure()}}),derive(t,n,{addBond:function(a){this._b2.push(a)},name:function(){return this._C},bonds:function(){return this._b2},residue:function(){return this._B},structure:function(){return this._B.structure()},full:function(){return this},qualifiedName:function(){return this.residue().qualifiedName()+"."+this.name()}});var B=function(a,b){var c={atom_one:a,atom_two:b};return{atom_one:function(){return c.atom_one},atom_two:function(){return c.atom_two},mid_point:function(a){return a||(a=vec3.create()),vec3.add(a,c.atom_one.pos(),c.atom_two.pos()),vec3.scale(a,a,.5),a}}};derive(u,k,{full:function(){return this._cn},assemblies:function(){return this._cn.assemblies()},addChain:function(a,b){var c=new v(this,a.full());if(this._m.push(c),b)for(var d=a.residues(),e=0;e<d.length;++e)c.addResidue(d[e],!0);return c},containsResidue:function(a){if(!a)return!1;var b=this.chain(a.chain().name());return b?b.containsResidue(a):!1},chains:function(){return this._m},chain:function(a){for(var b=0;b<this._m.length;++b)if(this._m[b].name()===a)return this._m[b];return null}}),derive(v,l,{addResidue:function(a,b){var c=new w(this,a.full());if(this._k.push(c),this._cf[a.full().index()]=c,b)for(var d=a.atoms(),e=0;e<d.length;++e)c.addAtom(d[e].full());return c},containsResidue:function(a){var b=this._cf[a.full().index()];return void 0===b?!1:b.full()===a.full()},eachBackboneTrace:function(a){for(var b=this._F.backboneTraces(),c=0;c<b.length;++c)for(var d=b[c].subsets(this._k),e=0;e<d.length;++e)a(d[e])},backboneTraces:function(){var a=[];return this.eachBackboneTrace(function(b){a.push(b)}),a},full:function(){return this._F},name:function(){return this._F.name()},structure:function(){return this._dc}}),derive(w,m,{addAtom:function(a){var b=new x(this,a.full());this._A.push(b)},full:function(){return this._B},num:function(){return this._B.num()},insCode:function(){return this._B.insCode()},ss:function(){return this._B.ss()},index:function(){return this._B.index()},chain:function(){return this._dr},name:function(){return this._B.name()},atoms:function(){return this._A},qualifiedName:function(){return this._B.qualifiedName()},containsResidue:function(a){return this._B.full()===a.full()}}),derive(x,n,{full:function(){return this._T},name:function(){return this._T.name()},pos:function(){return this._T.pos()},element:function(){return this._T.element()},residue:function(){return this._c0},bonds:function(){return this._T.bonds()},index:function(){return this._T.index()},qualifiedName:function(){return this._T.qualifiedName()}});var C=function(){var a=vec3.create(),b=vec3.create();return function(c,d,e,f){for(var g=Math.max(0,d-2);d>=g;++g)for(var h=2;5>h;++h)if(!(g+h>=c.length())){var i=vec3.dist(c.posAt(a,g),c.posAt(b,g+h));if(Math.abs(i-e[h-2])>f)return!1}return!0}}(),D=function(a,b){var c=[5.45,5.18,6.37],d=2.1;return C(a,b,c,d)},E=function(a,b){var c=[6.1,10.4,13],d=1.42;return C(a,b,c,d)};return a.mol={},a.mol.Mol=q,a.mol.Chain=r,a.mol.Residue=s,a.mol.Atom=t,a.mol.MolView=u,a.mol.ChainView=v,a.mol.ResidueView=w,a.mol.AtomView=x,a.mol.assignHelixSheet=z,!0}(this),function(a){function b(){this._M={},this._D=null}function c(){this._bQ=[],this._bB=[],this._o=new mol.Mol,this._cg=new b,this._bw=null,this._be=null,this._dK=null}function d(a){var b=new c,d=a.split(/\r\n|\r|\n/g),e=0;for(e=0;e<d.length&&b.processLine(d[e]);e++);var f=b.finish();return f}b.prototype={assemblies:function(){var a=[];for(var b in this._M)a.push(this._M[b]);return a},assembly:function(a){return this._M[a]},nextLine:function(a){if(a=a.substr(11),"B"===a[0]&&"BIOMOLECULE:"===a.substr(0,12)){var b=a.substr(13).trim();return this._cI=new Assembly(b),this._M[b]=this._cI,void 0}if("APPLY THE FOLLOWING TO CHAINS:"!==a.substr(0,30)&&"                   AND CHAINS:"!==a.substr(0,30)){if("  BIOMT"===a.substr(0,7)){for(var c=parseInt(a[7],10)-1,d=0;" "!==a[12+d];)d+=1;var e=parseFloat(a.substr(13+d,9)),f=parseFloat(a.substr(23+d,9)),g=parseFloat(a.substr(33+d,9)),h=parseFloat(a.substr(43+d,14));return this._4[0+c]=e,this._4[4+c]=f,this._4[8+c]=g,this._4[12+c]=h,2===c&&(this._bU.addMatrix(this._4),this._4=mat4.create()),void 0}}else{var i=a.substr(30).split(",");"A"===a[0]&&(this._bU=new SymGenerator,this._cI.addGenerator(this._bU)),this._4=mat4.create();for(var j=0;j<i.length;++j){var k=i[j].trim();k.length&&this._bU.addChain(k)}}}},c.prototype={parseHelixRecord:function(a){var b=parseInt(a.substr(21,4),10),c=" "===a[25]?"\0":a[25],d=parseInt(a.substr(33,4),10),e=" "===a[37]?"\0":a[37],f=a[19];return this._bQ.push({first:[b,c],last:[d,e],chainName:f}),!0},parseSheetRecord:function(a){var b=parseInt(a.substr(22,4),10),c=" "===a[26]?"\0":a[26],d=parseInt(a.substr(33,4),10),e=" "===a[37]?"\0":a[37],f=a[21];return this._bB.push({first:[b,c],last:[d,e],chainName:f}),!0},parseAndAddAtom:function(a){var b=a[16];if(" "!==b&&"A"!==b)return!0;var c=a[21],d=a.substr(17,3).trim(),e=a.substr(12,4).trim(),f=parseInt(a.substr(22,4),10),g=" "===a[26]?"\0":a[26],h=!1,i=!1;this._bw&&this._bw.name()===c||(i=!0,h=!0),this._be&&this._be.num()===f&&this._be.insCode()===g||(h=!0),i&&(this._bw=this._o.chain(c)||this._o.addChain(c)),h&&(this._be=this._bw.addResidue(d,f,g));for(var j=vec3.create(),k=0;3>k;++k)j[k]=parseFloat(a.substr(30+8*k,8));return this._be.addAtom(e,j,a.substr(76,2).trim()),!0},processLine:function(a){var b=a.substr(0,6);if("ATOM  "===b)return this.parseAndAddAtom(a,!1);if("HETATM"===b)return this.parseAndAddAtom(a,!0);if("REMARK"===b){var c=a.substr(7,3);return"350"===c&&this._cg.nextLine(a),!0}return"HELIX "===b?this.parseHelixRecord(a):"SHEET "===b?this.parseSheetRecord(a):"END   "===b||"ENDMDL"===b?!1:!0},finish:function(){var a=null;for(i=0;i<this._bB.length;++i){var b=this._bB[i];a=this._o.chain(b.chainName),a&&a.assignSS(b.first,b.last,"E")}for(i=0;i<this._bQ.length;++i){var c=this._bQ[i];a=this._o.chain(c.chainName),a&&a.assignSS(c.first,c.last,"H")}return this._o.setAssemblies(this._cg.assemblies()),this._o.deriveConnectivity(),this._o}},a.io={},a.io.pdb=d,a.io.Remark350Reader=b}(this),"undefined"!=typeof exports&&(exports.AtomVertexAssoc=AtomVertexAssoc),AtomVertexAssoc.prototype={addAssoc:function(a,b,c,d){this._x.push({atom:a,vertexArray:b,vertStart:c,vertEnd:d})},recolor:function(a,b){var c=new Float32Array(4*b.atomCount());this._bg&&a.begin(this._o);var d={};b.eachAtom(function(b,e){d[b.index()]=e,a.colorFor(b,c,4*e)}),this._bg&&a.end(this._o);for(var e=0;e<this._x.length;++e){var f=this._x[e],g=d[f.atom.index()];if(void 0!==g)for(var h=c[4*g+0],i=c[4*g+1],j=c[4*g+2],k=c[4*g+3],l=f.vertexArray,m=f.vertStart;m<f.vertEnd;++m)l.setColor(m,h,i,j,k)}},getColorForAtom:function(a,b){for(var c=0;c<this._x.length;++c){var d=this._x[c];if(d.atom.full()===a.full())return d.vertexArray.getColor(d.vertStart,b)}return null},setOpacity:function(a){for(var b=0;b<this._x.length;++b)for(var c=this._x[b],d=c.vertexArray,e=c.vertStart;e<c.vertEnd;++e)d.setOpacity(e,a)}},"undefined"!=typeof exports&&(exports.TraceVertexAssoc=TraceVertexAssoc),TraceVertexAssoc.prototype={setPerResidueColors:function(a,b){this._bG[a]=b},addAssoc:function(a,b,c,d,e){this._x.push({traceIndex:a,slice:c,vertStart:d,vertEnd:e,vertexArray:b})},recolor:function(a,b){this._bg&&a.begin(this._o);var c,d,e=[],f=this._o.backboneTraces();for(c=0;c<f.length;++c){var g=this._bG[c],h=0,i=f[c];for(d=0;d<i.length();++d)b.containsResidue(i.residueAt(d))?(a.colorFor(i.centralAtomAt(d),g,h),h+=4):h+=4;this._ct>1?e.push(interpolateColor(g,this._ct)):e.push(g)}for(c=0;c<this._x.length;++c){var j=this._x[c],k=j.slice,l=e[j.traceIndex],m=l[4*k],n=l[4*k+1],o=l[4*k+2],p=l[4*k+3],q=j.vertexArray;for(d=j.vertStart;d<j.vertEnd;++d)q.setColor(d,m,n,o,p)}this._bg&&a.end(this._o)},getColorForAtom:function(a,b){var c,d,e=this._o.backboneTraces(),f=a.full().residue();for(c=0;c<e.length;++c){var g=this._bG[c],h=0,i=e[c];for(d=0;d<i.length();++d){if(f===i.residueAt(d).full())return b[0]=g[h+0],b[1]=g[h+1],b[2]=g[h+2],b[3]=g[h+3],b;h+=4}}return null},setOpacity:function(a){for(i=0;i<this._x.length;++i){var b=this._x[i],c=b.vertexArray;for(j=b.vertStart;j<b.vertEnd;++j)c.setOpacity(j,a)}}},function(a){"use strict";function b(a){this._bb=[],this._bW=a}function c(a){this._bW=a}return b.prototype.request=function(a){for(var b=-1,c=null,d=0;d<this._bb.length;++d){var e=this._bb[d],f=e.length;f>=a&&(null===c||c>f)&&(c=f,b=d)}if(-1!==b){var g=this._bb[b];return this._bb.splice(b,1),g}return new this._bW(a)},b.prototype.release=function(a){this._bb.push(a)},c.prototype.request=function(a){return new this._bW(a)},c.prototype.release=function(){},a.PoolAllocator=b,a.NativeAllocator=c,!0}(this),function(a){"use strict";function b(a,b,c){this._=a,this._b5=a.createBuffer(),this._E=c||null,this._y=!1,this._b0=null;var d=this._p*b;this._d=c.request(d)}b.prototype={setColor:function(a,b,c,d,e){var f=a*this._p+this._6;this._d[f+0]=b,this._d[f+1]=c,this._d[f+2]=d,this._d[f+3]=e,this._y=!1},getColor:function(a,b){var c=a*this._p+this._6;return b[0]=this._d[c+0],b[1]=this._d[c+1],b[2]=this._d[c+2],b[3]=this._d[c+3],b},setOpacity:function(a,b){var c=a*this._p+this._6;this._d[c+3]=b,this._y=!1},boundingSphere:function(){return this._b0||(this._b0=this._dt()),this._b0},_dt:function(){var a=this.numVerts();if(0===a)return null;var b,c,d=vec3.create();for(c=0;a>c;++c)b=c*this._p,d[0]+=this._d[b+0],d[1]+=this._d[b+1],d[2]+=this._d[b+2];vec3.scale(d,d,1/a);var e=0;for(c=0;a>c;++c){b=c*this._p;var f=d[0]-this._d[b+0],g=d[1]-this._d[b+1],h=d[2]-this._d[b+2];e=Math.max(e,f*f+g*g+h*h)}return new geom.Sphere(d,Math.sqrt(e))},destroy:function(){this._.deleteBuffer(this._b5),this._E.release(this._d)},bindBuffers:function(){this._.bindBuffer(this._.ARRAY_BUFFER,this._b5),this._y||(this._.bufferData(this._.ARRAY_BUFFER,this._d,this._.STATIC_DRAW),this._y=!0)},updateSquaredSphereRadius:function(){var a=vec3.create();return function(b,c,d){var e=this.boundingSphere();if(!e)return c;if(d)return vec3.transformMat4(a,e.center(),d),Math.max(vec3.sqrDist(a,b),c);var f=e.radius()*e.radius();return Math.max(vec3.sqrDist(e.center(),b)+f,c)}}(),updateProjectionIntervals:function(){var a=vec3.create();return function(b,c,d,e,f,g,h){var i=this.boundingSphere();if(i){h?vec3.transformMat4(a,i.center(),h):vec3.copy(a,i.center());var j=vec3.dot(b,a),k=vec3.dot(c,a),l=vec3.dot(d,a);e.update(j-i.radius()),e.update(j+i.radius()),f.update(k-i.radius()),f.update(k+i.radius()),g.update(l-i.radius()),g.update(l+i.radius())}}}()},a.VertexArrayBase=b}(this),function(a){"use strict";function b(a,b,c,d,e){VertexArrayBase.call(this,a,b,d),this._cx=a.createBuffer(),this._I=e,this._bJ=0,this._dd=b,this._bl=0,this._1=e.request(c)}return derive(b,VertexArrayBase,{destroy:function(){VertexArrayBase.prototype.destroy.call(this),this._.deleteBuffer(this._cx),this._I.release(this._1)},numVerts:function(){return this._bJ},maxVerts:function(){return this._dd},numIndices:function(){return 3*this._bl},addVertex:function(a,b,c,d){var e=this._bJ*this._p;this._d[e++]=a[0],this._d[e++]=a[1],this._d[e++]=a[2],this._d[e++]=b[0],this._d[e++]=b[1],this._d[e++]=b[2],this._d[e++]=c[0],this._d[e++]=c[1],this._d[e++]=c[2],this._d[e++]=c[3],this._d[e++]=d,this._bJ+=1,this._y=!1},_p:11,_dy:10,_6:6,_dz:3,_b3:0,addTriangle:function(a,b,c){var d=3*this._bl;d>=this._1.length||(this._1[d++]=a,this._1[d++]=b,this._1[d++]=c,this._bl+=1,this._y=!1)},bindBuffers:function(){var a=this._y;VertexArrayBase.prototype.bindBuffers.call(this),this._.bindBuffer(this._.ELEMENT_ARRAY_BUFFER,this._cx),a||this._.bufferData(this._.ELEMENT_ARRAY_BUFFER,this._1,this._.STATIC_DRAW)},bindAttribs:function(a){this._.enableVertexAttribArray(a.posAttrib),this._.vertexAttribPointer(a.posAttrib,3,this._.FLOAT,!1,4*this._p,4*this._b3),-1!==a.normalAttrib&&(this._.enableVertexAttribArray(a.normalAttrib),this._.vertexAttribPointer(a.normalAttrib,3,this._.FLOAT,!1,4*this._p,4*this._dz)),-1!==a.colorAttrib&&(this._.vertexAttribPointer(a.colorAttrib,4,this._.FLOAT,!1,4*this._p,4*this._6),this._.enableVertexAttribArray(a.colorAttrib)),-1!==a.objIdAttrib&&(this._.vertexAttribPointer(a.objIdAttrib,1,this._.FLOAT,!1,4*this._p,4*this._dy),this._.enableVertexAttribArray(a.objIdAttrib))},releaseAttribs:function(a){this._.disableVertexAttribArray(a.posAttrib),-1!==a.colorAttrib&&this._.disableVertexAttribArray(a.colorAttrib),-1!==a.normalAttrib&&this._.disableVertexAttribArray(a.normalAttrib),-1!==a.objIdAttrib&&this._.disableVertexAttribArray(a.objIdAttrib)},bind:function(a){this.bindBuffers(),this.bindAttribs(a)},draw:function(){this._.drawElements(this._.TRIANGLES,3*this._bl,this._.UNSIGNED_SHORT,0)}}),a.IndexedVertexArray=b,!0}(this),function(a){"use strict";function b(a,b,c){VertexArrayBase.call(this,a,b,c),this._bm=0}return derive(b,VertexArrayBase,{_p:8,_b3:0,_6:3,_dA:7,numVerts:function(){return 2*this._bm},addLine:function(a,b,c,d,e,f){var g=2*this._p*this._bm;this._d[g++]=a[0],this._d[g++]=a[1],this._d[g++]=a[2],this._d[g++]=b[0],this._d[g++]=b[1],this._d[g++]=b[2],this._d[g++]=b[3],this._d[g++]=e,this._d[g++]=c[0],this._d[g++]=c[1],this._d[g++]=c[2],this._d[g++]=d[0],this._d[g++]=d[1],this._d[g++]=d[2],this._d[g++]=d[3],this._d[g++]=f,this._bm+=1,this._y=!1,this._dL=null},bindAttribs:function(a){this._.vertexAttribPointer(a.posAttrib,3,this._.FLOAT,!1,4*this._p,4*this._b3),-1!==a.colorAttrib&&(this._.vertexAttribPointer(a.colorAttrib,4,this._.FLOAT,!1,4*this._p,4*this._6),this._.enableVertexAttribArray(a.colorAttrib)),this._.enableVertexAttribArray(a.posAttrib),-1!==a.objIdAttrib&&(this._.vertexAttribPointer(a.objIdAttrib,1,this._.FLOAT,!1,4*this._p,4*this._dA),this._.enableVertexAttribArray(a.objIdAttrib))},releaseAttribs:function(a){this._.disableVertexAttribArray(a.posAttrib),-1!==a.colorAttrib&&this._.disableVertexAttribArray(a.colorAttrib),-1!==a.objIdAttrib&&this._.disableVertexAttribArray(a.objIdAttrib)},bind:function(a){this.bindBuffers(),this.bindAttribs(a)},draw:function(){this._.drawArrays(this._.LINES,0,2*this._bm)}}),a.VertexArray=b,!0}(this),function(a){"use strict";function b(a,b,c,d){VertexArray.call(this,b,c,d),this._F=a}function c(a,b,c,d,e,f){IndexedVertexArray.call(this,b,c,d,e,f),this._F=a}return derive(b,VertexArray,{chain:function(){return this._F},drawSymmetryRelated:function(a,b,c){this.bind(b);for(var d=0;d<c.length;++d)a.bind(b,c[d]),this._.uniform1i(b.symId,d),this.draw();this.releaseAttribs(b)}}),derive(c,IndexedVertexArray,{chain:function(){return this._F}}),c.prototype.drawSymmetryRelated=b.prototype.drawSymmetryRelated,a.LineChainData=b,a.MeshChainData=c,!0}(this),function(a){"use strict";function b(a,b){this._c=b,this._bA=a,this._g=new Uint16Array(2*3*b*a),this._j=new Float32Array(3*b*a);var c,d,e=Math.PI/(a-1),f=2*Math.PI/b;for(c=0;c<this._bA;++c){var g=Math.sin(c*e),h=Math.cos(c*e);for(d=0;d<this._c;++d){var i=g*Math.cos(d*f),j=g*Math.sin(d*f);this._j[3*(d+c*this._c)]=i,this._j[3*(d+c*this._c)+1]=j,this._j[3*(d+c*this._c)+2]=h}}var k=0;for(c=0;c<this._bA-1;++c)for(d=0;d<this._c;++d)this._g[k]=c*this._c+d,this._g[k+1]=c*this._c+(d+1)%this._c,this._g[k+2]=(c+1)*this._c+d,k+=3,this._g[k]=c*this._c+(d+1)%this._c,this._g[k+1]=(c+1)*this._c+(d+1)%this._c,this._g[k+2]=(c+1)*this._c+d,k+=3}function c(a,b,c){var d=geom.catmullRomSpline(a,a.length/3,b,c,!0);this._g=new Uint16Array(2*d.length),this._j=d,this._u=new Float32Array(d.length),this._c=d.length/3;var e=vec3.create();vec3.create();for(var f=0;f<this._c;++f){var g=0===f?this._c-1:f-1,h=f===this._c-1?0:f+1;e[0]=this._j[3*h+1]-this._j[3*g+1],e[1]=this._j[3*g]-this._j[3*h],vec3.normalize(e,e),this._u[3*f]=e[0],this._u[3*f+1]=e[1],this._u[3*f+2]=e[2]}for(f=0;f<this._c;++f)this._g[6*f]=f,this._g[6*f+1]=f+this._c,this._g[6*f+2]=(f+1)%this._c+this._c,this._g[6*f+3]=f,this._g[6*f+4]=(f+1)%this._c+this._c,this._g[6*f+5]=(f+1)%this._c}function d(a){this._c=a,this._g=new Uint16Array(2*3*a),this._j=new Float32Array(2*3*a),this._u=new Float32Array(2*3*a);for(var b=2*Math.PI/this._c,c=0;c<this._c;++c){var d=Math.cos(b*c),e=Math.sin(b*c);this._j[3*c]=d,this._j[3*c+1]=e,this._j[3*c+2]=-.5,this._j[3*a+3*c]=d,this._j[3*a+3*c+1]=e,this._j[3*a+3*c+2]=.5,this._u[3*c]=d,this._u[3*c+1]=e,this._u[3*a+3*c]=d,this._u[3*a+3*c+1]=e}for(c=0;c<this._c;++c)this._g[6*c]=c%this._c,this._g[6*c+1]=a+(c+1)%this._c,this._g[6*c+2]=(c+1)%this._c,this._g[6*c+3]=c%this._c,this._g[6*c+4]=a+c%this._c,this._g[6*c+5]=a+(c+1)%this._c}b.prototype={addTransformed:function(){var a=vec3.create(),b=vec3.create();return function(c,d,e,f,g){for(var h=c.numVerts(),i=0;i<this._bA*this._c;++i)vec3.set(b,this._j[3*i],this._j[3*i+1],this._j[3*i+2]),vec3.copy(a,b),vec3.scale(a,a,e),vec3.add(a,a,d),c.addVertex(a,b,f,g);for(i=0;i<this._g.length/3;++i)c.addTriangle(h+this._g[3*i],h+this._g[3*i+1],h+this._g[3*i+2])}}(),numIndices:function(){return this._g.length},numVerts:function(){return this._j.length/3}},c.prototype={addTransformed:function(){var a=vec3.create(),b=vec3.create();return function(c,d,e,f,g,h,i,j){for(var k=c.numVerts()-this._c,l=0;l<this._c;++l)vec3.set(a,e*this._j[3*l],e*this._j[3*l+1],0),vec3.transformMat3(a,a,f),vec3.add(a,a,d),vec3.set(b,this._u[3*l],this._u[3*l+1],0),vec3.transformMat3(b,b,f),c.addVertex(a,b,g,j);if(!h)if(0!==i)for(l=0;l<this._c;++l)c.addTriangle(k+(l+i)%this._c,k+l+this._c,k+(l+1)%this._c+this._c),c.addTriangle(k+(l+i)%this._c,k+(l+1)%this._c+this._c,k+(l+1+i)%this._c);else for(l=0;l<this._g.length/3;++l)c.addTriangle(k+this._g[3*l],k+this._g[3*l+1],k+this._g[3*l+2])}}()},d.prototype={numVerts:function(){return this._j.length/3},numIndices:function(){return this._g.length},addTransformed:function(){var a=vec3.create(),b=vec3.create();return function(c,d,e,f,g,h,i,j,k){for(var l=c.numVerts(),m=0;m<2*this._c;++m){vec3.set(a,f*this._j[3*m],f*this._j[3*m+1],e*this._j[3*m+2]),vec3.transformMat3(a,a,g),vec3.add(a,a,d),vec3.set(b,this._u[3*m],this._u[3*m+1],this._u[3*m+2]),vec3.transformMat3(b,b,g);var n=m<this._c?j:k;c.addVertex(a,b,m<this._c?h:i,n)}for(m=0;m<this._g.length/3;++m)c.addTriangle(l+this._g[3*m],l+this._g[3*m+1],l+this._g[3*m+2])}}()},a.TubeProfile=c,a.ProtoSphere=b,a.ProtoCylinder=d}(this),function(a){"use strict";function b(a,b){void 0===a||void 0===b?(this._bu=!0,this._v=this._z=null):(this._bu=!1,this._v=a,this._z=b)}function c(a){this._bf=[],this._N=!0,this._C=name||"",this._=a,this._bI=1}function d(a,b){a.eachResidue(function(a){var c=a.centralAtom();null!==c&&b(c,c.pos())})}function e(a){c.call(this,a),this._bP=[],this._O=[],this._cc=null}function f(a,b){e.call(this,a),this._7=[],this._E=b,this._O=[],this._cq=1}function g(a,b,c){e.call(this,a),this._w=[],this._E=b,this._I=c,this._9=null,this._V=null}function h(a,b,d,e,f){c.call(this,a),this._bI=100,this._ch=e,this._de=this._.createBuffer(),this._h=new Float32Array(30),this._c2(b,d,f);var g=this._q/2,h=this._s/2;this._h[0]=e[0],this._h[1]=e[1],this._h[2]=e[2],this._h[3]=-g,this._h[4]=-h,this._h[5]=e[0],this._h[6]=e[1],this._h[7]=e[2],this._h[8]=g,this._h[9]=h,this._h[10]=e[0],this._h[11]=e[1],this._h[12]=e[2],this._h[13]=g,this._h[14]=-h,this._h[15]=e[0],this._h[16]=e[1],this._h[17]=e[2],this._h[18]=-g,this._h[19]=-h,this._h[20]=e[0],this._h[21]=e[1],this._h[22]=e[2],this._h[23]=-g,this._h[24]=h,this._h[25]=e[0],this._h[26]=e[1],this._h[27]=e[2],this._h[28]=g,this._h[29]=h}function i(a){for(var b=1;a>b;)b*=2;return b}function j(a,b,c){this._ci=a,this._8=b,this._bn=b,this._dm=c}function k(){this._l={},this._b8=0,this._bc=[]}function l(a,b,c,d,e){f.call(this,a,24,d,e);var g=rgb.fromValues(1,0,0),h=rgb.fromValues(0,1,0),i=rgb.fromValues(0,0,1),j=mat3.create();j[0]=c[0][0],j[1]=c[0][1],j[2]=c[0][2],j[3]=c[1][0],j[4]=c[1][1],j[5]=c[1][2],j[6]=c[2][0],j[7]=c[2][1],j[8]=c[2][2];var k=vec3.create(),l=vec3.create();this.addLine(vec3.add(k,b,vec3.transformMat3(k,[-1,-1,-1],j)),g,vec3.add(l,b,vec3.transformMat3(l,[1,-1,-1],j)),g,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[1,-1,-1],j)),h,vec3.add(l,b,vec3.transformMat3(l,[1,1,-1],j)),h,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[1,1,-1],j)),g,vec3.add(l,b,vec3.transformMat3(l,[-1,1,-1],j)),g,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[-1,1,-1],j)),h,vec3.add(l,b,vec3.transformMat3(l,[-1,-1,-1],j)),h,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[-1,-1,1],j)),g,vec3.add(l,b,vec3.transformMat3(l,[1,-1,1],j)),g,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[1,-1,1],j)),h,vec3.add(l,b,vec3.transformMat3(l,[1,1,1],j)),h,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[1,1,1],j)),g,vec3.add(l,b,vec3.transformMat3(l,[-1,1,1],j)),g,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[-1,1,1],j)),h,vec3.add(l,b,vec3.transformMat3(l,[-1,-1,1],j)),h,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[-1,-1,-1],j)),i,vec3.add(l,b,vec3.transformMat3(l,[-1,-1,1],j)),i,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[1,-1,-1],j)),i,vec3.add(l,b,vec3.transformMat3(l,[1,-1,1],j)),i,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[1,1,-1],j)),i,vec3.add(l,b,vec3.transformMat3(l,[1,1,1],j)),i,-1),this.addLine(vec3.add(k,b,vec3.transformMat3(k,[-1,1,-1],j)),i,vec3.add(l,b,vec3.transformMat3(l,[-1,1,1],j)),i,-1)
}b.prototype={min:function(){return this._v},max:function(){return this._z},length:function(){return this._z-this._v},empty:function(){return this._bu},center:function(){return.5*(this._z+this._v)},extend:function(a){this._v-=a,this._z+=a},update:function(a){return this._bu?(this._v=this._z=a,this._bu=!1,void 0):(a<this._v?this._v=a:a>this._z&&(this._z=a),void 0)}},c.prototype={order:function(a){return void 0!==a&&(this._bI=a),this._bI},add:function(a){this._bf.push(a)},draw:function(a,b,c,d){for(var e=0,f=this._bf.length;e!==f;++e)this._bf[e].draw(a,b,c,d)},show:function(){this._N=!0},hide:function(){this._N=!1},name:function(a){return void 0!==a&&(this._C=a),this._C},destroy:function(){for(var a=0;a<this._bf.length;++a)this._bf[a].destroy()},visible:function(){return this._N}};var m=function(){var a=vec3.create();return function(b,c,d){for(var e=0;e<c.length;++e)for(var f=c[e],g=b.chainsByName(f.chains()),h=0;h<f.matrices().length;++h)for(var i=f.matrix(h),j=0;j<g.length;++j)for(var k=g[j],l=0;l<k.residues().length;++l){var m=k.residues()[l].centralAtom();null!==m&&(vec3.transformMat4(a,m.pos(),i),d(m,a))}}}();derive(e,c,{setShowRelated:function(a){return this._cc=a,a},symWithIndex:function(a){if("asym"===this.showRelated())return null;var b=this.structure().assembly(this.showRelated());if(!b)return null;for(var c=b.generators(),d=0;d<c.length;++d){if(c[d].matrices().length>a)return c[d].matrix(a);a-=c[d].matrices().length}return null},showRelated:function(){return this._cc},select:function(a){return this.structure().select(a)},structure:function(){return this._O[0]._o},getColorForAtom:function(a,b){return this._dC[0].getColorForAtom(a,b)},addIdRange:function(a){this._bP.push(a)},destroy:function(){c.prototype.destroy.call(this);for(var a=0;a<this._bP.length;++a)this._bP[a].recycle()},eachCentralAtom:function(a){var b=this,c=b.structure(),e=c.assembly(b.showRelated());return null===e?d(c,a):m(c,e.generators(),a)},addVertAssoc:function(a){this._O.push(a)},_by:function(a){for(var b=this.vertArrays(),c=[],d={},e=0;e<a.length;++e)d[a[e]]=!0;for(var f=0;f<b.length;++f)d[b[f].chain()]===!0&&c.push(b[f]);return c},_dn:function(a,b,c){for(var d=c.generators(),e=0;e<d.length;++e){var f=d[e],g=this._by(f.chains());this._bv(a,b,g,f.matrices())}},_b7:function(a,b,c,d,e,f){for(var g=this.vertArrays(),h=0;h<g.length;++h)g[h].updateProjectionIntervals(a,b,c,d,e,f)},updateProjectionIntervals:function(a,b,c,d,e,f){if(this._N){var g=this.showRelated();if("asym"===g)return this._b7(a,b,c,d,e,f);var h=this.structure().assembly(g);if(!h)return this._b7(a,b,c,d,e,f);for(var i=h.generators(),j=0;j<i.length;++j)for(var k=i[j],l=this._by(k.chains()),m=0;m<k.matrices().length;++m)for(var n=0;n<l.length;++n){var o=k.matrix(m);l[n].updateProjectionIntervals(a,b,c,d,e,f,o)}}},_b6:function(a,b){for(var c=this.vertArrays(),d=0;d<c.length;++d)b=c[d].updateSquaredSphereRadius(a,b);return b},updateSquaredSphereRadius:function(a,b){if(!this._N)return b;var c=this.showRelated();if("asym"===c)return this._b6(a,b);var d=this.structure().assembly(c);if(!d)return this._b6(a,b);for(var e=d.generators(),f=0;f<e.length;++f)for(var g=e[f],h=this._by(g.chains()),i=0;i<g.matrices().length;++i)for(var j=0;j<h.length;++j)g.matrix(i),b=h[j].updateSquaredSphereRadius(a,b);return b},draw:function(a,b,c,d){if(this._N){var e=this.shaderForStyleAndPass(b,c,d);if(e){var f=this.showRelated();if("asym"===f)return this._bv(a,e,this.vertArrays(),null);var g=this.structure().assembly(f);return g?this._dn(a,e,g):this._bv(a,e,this.vertArrays(),null)}}},colorBy:function(a,b){this._y=!1,b=b||this.structure();for(var c=0;c<this._O.length;++c)this._O[c].recolor(a,b)},setOpacity:function(a,b){this._y=!1,b=b||this.structure();for(var c=0;c<this._O.length;++c)this._O[c].setOpacity(a,b)}}),derive(f,e,{addChainVertArray:function(a,b){var c=new LineChainData(a.name(),this._,b,this._E);return this._7.push(c),c},setLineWidth:function(a){this._cq=a},vertArrays:function(){return this._7},shaderForStyleAndPass:function(a,b,c){return"outline"===c?null:"select"===c?a.select:a.lines},destroy:function(){e.prototype.destroy.call(this);for(var a=0;a<this._7.length;++a)this._7[a].destroy();this._7=[]},_bv:function(a,b,c,d){this._.lineWidth(this._cq);var e;if(d)for(e=0;e<c.length;++e)c[e].drawSymmetryRelated(a,b,d);else for(this._.uniform1i(b.symId,255),a.bind(b),e=0;e<c.length;++e)c[e].bind(b),c[e].draw(),c[e].releaseAttribs(b)},vertArray:function(){return this._dD}}),derive(g,e,{_b1:function(a){return Math.min(65536,a)},addChainVertArray:function(a,b,c){this._9=b,this._V=c;var d=new MeshChainData(a.name(),this._,this._b1(b),c,this._E,this._I);return this._w.push(d),d},addVertArray:function(a,b){this._9=a,this._V=b;var c=new IndexedVertexArray(this._,this._b1(a),b,this._E,this._I);return this._w.push(c),c},vertArrayWithSpaceFor:function(a){var b=this._w[this._w.length-1],c=b.maxVerts()-b.numVerts();if(c>=a)return b;this._9=this._9-b.numVerts(),this._V=this._V-b.numIndices(),a=this._b1(this._9);var d=null;return d=b instanceof MeshChainData?new MeshChainData(b.chain(),this._,a,this._V,this._E,this._I):new IndexedVertexArray(this._,a,this._V,this._E,this._I),this._w.push(d),d},vertArray:function(a){return this._w[a]},destroy:function(){e.prototype.destroy.call(this);for(var a=0;a<this._w.length;++a)this._w[a].destroy();this._w=[]},numVerts:function(){return this._w[0].numVerts()},shaderForStyleAndPass:function(a,b,c){if("outline"===c)return a.outline;if("select"===c)return a.select;var d=a[b];return void 0!==d?d:null},_bv:function(a,b,c,d){var e;if(d)for(e=0;e<c.length;++e)c[e].drawSymmetryRelated(a,b,d);else for(a.bind(b),this._.uniform1i(b.symId,255),e=0;e<c.length;++e)c[e].bind(b),c[e].draw(),c[e].releaseAttribs(b)},vertArrays:function(){return this._w},addVertex:function(a,b,c,d){var e=this._w[0];e.addVertex(a,b,c,d)},addTriangle:function(a,b,c){var d=this._w[0];d.addTriangle(a,b,c)}}),derive(h,c,{updateProjectionIntervals:function(){},updateSquaredSphereRadius:function(a,b){return b},_ce:function(a){a.fillStyle="black",a.textAlign="left",a.textBaseline="bottom",a.font="24px Verdana"},_c2:function(a,b,c){this._ce(b);var d=b.measureText(c).width,e=24;a.width=i(d),a.height=i(e),this._ce(b),b.fillStyle="#666",b.globalAlpha=.5,b.fillRect(0,0,a.width,a.height),b.globalAlpha=1,b.fillStyle="black",b.lineWidth=.5,b.fillText(c,0,a.height),b.strokeText(c,0,a.height),this._ca=this._.createTexture(),this._cT(this._ca,a),this._cO=d/a.width,this._cN=e/a.height,this._q=.002*d,this._s=.002*e},_cT:function(a,b){this._.pixelStorei(this._.UNPACK_FLIP_Y_WEBGL,!0),this._.bindTexture(this._.TEXTURE_2D,a),this._.texImage2D(this._.TEXTURE_2D,0,this._.RGBA,this._.RGBA,this._.UNSIGNED_BYTE,b),this._.texParameteri(this._.TEXTURE_2D,this._.TEXTURE_MAG_FILTER,this._.LINEAR),this._.texParameteri(this._.TEXTURE_2D,this._.TEXTURE_MIN_FILTER,this._.LINEAR_MIPMAP_LINEAR),this._.generateMipmap(this._.TEXTURE_2D),this._.bindTexture(this._.TEXTURE_2D,null)},bind:function(){this._.bindBuffer(this._.ARRAY_BUFFER,this._de),this._.activeTexture(this._.TEXTURE0),this._.bindTexture(this._.TEXTURE_2D,this._ca),this._y||(this._.bufferData(this._.ARRAY_BUFFER,this._h,this._.STATIC_DRAW),this._y=!0)},draw:function(a,b,c,d){if(this._N&&"normal"===d){var e=b.text;a.bind(e),this.bind(),this._.uniform1f(this._.getUniformLocation(e,"xScale"),this._cO),this._.uniform1f(this._.getUniformLocation(e,"yScale"),this._cN),this._.uniform1i(this._.getUniformLocation(e,"sampler"),0);var f=this._.getAttribLocation(e,"attrCenter");this._.enableVertexAttribArray(f),this._.vertexAttribPointer(f,3,this._.FLOAT,!1,20,0);var g=this._.getAttribLocation(e,"attrCorner");this._.vertexAttribPointer(g,2,this._.FLOAT,!1,20,12),this._.enableVertexAttribArray(g),this._.enable(this._.BLEND),this._.blendFunc(this._.SRC_ALPHA,this._.ONE_MINUS_SRC_ALPHA),this._.drawArrays(this._.TRIANGLES,0,6),this._.disableVertexAttribArray(f),this._.disableVertexAttribArray(g),this._.disable(this._.BLEND)}}}),j.prototype={nextId:function(a){var b=this._bn;return this._bn++,this._ci._l[b]=a,b},recycle:function(){this._ci.recycle(this)},length:function(){return this._dm-this._8}},k.prototype={getContinuousRange:function(a){for(var b=-1,c=null,d=0;d<this._bc.length;++d){var e=this._bc[d],f=e.length();f>=a&&(null===c||c>f)&&(c=f,b=d)}if(-1!==b){var g=this._bc[b];return this._bc.splice(b,1),g}var h=this._b8,i=h+a;return i>65536?null:(this._b8=i,new j(this,h,i))},recycle:function(a){for(var b=a._8;b<a._bn;++b)delete this._l[b];a._bn=a._8,this._bc.push(a)},objectForId:function(a){return this._l[a]}},derive(l,f,{updateProjectionIntervals:function(){}}),a.SceneNode=c,a.OrientedBoundingBox=l,a.AtomVertexAssoc=AtomVertexAssoc,a.TraceVertexAssoc=TraceVertexAssoc,a.MeshGeom=g,a.LineGeom=f,a.TextLabel=h,a.UniqueObjectIdPool=k,a.Range=b}(this);var render=function(){"use strict";function a(a,b,c){for(var d=0;c-1>d;++d)a.addTriangle(b,b+1+d,b+2+d);a.addTriangle(b,b+c,b+1)}function b(a,b,c){for(var d=b+c,e=0;c-1>e;++e)a.addTriangle(d,b+e+1,b+e);a.addTriangle(d,b,b+c-1)}var c={},d=.7071,e=[-d,-d,0,d,-d,0,d,d,0,-d,d,0],f=[-6*d,-1*d,0,6*d,-1*d,0,6*d,1*d,0,-6*d,1*d,0],g=[-10*d,-1*d,0,10*d,-1*d,0,10*d,1*d,0,-10*d,1*d,0],h=function(){var a=vec3.create(),b=vec3.create(),c=vec3.create();return function(d,e,f,g){e=Math.max(e,1),f=Math.min(g-1,f);var h=3*(e-1);vec3.set(a,d[h],d[h+1],d[h+2]),vec3.set(c,d[3*e],d[3*e+1],d[3*e+2]);for(var i=e;f>i;++i)h=3*(i+1),vec3.set(b,d[h],d[h+1],d[h+2]),d[3*i+0]=.25*b[0]+.5*c[0]+.25*a[0],d[3*i+1]=.25*b[1]+.5*c[1]+.25*a[1],d[3*i+2]=.25*b[2]+.5*c[2]+.25*a[2],vec3.copy(a,c),vec3.copy(c,b)}}(),i=function(){return function(a,b,c,d,e){e?vec3.cross(d,b,c):geom.ortho(d,b),vec3.cross(c,d,b),vec3.normalize(d,d),vec3.normalize(c,c),a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=d[0],a[4]=d[1],a[5]=d[2],a[6]=b[0],a[7]=b[1],a[8]=b[2]}}(),j=function(){var a=vec4.fromValues(0,0,0,1);return function(b,c,d,e){var f=e.atomCount(),g=d.idPool.getContinuousRange(f),h=d.protoSphere.numVerts(),i=d.protoSphere.numIndices(),j=1.5*d.radiusMultiplier;b.addIdRange(g),b.addChainVertArray(e,h*f,i*f),e.eachAtom(function(e){var f=b.vertArrayWithSpaceFor(h);d.color.colorFor(e,a,0);var i=f.numVerts(),k=g.nextId({geom:b,atom:e});d.protoSphere.addTransformed(f,e.pos(),j,a,k);var l=f.numVerts();c.addAssoc(e,f,i,l)})}}();c.spheres=function(a,b,c){var d=new ProtoSphere(c.sphereDetail,c.sphereDetail);c.protoSphere=d;var e=new MeshGeom(b,c.float32Allocator,c.uint16Allocator),f=new AtomVertexAssoc(a,!0);return e.addVertAssoc(f),e.setShowRelated(c.showRelated),c.color.begin(a),a.eachChain(function(a){j(e,f,c,a)}),c.color.end(a),e};var k=function(){var a=vec3.create(),b=vec3.create(),c=vec4.fromValues(0,0,0,1),d=vec3.create(),e=vec3.create(),f=mat3.create();return function(g,h,j,k){var l=k.atomCount(),m=0;k.eachAtom(function(a){m+=a.bonds().length});var n=l*j.protoSphere.numVerts()+m*j.protoCyl.numVerts(),o=l*j.protoSphere.numIndices()+m*j.protoCyl.numIndices();g.addChainVertArray(k,n,o);var p=j.idPool.getContinuousRange(l);g.addIdRange(p),k.eachAtom(function(k){var l=j.protoSphere.numVerts()+k.bondCount()*j.protoCyl.numVerts(),m=g.vertArrayWithSpaceFor(l),n=m.numVerts(),o=p.nextId({geom:g,atom:k});j.color.colorFor(k,c,0),j.protoSphere.addTransformed(m,k.pos(),j.radius,c,o),k.eachBond(function(g){g.mid_point(a),vec3.sub(b,k.pos(),a);var h=vec3.length(b);vec3.scale(b,b,1/h),i(f,b,d,e,!1),vec3.add(a,a,k.pos()),vec3.scale(a,a,.5),j.protoCyl.addTransformed(m,a,h,j.radius,f,c,c,o,o)});var q=m.numVerts();h.addAssoc(k,m,n,q)})}}();c.ballsAndSticks=function(a,b,c){var d=new AtomVertexAssoc(a,!0),e=new ProtoSphere(c.sphereDetail,c.sphereDetail),f=new ProtoCylinder(c.arcDetail);c.protoSphere=e,c.protoCyl=f;var g=new MeshGeom(b,c.float32Allocator,c.uint16Allocator);return g.addVertAssoc(d),g.setShowRelated(c.showRelated),c.color.begin(a),a.eachChain(function(a){k(g,d,c,a)}),c.color.end(a),g};var l=function(){var a=vec3.create(),b=vec4.fromValues(0,0,0,1);return function(c,d,e,f){var g=0,h=e.atomCount(),i=f.idPool.getContinuousRange(h);c.addIdRange(i),e.eachAtom(function(a){var b=a.bonds().length;g+=b?b:3});var j=c.addChainVertArray(e,2*g);e.eachAtom(function(e){var g=j.numVerts(),h=i.nextId({geom:c,atom:e});if(e.bonds().length)e.eachBond(function(c){c.mid_point(a),f.color.colorFor(e,b,0),j.addLine(e.pos(),b,a,b,h,h)});else{var k=.2,l=e.pos();f.color.colorFor(e,b,0),j.addLine([l[0]-k,l[1],l[2]],b,[l[0]+k,l[1],l[2]],b,h,h),j.addLine([l[0],l[1]-k,l[2]],b,[l[0],l[1]+k,l[2]],b,h,h),j.addLine([l[0],l[1],l[2]-k],b,[l[0],l[1],l[2]+k],b,h,h)}var m=j.numVerts();d.addAssoc(e,j,g,m)})}}();c.lines=function(a,b,c){var d=new AtomVertexAssoc(a,!0);c.color.begin(a);var e=new LineGeom(b,c.float32Allocator);return e.setLineWidth(c.lineWidth),e.vertArray(),e.addVertAssoc(d),e.setShowRelated(c.showRelated),a.eachChain(function(a){l(e,d,a,c)}),c.color.end(a),e};var m=function(a){for(var b=0,c=0;c<a.length;++c)b+=2*(a[c].length()-1);return b},n=function(){var a=vec4.fromValues(0,0,0,1),b=vec4.fromValues(0,0,0,1),c=vec3.create(),d=vec3.create();return function(e,f,g,h,i,j){f.addAssoc(h,g,0,g.numVerts(),g.numVerts()+1);var k,l=j.float32Allocator.request(4*i.length()),m=j.idPool.getContinuousRange(i.length()),n=m.nextId({geom:e,atom:i.centralAtomAt(0)});e.addIdRange(m);for(var o=1;o<i.length();++o){j.color.colorFor(i.centralAtomAt(o-1),a,0),l[4*(o-1)+0]=a[0],l[4*(o-1)+1]=a[1],l[4*(o-1)+2]=a[2],l[4*(o-1)+3]=a[3],j.color.colorFor(i.centralAtomAt(o),b,0),i.posAt(c,o-1),i.posAt(d,o),k=m.nextId({geom:e,atom:i.centralAtomAt(o)}),g.addLine(c,a,d,b,n,k),n=k,k=null;var p=g.numVerts();f.addAssoc(h,g,o,p-1,p+(o===i.length()-1?0:1))}return l[4*i.length()-4]=b[0],l[4*i.length()-3]=b[1],l[4*i.length()-2]=b[2],l[4*i.length()-1]=b[3],f.setPerResidueColors(h,l),h+1}}(),o=function(a,b,c,d,e){for(var f=e.backboneTraces(),g=m(f),h=a.addChainVertArray(e,g),i=0;i<f.length;++i)d=n(a,b,h,d,f[i],c);return d};c.lineTrace=function(a,b,c){var d=new TraceVertexAssoc(a,1,!0);c.color.begin(a),a.chains();var e=new LineGeom(b,c.float32Allocator);e.setLineWidth(c.lineWidth);var f=0;return a.eachChain(function(a){f=o(e,d,c,f,a)}),e.addVertAssoc(d),e.setShowRelated(c.showRelated),c.color.end(a),e};var p=function(a,b){for(var c=0,d=0;d<a.length;++d)c+=2*(b*(a[d].length()-1)+1);return c},q=function(){var a=vec3.create(),b=vec3.create(),c=vec4.fromValues(0,0,0,1),d=vec4.fromValues(0,0,0,1);return function(e,f,g,h,i,j){var k,l=j.fullTraceIndex(0),m=h.float32Allocator.request(3*j.length()),n=h.float32Allocator.request(4*j.length()),o=[],p=h.idPool.getContinuousRange(j.length());for(e.addIdRange(p),k=0;k<j.length();++k){var q=j.centralAtomAt(k);j.smoothPosAt(a,k,h.strength),h.color.colorFor(q,n,4*k),m[3*k]=a[0],m[3*k+1]=a[1],m[3*k+2]=a[2],o.push(p.nextId({geom:e,atom:q}))}var r=o[0],s=0,t=geom.catmullRomSpline(m,j.length(),h.splineDetail,h.strength,!1,h.float32Allocator),u=interpolateColor(n,h.splineDetail),v=g.numVerts();f.addAssoc(i,g,l,v,v+1);var w=Math.floor(h.splineDetail/2),x=geom.catmullRomSplineNumPoints(j.length(),h.splineDetail,!1);for(k=1;x>k;++k){a[0]=t[3*(k-1)],a[1]=t[3*(k-1)+1],a[2]=t[3*(k-1)+2],b[0]=t[3*(k-0)],b[1]=t[3*(k-0)+1],b[2]=t[3*(k-0)+2],c[0]=u[4*(k-1)+0],c[1]=u[4*(k-1)+1],c[2]=u[4*(k-1)+2],c[3]=u[4*(k-1)+3],d[0]=u[4*(k-0)+0],d[1]=u[4*(k-0)+1],d[2]=u[4*(k-0)+2],d[3]=u[4*(k-0)+3];var y=Math.floor((k+w)/h.splineDetail);s=o[Math.min(o.length-1,y)],g.addLine(a,c,b,d,r,s),r=s;var z=g.numVerts();f.addAssoc(i,g,l+k,z-1,z+(k===j.length-1?0:1))}return f.setPerResidueColors(i,n),h.float32Allocator.release(m),h.float32Allocator.release(t),i+1}}(),r=function(a,b,c,d,e){for(var f=d.backboneTraces(),g=p(f,c.splineDetail),h=a.addChainVertArray(d,g),i=0;i<f.length;++i)e=q(a,b,h,c,e,f[i]);return e};c.sline=function(a,b,c){c.color.begin(a);var d=new TraceVertexAssoc(a,c.splineDetail,1,!0),e=new LineGeom(b,c.float32Allocator);e.setLineWidth(c.lineWidth),e.setShowRelated(c.showRelated);var f=0;return a.eachChain(function(a){f=r(e,d,c,a,f)}),e.addVertAssoc(d),c.color.end(a),e};var s=function(a,b,c){for(var d=0,e=0;e<a.length;++e)d+=a[e].length()*b,d+=(a[e].length()-1)*c;return d},t=function(a,b,c){for(var d=0,e=0;e<a.length;++e)d+=a[e].length()*b,d+=(a[e].length()-1)*c;return d},u=function(a,b,c,d,e){var f=e.backboneTraces(),g=s(f,c.protoSphere.numVerts(),c.protoCyl.numVerts()),h=t(f,c.protoSphere.numIndices(),c.protoCyl.numIndices());a.addChainVertArray(e,g,h);for(var i=0;i<f.length;++i)C(a,b,f[i],d,c),d++;return d};c.trace=function(a,b,c){c.protoCyl=new ProtoCylinder(c.arcDetail),c.protoSphere=new ProtoSphere(c.sphereDetail,c.sphereDetail);var d=new MeshGeom(b,c.float32Allocator,c.uint16Allocator),e=new TraceVertexAssoc(a,1,!0);d.addVertAssoc(e),d.setShowRelated(c.showRelated),c.color.begin(a);var f=0;return a.eachChain(function(a){f=u(d,e,c,f,a)}),c.color.end(a),d};var v=function(a,b,c){for(var d=0,e=0;e<a.length;++e)d+=((a[e].length()-1)*c+1)*b,d+=2;return d},w=function(a,b,c){for(var d=0,e=0;e<a.length;++e)d+=6*(a[e].length()*c-1)*b,d+=6*b;return d},x=function(){var a=mat3.create(),b=vec3.create(),c=vec3.create(),d=vec3.create(),e=vec3.create(),f=vec4.create();return function(g,h,j,k){for(var l=1.8*k.radius,m=0;m<j.length;++m)for(var n=j[m],o=k.idPool.getContinuousRange(n.length()),p=0;p<n.length();++p){var q=k.protoCyl.numVerts(),r=g.vertArrayWithSpaceFor(q),s=r.numVerts(),t=n.residueAt(p),u=t.name(),v=t.atom("C3'"),w=null;if(w="A"===u||"G"===u||"DA"===u||"DG"===u?t.atom("N1"):t.atom("N3"),null!==w&&null!==v){var x=o.nextId({geom:g,atom:w});vec3.add(e,v.pos(),w.pos()),vec3.scale(e,e,.5),k.color.colorFor(w,f,0),vec3.sub(d,w.pos(),v.pos());var y=vec3.length(d);vec3.scale(d,d,1/y),i(a,d,c,b,!1),k.protoCyl.addTransformed(r,e,y,l,a,f,f,x,x),k.protoSphere.addTransformed(r,w.pos(),l,f,x),k.protoSphere.addTransformed(r,v.pos(),l,f,x);var z=r.numVerts();h.addAssoc(w,r,s,z)}}}}(),y=function(a,b,c,d,e,f){for(var g=f.backboneTraces(),h=v(g,4*d.arcDetail,d.splineDetail),i=w(g,4*d.arcDetail,d.splineDetail),j=[],k=d.protoCyl.numVerts()+2*d.protoSphere.numVerts(),l=d.protoCyl.numIndices()+2*d.protoSphere.numIndices(),m=0;m<g.length;++m){var n=g[m];n.residueAt(0).isNucleotide()&&(j.push(n),h+=n.length()*k,i+=n.length()*l)}a.addChainVertArray(f,h,i);for(var o=0;o<g.length;++o)B(a,b,g[o],e,d),e++;return x(a,c,j,d),e};c.cartoon=function(a,b,c){c.arrowSkip=Math.floor(3*c.splineDetail/4),c.coilProfile=new TubeProfile(e,c.arcDetail,1),c.helixProfile=new TubeProfile(f,c.arcDetail,.1),c.strandProfile=new TubeProfile(f,c.arcDetail,.1),c.arrowProfile=new TubeProfile(g,c.arcDetail,.1),c.protoCyl=new ProtoCylinder(4*c.arcDetail),c.protoSphere=new ProtoSphere(4*c.arcDetail,4*c.arcDetail);var d=new MeshGeom(b,c.float32Allocator,c.uint16Allocator),h=new TraceVertexAssoc(a,c.splineDetail,!0);d.addVertAssoc(h),d.setShowRelated(c.showRelated),c.color.begin(a);var i=0,j=a.select({anames:["N1","N3"]}),k=new AtomVertexAssoc(j,!0);return d.addVertAssoc(k),a.eachChain(function(a){i=y(d,h,k,c,i,a)}),c.color.end(a),d},c.surface=function(){var a=vec3.create(),b=vec3.create(),c=vec4.fromValues(.8,.8,.8,1);return function(d,e,f){var g=0;d.getUint32(0),g+=4;var h=d.getUint32(g);g+=4;var i=24,j=i*h+g,k=d.getUint32(j),l=new MeshGeom(e,f.float32Allocator,f.uint16Allocator);l.setShowRelated("asym");var m,n=l.addVertArray(h,3*k);for(m=0;h>m;++m)vec3.set(a,d.getFloat32(g+0),d.getFloat32(g+4),d.getFloat32(g+8)),g+=12,vec3.set(b,d.getFloat32(g+0),d.getFloat32(g+4),d.getFloat32(g+8)),g+=12,n.addVertex(a,b,c,0);for(g=j+4,m=0;k>m;++m){var o=d.getUint32(g+0),p=d.getUint32(g+4),q=d.getUint32(g+8);g+=12,n.addTriangle(o-1,q-1,p-1)}return l}}();var z=function(){var a=mat3.create(),b=vec3.create();return function(c,d,e,f,g,h,j,k,l,m,n){var o=l.coilProfile;"C"===f||l.forceTube?k?geom.ortho(e,g):vec3.cross(e,b,g):"H"===f?o=l.helixProfile:"E"===f?o=l.strandProfile:"A"===f&&(o=l.arrowProfile),i(a,g,e,b,!0),o.addTransformed(c,d,j,a,h,k,m,n)}}(),A=function(){var a=vec3.create(),b=vec3.create(),c=vec3.create();return function(d,e,f,g,i,j,k,l){var m=null,n=null,o=e.length();vec3.set(c,0,0,0);for(var p=0;o>p;++p){j.push(k.nextId({geom:d,atom:e.centralAtomAt(p)})),e.smoothPosAt(a,p,l.strength),g[3*p]=a[0],g[3*p+1]=a[1],g[3*p+2]=a[2],e.smoothNormalAt(b,p,l.strength);var q=e.centralAtomAt(p);l.color.colorFor(q,f,4*p),vec3.dot(b,c)<0&&vec3.scale(b,b,-1),"E"!==e.residueAt(p).ss()||l.forceTube||(null===m&&(m=p),n=p),"C"===e.residueAt(p).ss()&&null!==m&&(h(g,m,n,o),h(i,m,n,o),m=null,n=null),i[3*p]=g[3*p]+b[0]+c[0],i[3*p+1]=g[3*p+1]+b[1]+c[1],i[3*p+2]=g[3*p+2]+b[2]+c[2],vec3.copy(c,b)}}}(),B=function(){var c=vec3.create(),d=vec3.create(),e=(vec3.create(),vec4.fromValues(0,0,0,1)),f=vec3.create(),g=vec3.create();return mat3.create(),function(h,i,j,k,l){var m=v([j],4*l.arcDetail,l.splineDetail),n=l.float32Allocator.request(3*j.length()),o=l.float32Allocator.request(4*j.length()),p=l.float32Allocator.request(3*j.length()),q=[],r=l.idPool.getContinuousRange(j.length());A(h,j,o,n,p,q,r,l),h.addIdRange(r);var s=h.vertArrayWithSpaceFor(m),t=geom.catmullRomSpline(n,j.length(),l.splineDetail,l.strength,!1,l.float32Allocator),u=geom.catmullRomSpline(p,j.length(),l.splineDetail,l.strength,!1,l.float32Allocator);i.setPerResidueColors(k,o);var w=l.radius*(j.residueAt(0).isAminoacid()?1:1.8),x=interpolateColor(o,l.splineDetail);vec3.set(c,t[3]-t[0],t[4]-t[1],t[5]-t[2]),vec3.set(d,t[0],t[1],t[2]),vec3.set(f,u[0]-t[0],u[1]-t[0],u[2]-t[2]),vec3.normalize(c,c),vec3.normalize(f,f),vec4.set(e,x[0],x[1],x[2],x[3]);var y=s.numVerts();s.addVertex(d,[-c[0],-c[1],-c[2]],e,q[0]),z(s,d,f,j.residueAt(0),c,e,w,!0,l,0,q[0]),a(s,y,4*l.arcDetail);var B=s.numVerts(),C=0;i.addAssoc(k,s,C,y,B),C+=1;for(var D=Math.floor(l.splineDetail/2),E=geom.catmullRomSplineNumPoints(j.length(),l.splineDetail,!1),F=1,G=E;G>F;++F){var H=3*F,I=4*F,J=3*(F+1),K=3*(F-1);vec3.set(d,t[H],t[H+1],t[H+2]),F===G-1?vec3.set(c,t[H]-t[K],t[H+1]-t[K+1],t[H+2]-t[K+2]):vec3.set(c,t[J]-t[K],t[J+1]-t[K+1],t[J+2]-t[K+2]),vec3.normalize(c,c),vec4.set(e,x[I],x[I+1],x[I+2],x[I+3]);var L=0,M=Math.floor(F/l.splineDetail),N=Math.floor((F-1)/l.splineDetail),O=Math.floor((F+l.arrowSkip)/l.splineDetail),P=!1,Q=j.residueAt(M).ss();if(!l.forceTube){if(M!==N){var R=j.residueAt(N).ss();if("C"===R&&("H"===Q||"E"===Q)){vec3.set(g,u[K]-t[K],u[K+1]-t[K+1],u[K+2]-t[K+2]),vec3.normalize(g,g);var S=2*Math.PI/(4*l.arcDetail),T=geom.signedAngle(f,g,c);L=Math.round(T/S),L=(L+4*l.arcDetail)%(4*l.arcDetail)}}if(O!==M&&O<j.length()){var U=j.residueAt(O).ss();"C"===U&&"E"===Q&&(P=!0)}}vec3.set(f,u[3*F]-t[H],u[H+1]-t[H+1],u[H+2]-t[H+2]),vec3.normalize(f,f),y=s.numVerts();var V=Math.floor((F+D)/l.splineDetail),W=q[Math.min(q.length-1,V)];z(s,d,f,Q,c,e,w,!1,l,L,W),P&&(i.addAssoc(k,s,C,y,B),z(s,d,f,"A",c,e,w,!1,l,0,W),F+=l.arrowSkip),B=s.numVerts(),F===G-1&&(B+=1),i.addAssoc(k,s,C,y,B),C+=1,P&&(C+=l.arrowSkip)}s.addVertex(d,c,e,q[q.length-1]),b(s,y,4*l.arcDetail),l.float32Allocator.release(p),l.float32Allocator.release(n)}}(),C=function(){var a=mat3.create(),b=vec3.create(),c=vec3.create(),d=vec3.create(),e=vec3.create(),f=vec3.create(),g=vec3.create(),h=vec4.fromValues(0,0,0,1),j=vec4.fromValues(0,0,0,1);return function(k,l,m,n,o){if(0!==m.length()){var p=o.idPool.getContinuousRange(m.length());k.addIdRange(p),o.color.colorFor(m.centralAtomAt(0),h,0);var q=s([m],o.protoSphere.numVerts(),o.protoCyl.numVerts()),r=q,t=k.vertArrayWithSpaceFor(q),u=t.maxVerts(),v=t.numVerts();m.posAt(f,0);var w=p.nextId({geom:k,atom:m.centralAtomAt(0)}),x=0;o.protoSphere.addTransformed(t,f,o.radius,h,w);var y=null;l.addAssoc(n,t,0,v,y);var z=o.float32Allocator.request(4*m.length());z[0]=h[0],z[1]=h[1],z[2]=h[2],z[3]=h[3];for(var A=o.protoCyl.numVerts()+o.protoSphere.numVerts(),B=1;B<m.length();++B){x=p.nextId({geom:k,atom:m.centralAtomAt(B)}),m.posAt(f,B-1),m.posAt(g,B),o.color.colorFor(m.centralAtomAt(B),j,0),z[4*B+0]=j[0],z[4*B+1]=j[1],z[4*B+2]=j[2],z[4*B+3]=j[3],vec3.sub(b,g,f);var C=vec3.length(b);vec3.scale(b,b,1/C),i(a,b,c,d,!1),vec3.copy(e,f),vec3.add(e,e,g),vec3.scale(e,e,.5),A>u-t.numVerts()&&(t=k.vertArrayWithSpaceFor(r)),r-=A;var D=t.numVerts();o.protoCyl.addTransformed(t,e,C,o.radius,a,h,j,w,x),y=t.numVerts(),y-=(y-D)/2,o.protoSphere.addTransformed(t,g,o.radius,j,x),w=x,l.addAssoc(n,t,B,v,y),v=y,vec3.copy(h,j)}l.setPerResidueColors(n,z),l.addAssoc(n,t,m.length()-1,v,t.numVerts())}}}();return c}();"undefined"!=typeof exports&&(module.exports=render),function(a){"use strict";function b(b,c){this._S=b;for(var d=0;d<this._S.length;++d)this._S[d]=a.forceRGB(this._S[d]);this._J=c}function c(a,b,c){this.colorFor=a,this._cM=b,this._cG=c}function d(a,b,c){var d=null,e=null;return a[b](function(a){var b=a.prop(c);return null===d&&null===e?(d=e=b,void 0):(d=Math.min(d,b),e=Math.max(e,b),void 0)}),{min:d,max:e}}function e(a,b,e,f,g){return b||(b=i("rainbow")),new c(function(c,d,e){var f=0;this._v!==this._z&&(f=(g(c).prop(a)-this._v)/(this._z-this._v)),j(d,e,b,f)},function(b){return void 0!==e?(this._v=e[0],this._z=e[1],void 0):(e=d(b,f,a),this._v=e.min,this._z=e.max,void 0)},function(){})}a.rgb={};var f=a.rgb;a.rgb.create=vec4.create,a.rgb.scale=vec4.scale,a.rgb.copy=vec4.copy,a.rgb.fromValues=vec4.fromValues,a.rgb.mix=function(a,b,c,d){var e=1-d;return a[0]=b[0]*d+c[0]*e,a[1]=b[1]*d+c[1]*e,a[2]=b[2]*d+c[2]*e,a[3]=b[3]*d+c[3]*e,a};var g={white:f.fromValues(1,1,1,1),black:f.fromValues(0,0,0,1),grey:f.fromValues(.5,.5,.5,1),lightgrey:f.fromValues(.8,.8,.8,1),darkgrey:f.fromValues(.3,.3,.3,1),red:f.fromValues(1,0,0,1),darkred:f.fromValues(.5,0,0,1),lightred:f.fromValues(1,.5,.5,1),green:f.fromValues(0,1,0,1),darkgreen:f.fromValues(0,.5,0,1),lightgreen:f.fromValues(.5,1,.5,1),blue:f.fromValues(0,0,1,1),darkblue:f.fromValues(0,0,.5,1),lightblue:f.fromValues(.5,.5,1,1),yellow:f.fromValues(1,1,0,1),darkyellow:f.fromValues(.5,.5,0,1),lightyellow:f.fromValues(1,1,.5,1),cyan:f.fromValues(0,1,1,1),darkcyan:f.fromValues(0,.5,.5,1),lightcyan:f.fromValues(.5,1,1,1),magenta:f.fromValues(1,0,1,1),darkmagenta:f.fromValues(.5,0,.5,1),lightmagenta:f.fromValues(1,.5,1,1),orange:f.fromValues(1,.5,0,1),darkorange:f.fromValues(.5,.25,0,1),lightorange:f.fromValues(1,.75,.5,1)};a.forceRGB=function(a){if("string"==typeof a){var b=g[a];if(void 0!==b)return b;if(a.length>0&&"#"===a[0]){var c,d,e,h;if(4===a.length||5===a.length){c=parseInt(a[1],16),d=parseInt(a[2],16),e=parseInt(a[3],16),h=15,5===a.length&&(h=parseInt(a[4],16));var i=1/15;return f.fromValues(i*c,i*d,i*e,i*h)}if(7===a.length||9===a.length){c=parseInt(a.substr(1,2),16),d=parseInt(a.substr(3,2),16),e=parseInt(a.substr(5,2),16),h=255,9===a.length&&(h=parseInt(a.substr(7,2),16));var j=1/255;return f.fromValues(j*c,j*d,j*e,j*h)}}}return 3===a.length?[a[0],a[1],a[2],1]:a},b.prototype={colorAt:function(a,b){if(b<=this._J[0])return vec4.copy(a,this._S[0]);if(b>=this._J[this._J.length-1])return vec4.copy(a,this._S[this._J.length-1]);for(var c=0,d=0;d<this._J.length&&!(this._J[d]>b);++d)c=d;var e=c+1,g=this._J[c],h=this._J[e],i=(b-g)/(h-g);return f.mix(a,this._S[e],this._S[c],i)}};var h={};a.gradient=function(a,c){if("string"==typeof a)return h[a];if(c=c||"equal","equal"===c){c=[];for(var d=0;d<a.length;++d)c.push(1*d/(a.length-1))}return new b(a,c)};var i=a.gradient;h.rainbow=i(["red","yellow","green","blue"]),h.reds=i(["lightred","darkred"]),h.greens=i(["lightgreen","darkgreen"]),h.blues=i(["lightblue","darkblue"]),h.trafficlight=i(["green","yellow","red"]),h.heatmap=i(["red","white","blue"]),c.prototype={begin:function(a){this._cM&&this._cM(a)},end:function(a){this._cG&&this._cG(a)}},a.color={},a.ColorOp=c,a.color.uniform=function(b){return b=a.forceRGB(b),new c(function(a,c,d){c[d+0]=b[0],c[d+1]=b[1],c[d+2]=b[2],c[d+3]=b[3]},null,null)},a.color.byElement=function(){return new c(function(a,b,c){var d=a.element();return"C"===d?(b[c]=.8,b[c+1]=.8,b[c+2]=.8,b[c+3]=1,b):"N"===d?(b[c]=0,b[c+1]=0,b[c+2]=1,b[c+3]=1,b):"O"===d?(b[c]=1,b[c+1]=0,b[c+2]=0,b[c+3]=1,b):"S"===d?(b[c]=.8,b[c+1]=.8,b[c+2]=0,b[c+3]=1,b):"CA"===d?(b[c]=.533,b[c+1]=.533,b[c+2]=.666,b[c+3]=1,b):(b[c]=1,b[c+1]=0,b[c+2]=1,b[c+3]=1,b)},null,null)},a.color.bySS=function(){return new c(function(a,b,c){switch(a.residue().ss()){case"C":return b[c]=.8,b[c+1]=.8,b[c+2]=.8,b[c+3]=1,void 0;case"H":return b[c]=.6,b[c+1]=.6,b[c+2]=.9,b[c+3]=1,void 0;case"E":return b[c]=.2,b[c+1]=.8,b[c+2]=.2,b[c+3]=1,void 0}},null,null)},a.color.rainbow=function(a){a||(a=i("rainbow"));var b=new c(function(b,c,d){var e=b.residue().index(),f=this.chainLimits[b.residue().chain().name()],g=0;void 0!==f&&(g=(e-f[0])/(f[1]-f[0]));var h=[1,1,1,1];a.colorAt(h,g),c[d]=h[0],c[d+1]=h[1],c[d+2]=h[2],c[d+3]=h[3]},function(a){var b=a.chains();this.chainLimits={};for(var c=0;c<b.length;++c){var d=b[c].backboneTraces();if(0!==d.length){for(var e=d[0].residueAt(0).index(),f=d[0].residueAt(d[0].length()-1).index(),g=1;g<d.length;++g){var h=d[g];e=Math.min(e,h.residueAt(0).index()),f=Math.max(f,h.residueAt(h.length()-1).index())}this.chainLimits[b[c].name()]=[e,f]}}},function(){this.chainLimits=null});return b},a.color.ssSuccession=function(a,b){a||(a=i("rainbow")),b||(b=forceRGB("lightgrey"));var d=new c(function(c,d,e){var f=c.residue().index(),g=this.chainLimits[c.residue().chain().name()],h=g.indices[f];if(-1===h)return d[e]=b[0],d[e+1]=b[1],d[e+2]=b[2],d[e+3]=b[3],void 0;var i=0;null===g.max,null!==g.max&&(i=h/(g.max>0?g.max:1));var j=[0,0,0,0];a.colorAt(j,i),d[e]=j[0],d[e+1]=j[1],d[e+2]=j[2],d[e+3]=j[3]},function(a){var b=a.chains();this.chainLimits={};for(var c=0;c<b.length;++c){for(var d=b[c].residues(),e=null,f={},g=0,h="C",i=0;i<d.length;++i){var j=d[i].ss();"C"===j?("C"!==h&&g++,f[d[i].index()]=-1):(e=g,f[d[i].index()]=g),h=j}this.chainLimits[b[c].name()]={indices:f,max:e}}},function(){this.chainLimits=null});return d},a.color.byChain=function(a){a||(a=i("rainbow"));var b=new c(function(b,c,d){b.residue().index();var e=this.chainIndices[b.residue().chain().name()],f=e*this.scale,g=[0,0,0,0];a.colorAt(g,f),c[d+0]=g[0],c[d+1]=g[1],c[d+2]=g[2],c[d+3]=g[3]},function(a){var b=a.chains();this.chainIndices={};for(var c=0;c<b.length;++c)this.chainIndices[b[c].name()]=c;this.scale=b.length>1?1/(b.length-1):1},function(){this.chainIndices=null});return b};var j=function(){var a=vec4.create();return function(b,c,d,e){d.colorAt(a,e),b[c+0]=a[0],b[c+1]=a[1],b[c+2]=a[2],b[c+3]=a[3]}}();return a.color.byAtomProp=function(a,b,c){return e(a,b,c,"eachAtom",function(a){return a
})},a.color.byResidueProp=function(a,b,c){return e(a,b,c,"eachResidue",function(a){return a.residue()})},a.interpolateColor=function(a,b){for(var c=new Float32Array(4*(b*(a.length/4-1)+1)),d=0,e=vec4.create(),f=vec4.create(),g=1/b,h=0;h<a.length/4-1;++h){vec4.set(e,a[4*h+0],a[4*h+1],a[4*h+2],a[4*h+3]),vec4.set(f,a[4*h+4],a[4*h+5],a[4*h+6],a[4*h+7]);for(var i=0;b>i;++i){var j=g*i;c[d+0]=e[0]*(1-j)+f[0]*j,c[d+1]=e[1]*(1-j)+f[1]*j,c[d+2]=e[2]*(1-j)+f[2]*j,c[d+3]=e[3]*(1-j)+f[3]*j,d+=4}}return c[d+0]=f[0],c[d+1]=f[1],c[d+2]=f[2],c[d+3]=f[3],c},!0}(this),function(a){"use strict";function b(a){this._bE=mat4.create(),this._G=mat4.create(),this._co=mat4.create(),this._f=mat4.create(),this._bh=mat4.create(),this._W=.1,this._Q=4e3,this._cB=-5,this._cC=50,this._bS=!0,this._cA=45*Math.PI/180,this._bH=!1,this._dk=vec3.fromValues(1,1,1),this._c3=vec3.fromValues(.1,.1,.1),this._L=vec3.create(),this._H=50,this._t=!0,this._=a,this._bV=null,this.setViewportSize(a.viewportWidth,a.viewportHeight)}b.prototype={setRotation:function(a){16===a.length?mat4.copy(this._f,a):(this._f[0]=a[0],this._f[1]=a[1],this._f[2]=a[2],this._f[3]=0,this._f[4]=a[3],this._f[5]=a[4],this._f[6]=a[5],this._f[7]=0,this._f[8]=a[6],this._f[9]=a[7],this._f[10]=a[8],this._f[11]=0,this._f[12]=0,this._f[13]=0,this._f[14]=0,this._f[15]=1),this._t=!0},mainAxes:function(){return[vec3.fromValues(this._f[0],this._f[4],this._f[8]),vec3.fromValues(this._f[1],this._f[5],this._f[9]),vec3.fromValues(this._f[2],this._f[6],this._f[10])]},fieldOfViewY:function(){return this._cA},aspectRatio:function(){return this._q/this._s},rotation:function(){return this._f},_cP:function(){return this._t?(mat4.identity(this._G),mat4.translate(this._G,this._G,[-this._L[0],-this._L[1],-this._L[2]]),mat4.mul(this._G,this._f,this._G),mat4.identity(this._bh),mat4.translate(this._bh,this._bh,[0,0,-this._H]),mat4.mul(this._G,this._bh,this._G),mat4.identity(this._bE),mat4.perspective(this._bE,this._cA,this._q/this._s,this._W,this._Q),this._t=!1,!0):!1},setViewportSize:function(a,b){this._t=!0,this._q=a,this._s=b},setCenter:function(a){this._t=!0,vec3.copy(this._L,a)},fog:function(a){return void 0!==a&&(this._bS=a,this._bH=!0),this._bS},rotateZ:function(){var a=mat4.create();return function(b){mat4.identity(a),this._t=!0,mat4.rotate(a,a,b,[0,0,1]),mat4.mul(this._f,a,this._f)}}(),rotateX:function(){var a=mat4.create();return function(b){mat4.identity(a),this._t=!0,mat4.rotate(a,a,b,[1,0,0]),mat4.mul(this._f,a,this._f)}}(),rotateY:function(){var a=mat4.create();return function(b){mat4.identity(a),this._t=!0,mat4.rotate(a,a,b,[0,1,0]),mat4.mul(this._f,a,this._f)}}(),panX:function(a){return this.panXY(a,0)},panY:function(a){return this.panXY(0,a)},panXY:function(){var a=mat4.create(),b=vec3.create();return function(c,d){mat4.transpose(a,this._f),this._t=!0,vec3.set(b,-c,d,0),vec3.transformMat4(b,b,a),vec3.add(b,b,this._L),this.setCenter(b)}}(),nearOffset:function(){return this._W},farOffset:function(){return this._Q},setNearFar:function(a,b){(a!==this._W||b!==this._Q)&&(this._W=a,this._Q=b,this._t=!0)},setFogNearFar:function(a,b){this._cB=a,this._cC=b,this._t=!0},setZoom:function(a){return this._t=!0,this._H=a,this._H},zoom:function(a){if(void 0===a)return this._H;this._t=!0;var b=1+.1*a;return this._H=Math.min(1e3,Math.max(2,b*this._H)),this._H},center:function(){return this._L},currentShader:function(){return this._bV},bind:function(a,b){var c=!1;if(this._bV!==a&&(this._bV=a,this._.useProgram(a),c=!0),c=this._cP()||c,b?(mat4.mul(this._co,this._G,b),this._.uniformMatrix4fv(a.modelview,!1,this._co)):this._.uniformMatrix4fv(a.modelview,!1,this._G),c||this._bH){this._bH=!1,this._.uniformMatrix4fv(a.projection,!1,this._bE),a.rotation&&this._.uniformMatrix4fv(a.rotation,!1,this._f),this._.uniform1i(a.fog,this._bS);var d=this._H;this._.uniform1f(a.fogFar,this._cC+d),this._.uniform1f(a.fogNear,this._cB+d),this._.uniform3fv(a.fogColor,this._dk),this._.uniform3fv(a.outlineColor,this._c3)}}},a.Cam=b}(this),function(a){"use strict";a.shaders={},a.shaders.LINES_FS="\nprecision ${PRECISION} float;\n\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\n\nvoid main(void) {\n  gl_FragColor = vec4(vertColor);\n  if (gl_FragColor.a == 0.0) { discard; }\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) {\n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",a.shaders.HEMILIGHT_FS="\nprecision ${PRECISION} float;\n\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\n\nvoid main(void) {\n  float dp = dot(vertNormal, vec3(0.0, 0.0, 1.0));\n  float hemi = max(0.0, dp)*0.5+0.5;\n  hemi *= vertColor.a;\n  gl_FragColor = vec4(vertColor.rgb*hemi, vertColor.a);\n  if (gl_FragColor.a == 0.0) { discard; }\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) {\n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",a.shaders.HEMILIGHT_VS="\nattribute vec3 attrPos;\nattribute vec4 attrColor;\nattribute vec3 attrNormal;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 n = (modelviewMat * vec4(attrNormal, 0.0));\n  vertNormal = n.xyz;\n  vertColor = attrColor;\n}",a.shaders.OUTLINE_FS="\nprecision ${PRECISION} float;\nvarying float vertAlpha;\n\nuniform vec3 outlineColor;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\n\nvoid main() {\n  gl_FragColor = vec4(outlineColor, vertAlpha);\n  if (gl_FragColor.a == 0.0) { discard; }\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) { \n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, vertAlpha),\n                        fog_factor);\n  }\n}",a.shaders.OUTLINE_VS="\nprecision ${PRECISION} float;\n\nattribute vec3 attrPos;\nattribute vec3 attrNormal;\nattribute vec4 attrColor;\n                                                                       \nuniform vec3 outlineColor;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying float vertAlpha;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 normal = modelviewMat * vec4(attrNormal, 0.0);\n  vertAlpha = attrColor.a;\n  gl_Position.xy += normal.xy*0.200;\n}",a.shaders.TEXT_VS="\nprecision ${PRECISION} float;\n\nattribute vec3 attrCenter;\nattribute vec2 attrCorner;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform mat4 rotationMat;\nvarying vec2 vertTex;\nvoid main() { \n  gl_Position = projectionMat* modelviewMat* vec4(attrCenter, 1.0);\n  gl_Position.xy += attrCorner*gl_Position.w; \n  gl_Position.z -= gl_Position.w*0.0005;\n  vertTex = (attrCorner+abs(attrCorner))/(2.0*abs(attrCorner)); \n}",a.shaders.TEXT_FS="\nprecision ${PRECISION} float;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform sampler2D sampler;\nuniform float xScale;\nuniform float yScale;\nvarying vec2 vertTex;\nvoid main() { \n  gl_FragColor = texture2D(sampler, vec2(vertTex.x*xScale, vertTex.y*yScale));\n}",a.shaders.SELECT_VS="\nprecision ${PRECISION} float;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nattribute vec3 attrPos;\nattribute float attrObjId;\n\nvarying float objId;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  objId = attrObjId;\n}",a.shaders.SELECT_FS="\nprecision ${PRECISION} float;\n\nvarying float objId;\nuniform int symId;\n\nint intMod(int x, int y) { \n  int z = x/y;\n  return x-y*z;\n}\nvoid main(void) {\n  // ints are only required to be 7bit...\n  int integralObjId = int(objId+0.5);\n  int red = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int green = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int blue = symId;\n  gl_FragColor = vec4(float(red), float(green), float(blue), 255.0)/255.0;\n}"}(this),function(a){"use strict";function b(a,b){this._q=b.width,this._s=b.height,this._cK=this._q,this._cL=this._s,this._=a,this._cJ=this._.createFramebuffer(),this._.bindFramebuffer(this._.FRAMEBUFFER,this._cJ),this._bd=this._.createRenderbuffer(),this._.bindRenderbuffer(this._.RENDERBUFFER,this._bd),this._.renderbufferStorage(this._.RENDERBUFFER,this._.DEPTH_COMPONENT16,this._q,this._s),this._.framebufferRenderbuffer(this._.FRAMEBUFFER,this._.DEPTH_ATTACHMENT,this._.RENDERBUFFER,this._bd),this._bx=this._.createTexture(),this._dj()}b.prototype={width:function(){return this._q},height:function(){return this._s},bind:function(){this._.bindFramebuffer(this._.FRAMEBUFFER,this._cJ),this._.bindRenderbuffer(this._.RENDERBUFFER,this._bd),(this._cK!==this._q||this._cL!==this._s)&&this._cW(),this._.viewport(0,0,this._q,this._s)},_dj:function(){this.bind();var a=this._;a.bindTexture(a.TEXTURE_2D,this._bx),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this._q,this._s,0,a.RGBA,a.UNSIGNED_BYTE,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._bx,0),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_2D,null),this.release()},_cW:function(){this._.bindRenderbuffer(this._.RENDERBUFFER,this._bd),this._.renderbufferStorage(this._.RENDERBUFFER,this._.DEPTH_COMPONENT16,this._q,this._s),this._.bindTexture(this._.TEXTURE_2D,this._bx),this._.texImage2D(this._.TEXTURE_2D,0,this._.RGBA,this._q,this._s,0,this._.RGBA,this._.UNSIGNED_BYTE,null),this._.framebufferTexture2D(this._.FRAMEBUFFER,this._.COLOR_ATTACHMENT0,this._.TEXTURE_2D,this._bx,0),this._.framebufferRenderbuffer(this._.FRAMEBUFFER,this._.DEPTH_ATTACHMENT,this._.RENDERBUFFER,this._bd),this._.bindTexture(this._.TEXTURE_2D,null),this._cK=this._q,this._cL=this._s},resize:function(a,b){this._q=a,this._s=b},release:function(){this._.bindFramebuffer(this._.FRAMEBUFFER,null),this._.bindRenderbuffer(this._.RENDERBUFFER,null)}},a.FrameBuffer=b}(this),function(a){"use strict";function b(a,b){this.near=a,this.far=b}function c(a){a=a||{},this._W=a.near||.1,this._Q=a.far||400}function d(){this._Q=100}c.prototype.update=function(){return new b(this._W,this._Q)},d.prototype.update=function(a,c){for(var d=c.center(),e=null,f=0;f<a.length;++f){var g=a[f];g.visible()&&(e=g.updateSquaredSphereRadius(d,e))}if(null===e)return null;e=Math.sqrt(e);var h=c.zoom(),i=1.05*(e+h),j=.1;return new b(j,i)},a.FixedSlab=c,a.AutoSlab=d,a.Slab=b}(this),function(a){"use strict";function b(a,b,c){this._bt=a,this._bz=b,this._3=c,this._dI=c,this._8=Date.now(),this._cp=!1,this._cE=!1}function c(a,c,d){b.call(this,vec3.clone(a),vec3.clone(c),d),this._D=vec3.clone(a)}function d(a,c,d){var e=mat3.create(),f=mat3.create();mat3.fromMat4(e,a),mat3.fromMat4(f,c);var g=quat.create(),h=quat.create();quat.fromMat3(g,e),quat.fromMat3(h,f),this._D=mat3.create(),b.call(this,g,h,d)}function e(a,c,d){var e=mat3.create();mat3.fromMat4(e,a),b.call(this,e,null,d),this._dw=vec3.clone(c),this.setLooping(!0),this._D=mat3.create()}return b.prototype={setLooping:function(a){this._cp=a},step:function(){var a,b=Date.now(),c=b-this._8;if(0===this._3)a=1;else if(this._cp){var d=Math.floor(c/this._3);a=(c-d*this._3)/this._3}else c=Math.min(this._3,c),a=c/this._3,this._cE=1===a;return this._bj(a)},_bj:function(a){var b=(1-Math.cos(a*Math.PI))/2;return this._D=this._bt*(1-b)+this._bz*b,this._D},finished:function(){return this._cE}},derive(c,b,{_bj:function(a){var b=(1-Math.cos(a*Math.PI))/2;return vec3.lerp(this._D,this._bt,this._bz,b),this._D}}),derive(d,b,{_bj:function(){var a=quat.create();return function(b){return quat.slerp(a,this._bt,this._bz,b),mat3.fromQuat(this._D,a),this._D}}()}),derive(e,b,{_bj:function(){var a=mat3.create();return function(b){var c=.2*Math.sin(2*b*Math.PI);return geom.axisRotation(a,this._dw,c),mat3.mul(this._D,this._bt,a),this._D}}()}),a.Move=c,a.Rotate=d,a.RockAndRoll=e,a.Animation=b,!0}(this),function(a){"use strict";function b(a,b,c){this._2=a,this._2.addEventListener("touchmove",bind(this,this._cS)),this._2.addEventListener("touchstart",bind(this,this._cR)),this._2.addEventListener("touchend",bind(this,this._b9)),this._2.addEventListener("touchcancel",bind(this,this._b9)),this._U={scale:1,rotation:0,center:null},this._br=null,this._b4=b,this._e=c}function c(a){for(var b=0,c=0,d=0;d<a.length;++d)b+=a[d].clientX,c+=a[d].clientY;return b/=a.length,c/=a.length,{x:b,y:c}}function d(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)}function e(a,b){var c=d(a[0],a[1]),e=d(b[0],b[1]);return e/(0===c?1:c)}function f(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.atan2(d,c)}function g(a,b){return f(b[1],b[0])-f(a[1],a[0])}b.prototype={_cF:function(a,b){var d={};d.center=c(b.targetTouches),d.pointers=[];for(var f=0;f<b.targetTouches.length;++f){var h=b.targetTouches[f];d.pointers.push({x:h.clientX,y:h.clientY})}return d.numTouches=b.targetTouches.length,d.rotation=0,d.scale=1,d.deltaScale=0,d.deltaRotation=0,a.center&&(d.deltaCenter={x:d.center.x-a.center.x,y:d.center.y-a.center.y}),2!==a.numTouches||2!==d.numTouches?d:(d.initialPointers=a.initialPointers?a.initialPointers:a.pointers,d.scale=e(d.initialPointers,d.pointers),d.deltaScale=d.scale-a.scale,d.rotation=g(d.initialPointers,d.pointers),d.deltaRotation=d.rotation-a.rotation,d)},_cS:function(a){a.preventDefault();var b=this._cF(this._U,a),c=4*-b.deltaScale;0!==c&&this._e.zoom(c),2===b.numTouches&&2===this._U.numTouches&&this._e.panXY(.001*b.deltaCenter.x*this._e.zoom(),.001*b.deltaCenter.y*this._e.zoom());var d=-b.deltaRotation;this._e.rotateZ(d),1===b.numTouches&&1===this._U.numTouches&&(this._e.rotateX(.005*b.deltaCenter.y),this._e.rotateY(.005*b.deltaCenter.x)),this._b4.requestRedraw(),this._U=b},_cR:function(a){if(a.preventDefault(),1===a.targetTouches.length){var b=(new Date).getTime();if(null!==this._br){var c=b-this._br;500>c&&this._b4._cm({clientX:a.targetTouches[0].clientX,clientY:a.targetTouches[0].clientY})}this._br=b}else this._br=null;this._U=this._cF(this._U,a)},_b9:function(a){a.preventDefault()}},a.TouchHandler=b}(this);var pv=function(){"use strict";function a(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}function b(a,b){return a=a||"auto","fixed"===a?new FixedSlab(b):"auto"===a?new AutoSlab(b):null}function c(a,b,c){this._c4=a,this._cU=b,this._cQ=c}function d(a,c){c=c||{},this._b={width:c.width||500,height:c.height||500,animateTime:c.animateTime||0,antialias:c.antialias,quality:c.quality||"low",style:c.style||"hemilight",background:c.background?forceRGB(c.background):vec3.fromValues(1,1,1),slabMode:b(c.slabMode),atomClick:c.atomClick||null,fog:!0,atomDoubleClick:"center"},this._l=[],this._R=a,this._bD=!1,this._bC=!1,this._dJ=null,this.listenerMap={},this._i=document.createElement("canvas"),this._bi=document.createElement("canvas"),this._bi.style.display="none",this._ck=new UniqueObjectIdPool;var d=a.getBoundingClientRect();"auto"===this._b.width&&(this._b.width=d.width),"auto"===this._b.height&&(this._b.height=d.height),this._b.outline="outline"in c?c.outline:!0,"atomDoubleClicked"in c&&(this._b.atomDoubleClick=c.atomDoubleClick),"fog"in c&&(this._b.fog=c.fog),this._cj=!1,this._n={center:null,zoom:null,rotation:null},this.quality(this._b.quality),this._i.width=this._b.width,this._i.height=this._b.height,this._R.appendChild(this._i),this._R.appendChild(this._bi),"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?this._cv():document.addEventListener("DOMContentLoaded",bind(this,this._cv)),null!==this._b.atomDoubleClick&&this.addListener("atomDoubleClicked",this._b.atomDoubleClick),null!==this._b.atomClick&&this.addListener("atomClicked",this._b.atomClick)}var e='<div style="vertical-align:middle; text-align:center;"><h1>Oink</h1><p>Your browser does not support WebGL. You might want to try Chrome, Firefox, IE 11, or newer versions of Safari</p><p>If you are using a recent version of one of the above browsers, your graphic card might be blocked. Check the browser documentation for details</p></div>',f=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();return c.prototype={object:function(){return this._c4},symIndex:function(){return this._cU},transform:function(){return this._cQ}},d.prototype={_ds:function(a){if(null!==a){var b=vec3.create(),c=a.object().atom,d=c.pos();a.transform()?(vec3.transformMat4(b,d,a.transform()),this.setCenter(b,this._b.animateTime)):this.setCenter(d,this._b.animateTime)}},_dl:function(){this._bC&&(this._bC=!1,this._b.realWidth=this._b.width*this._b.samples,this._b.realHeight=this._b.height*this._b.samples,this._.viewport(0,0,this._b.realWidth,this._b._dG),this._i.width=this._b.realWidth,this._i.height=this._b.realHeight,this._e.setViewportSize(this._b.realWidth,this._b.realHeight),this._b.samples>1&&this._cw(this._b.samples),this._bF.resize(this._b.width,this._b.height))},resize:function(a,b){(a!==this._b.width||b!==this._b.height)&&(this._bC=!0,this._b.width=a,this._b.height=b,this.requestRedraw())},fitParent:function(){var a=this._R.getBoundingClientRect();this.resize(a.width,a.height)},gl:function(){return this._},ok:function(){return this._cj},options:function(a,b){return void 0!==b?("fog"===a?(this._e.fog(b),this._b.fog=b,this.requestRedraw()):this._b[a]=b,b):this._b[a]},quality:function(a){return this._b.quality=a,"high"===a?(this._b.arcDetail=4,this._b.sphereDetail=16,this._b.splineDetail=8,void 0):"medium"===a?(this._b.arcDetail=3,this._b.sphereDetail=10,this._b.splineDetail=4,void 0):"low"===a?(this._b.arcDetail=2,this._b.sphereDetail=8,this._b.splineDetail=2,void 0):void 0},imageData:function(){return this._i.toDataURL()},_di:function(){try{var a={antialias:this._b.antialias,preserveDrawingBuffer:!0};this._=this._i.getContext("experimental-webgl",a)}catch(b){return!1}return this._?!0:!1},_cw:function(a){var b=1/a,c=.5*-(1-b)*this._b.realWidth,d=.5*-(1-b)*this._b.realHeight,e="translate("+c+"px, "+d+"px)",f="scale("+b+", "+b+")",g=e+" "+f;this._i.style.webkitTransform=g,this._i.style.transform=g,this._i.style.ieTransform=g,this._i.width=this._b.realWidth,this._i.height=this._b.realHeight},_dg:function(){var a={width:this._b.width,height:this._b.height};this._bF=new FrameBuffer(this._,a)},_dh:function(){var a=1;return this._di()?(!this._.getContextAttributes().antialias&&this._b.antialias&&(a=2),this._b.realWidth=this._b.width*a,this._b.realHeight=this._b.height*a,this._b.samples=a,a>1&&this._cw(a),this._.viewportWidth=this._b.realWidth,this._.viewportHeight=this._b.realHeight,this._.clearColor(this._b.background[0],this._b.background[1],this._b.background[2],1),this._.lineWidth(2),this._.cullFace(this._.FRONT),this._.enable(this._.CULL_FACE),this._.enable(this._.DEPTH_TEST),this._dg(),!0):!1},_cd:function(b,c){var d;if("fragment"===c)d=this._.createShader(this._.FRAGMENT_SHADER);else{if("vertex"!==c)return null;d=this._.createShader(this._.VERTEX_SHADER)}var e=a()?"highp":"mediump",f=b.replace("${PRECISION}",e);return this._.shaderSource(d,f),this._.compileShader(d),this._.getShaderParameter(d,this._.COMPILE_STATUS)?d:null},_ba:function(a,b){var c=this._cd(b,"fragment"),d=this._cd(a,"vertex"),e=this._.createProgram();if(this._.attachShader(e,d),this._.attachShader(e,c),this._.linkProgram(e),!this._.getProgramParameter(e,this._.LINK_STATUS))return null;this._.clearColor(this._b.background[0],this._b.background[1],this._b.background[2],1),this._.enable(this._.BLEND),this._.blendFunc(this._.SRC_ALPHA,this._.ONE_MINUS_SRC_ALPHA),this._.enable(this._.CULL_FACE),this._.enable(this._.DEPTH_TEST);var f=bind(this._,this._.getAttribLocation),g=bind(this._,this._.getUniformLocation);return e.posAttrib=f(e,"attrPos"),e.colorAttrib=f(e,"attrColor"),e.normalAttrib=f(e,"attrNormal"),e.objIdAttrib=f(e,"attrObjId"),e.symId=g(e,"symId"),e.projection=g(e,"projectionMat"),e.modelview=g(e,"modelviewMat"),e.rotation=g(e,"rotationMat"),e.fog=g(e,"fog"),e.fogFar=g(e,"fogFar"),e.fogNear=g(e,"fogNear"),e.fogColor=g(e,"fogColor"),e.outlineColor=g(e,"outlineColor"),e},_c8:function(){this._i.removeEventListener("mousemove",this._bp,!1),this._i.removeEventListener("mousemove",this._bq,!1),this._i.removeEventListener("mouseup",this._bo,!1),document.removeEventListener("mouseup",this._bo,!1),document.removeEventListener("mousemove",this._bp),document.removeEventListener("mousemove",this._bq)},_cv:function(){return this._dh()?(this._cj=!0,this._dB=this._bi.getContext("2d"),this._E=new PoolAllocator(Float32Array),this._I=new PoolAllocator(Uint16Array),this._e=new Cam(this._),this._e.fog(this._b.fog),this._cV={hemilight:this._ba(shaders.HEMILIGHT_VS,shaders.HEMILIGHT_FS),outline:this._ba(shaders.OUTLINE_VS,shaders.OUTLINE_FS),lines:this._ba(shaders.HEMILIGHT_VS,shaders.LINES_FS),text:this._ba(shaders.TEXT_VS,shaders.TEXT_FS),select:this._ba(shaders.SELECT_VS,shaders.SELECT_FS)},this._dv=bind(this,this._dp),this._bq=bind(this,this._da),this._bp=bind(this,this._c9),this._bo=bind(this,this._c8),"onwheel"in this._i?this._i.addEventListener("wheel",bind(this,this._c6),!1):this._i.addEventListener("mousewheel",bind(this,this._c7),!1),this._i.addEventListener("dblclick",bind(this,this._cm),!1),this._i.addEventListener("mousedown",bind(this,this._db),!1),this._dE=new TouchHandler(this._i,this,this._e),!0):(this._R.removeChild(this._i),this._R.innerHTML=e,this._R.style.width=this._b.width+"px",this._R.style.height=this._b.height+"px",!1)},requestRedraw:function(){this._bD||(this._bD=!0,f(this._dv))},_bT:function(a){for(var b=0,c=this._l.length;b!==c;++b)this._l[b].draw(this._e,this._cV,this._b.style,a)},setCamera:function(a,b,c,d){return d|=0,0===d?(this._e.setCenter(b),this._e.setRotation(a),this._e.setZoom(c),this.requestRedraw(),void 0):(this._n.center=new Move(this._e.center(),vec3.clone(b),d),this._n.rotation=new Rotate(this._e.rotation(),mat4.clone(a),d),this._n.zoom=new Animation(this._e.zoom(),c,d),this.requestRedraw(),void 0)},_dx:function(){var a=!1;this._n.center&&(this._e.setCenter(this._n.center.step()),this._n.center.finished()&&(this._n.center=null),a=!0),this._n.rotation&&(this._e.setRotation(this._n.rotation.step()),this._n.rotation.finished()&&(this._n.rotation=null),a=!0),this._n.zoom&&(this._e.setZoom(this._n.zoom.step()),this._n.zoom.finished()&&(this._n.zoom=null),a=!0),a&&this.requestRedraw()},_dp:function(){this._bD=!1,this._dl(),this._dx();var a=this._b.slabMode.update(this._l,this._e);null!==a&&this._e.setNearFar(a.near,a.far),this._.clear(this._.COLOR_BUFFER_BIT|this._.DEPTH_BUFFER_BIT),this._.viewport(0,0,this._b.realWidth,this._b.realHeight),this._.cullFace(this._.FRONT),this._.enable(this._.CULL_FACE),this._.enable(this._.BLEND),this._bT("normal"),this._b.outline&&(this._.cullFace(this._.BACK),this._.enable(this._.CULL_FACE),this._bT("outline"))},setCenter:function(a,b){return b|=0,0===b?(this._e.setCenter(a),void 0):(this._n.center=new Move(this._e.center(),vec3.clone(a),b),this.requestRedraw(),void 0)},centerOn:function(a,b){this.setCenter(a.center(),b)},clear:function(){for(var a=0;a<this._l.length;++a)this._l[a].destroy();this._l=[]},_c7:function(a){this._e.zoom(a.wheelDelta<0?-1:1),a.preventDefault(),this.requestRedraw()},_c6:function(a){this._e.zoom(a.deltaY<0?1:-1),a.preventDefault(),this.requestRedraw()},_cm:function(){return function(a){var b=this._i.getBoundingClientRect(),c=this.pick({x:a.clientX-b.left,y:a.clientY-b.top});this._cH(a,"atomDoubleClicked",c),this.requestRedraw()}}(),addListener:function(a,b){var c=this.listenerMap[a];"undefined"==typeof c&&(c=[],this.listenerMap[a]=c),"center"===b?c.push(bind(this,this._ds)):c.push(b)},_cH:function(a,b,c){var d=this.listenerMap[b];d&&d.forEach(function(b){b(c,a)})},_db:function(a){if(0===a.button){var b=(new Date).getTime();if("undefined"==typeof this.lastClickTime||b-this.lastClickTime>300){this.lastClickTime=b;var c=this._i.getBoundingClientRect(),d=this.pick({x:a.clientX-c.left,y:a.clientY-c.top});this._cH(a,"atomClicked",d)}a.preventDefault(),a.shiftKey===!0?(this._i.addEventListener("mousemove",this._bq,!1),document.addEventListener("mousemove",this._bq,!1)):(this._i.addEventListener("mousemove",this._bp,!1),document.addEventListener("mousemove",this._bp,!1)),this._i.addEventListener("mouseup",this._bo,!1),document.addEventListener("mouseup",this._bo,!1),this._0={x:a.pageX,y:a.pageY}}},_c9:function(a){var b={x:a.pageX,y:a.pageY},c={x:b.x-this._0.x,y:b.y-this._0.y},d=.005;this._e.rotateX(d*c.y),this._e.rotateY(d*c.x),this._0=b,this.requestRedraw()},_da:function(a){var b={x:a.pageX,y:a.pageY},c={x:b.x-this._0.x,y:b.y-this._0.y},d=.05;this._e.panXY(d*c.x,d*c.y),this._0=b,this.requestRedraw()},RENDER_MODES:["sline","line","trace","lineTrace","cartoon","tube","spheres"],renderAs:function(a,b,c,d){for(var e=!1,f=0;f<this.RENDER_MODES.length;++f)if(this.RENDER_MODES[f]===c){e=!0;break}return e?this[c](a,b,d):void 0},_K:function(a){return a=copy(a),a.float32Allocator=this._E,a.uint16Allocator=this._I,a.idPool=this._ck,a.showRelated=a.showRelated||"asym",a},lineTrace:function(a,b,c){var d=this._K(c);d.color=d.color||color.uniform([1,0,1]),d.lineWidth=d.lineWidth||4;var e=render.lineTrace(b,this._,d);return this.add(a,e)},spheres:function(a,b,c){var d=this._K(c);d.color=d.color||color.byElement(),d.sphereDetail=this.options("sphereDetail"),d.radiusMultiplier=d.radiusMultiplier||1;var e=render.spheres(b,this._,d);return this.add(a,e)},sline:function(a,b,c){var d=this._K(c);d.color=d.color||color.uniform([1,0,1]),d.splineDetail=d.splineDetail||this.options("splineDetail"),d.strength=d.strength||1,d.lineWidth=d.lineWidth||4;var e=render.sline(b,this._,d);return this.add(a,e)},boundingSpheres:function(a,b,c){var d=b.vertArrays(),e=new MeshGeom(a,c.float32Allocator,c.uint16Allocator);e.order(100);var f=new ProtoSphere(16,16),g=f.numVerts(),h=f.numIndices(),i=new AtomVertexAssoc(b.structure());e.setVertAssoc(i),e.addChainVertArray({name:function(){return"a"}},d.length*g,h*d.length),e.setShowRelated("asym");for(var j=[.5,.5,.5,.2],k=e.vertArrayWithSpaceFor(g*d.length),l=0;l<d.length;++l){var m=d[l].boundingSphere();f.addTransformed(k,m.center(),m.radius(),j,0)}return e},cartoon:function(a,b,c){var d=this._K(c);d.color=d.color||color.bySS(),d.strength=d.strength||1,d.splineDetail=d.splineDetail||this.options("splineDetail"),d.arcDetail=d.arcDetail||this.options("arcDetail"),d.radius=d.radius||.3,d.forceTube=d.forceTube||!1;var e=render.cartoon(b,this._,d),f=this.add(a,e);if(d.boundingSpheres){var g=this.boundingSpheres(this._,e,d);this.add(a+".bounds",g)}return f},surface:function(a,b,c){var d=this._K(c),e=render.surface(b,this._,d);return this.add(a,e)},tube:function(a,b,c){return c=c||{},c.forceTube=!0,this.cartoon(a,b,c)},ballsAndSticks:function(a,b,c){var d=this._K(c);d.color=d.color||color.byElement(),d.radius=d.radius||.3,d.arcDetail=2*(d.arcDetail||this.options("arcDetail")),d.sphereDetail=d.sphereDetail||this.options("sphereDetail");var e=render.ballsAndSticks(b,this._,d);return this.add(a,e)},lines:function(a,b,c){var d=this._K(c);d.color=d.color||color.byElement(),d.lineWidth=d.lineWidth||4;var e=render.lines(b,this._,d);return this.add(a,e)},trace:function(a,b,c){var d=this._K(c);d.color=d.color||color.uniform([1,0,0]),d.radius=d.radius||.3,d.arcDetail=2*(d.arcDetail||this.options("arcDetail")),d.sphereDetail=d.sphereDetail||this.options("sphereDetail");var e=render.trace(b,this._,d);
return this.add(a,e)},fitTo:function(a,b){var c=this._e.mainAxes();b=b||this._b.slabMode;var d=[new Range,new Range,new Range];if(a instanceof SceneNode)a.updateProjectionIntervals(c[0],c[1],c[2],d[0],d[1],d[2]);else if(void 0!==a.eachAtom){a.eachAtom(function(a){for(var b=a.pos(),e=0;3>e;++e)d[e].update(vec3.dot(b,c[e]))});for(var e=0;3>e;++e)d[e].extend(1.5)}this._cD(c,d,b)},_cD:function(a,b){if(!(b[0].empty()||b[1].empty()||b[2].empty())){var c=b[0].center(),d=b[1].center(),e=b[2].center(),f=[c*a[0][0]+d*a[1][0]+e*a[2][0],c*a[0][1]+d*a[1][1]+e*a[2][1],c*a[0][2]+d*a[1][2]+e*a[2][2]],g=this._e.fieldOfViewY(),h=this._e.aspectRatio(),i=b[0].length()/h,j=b[1].length(),k=.5*Math.max(i,j),l=k/Math.tan(.5*g),m=l+.5*b[2].length(),n=.5,o=Math.max(l-n,.1),p=2*n+l+b[2].length();this._e.setNearFar(o,p),this.setCamera(this._e.rotation(),f,m,this._b.animateTime),this.requestRedraw()}},autoZoom:function(){var a=this._e.mainAxes(),b=[new Range,new Range,new Range];this.forEach(function(c){c.visible()&&c.updateProjectionIntervals(a[0],a[1],a[2],b[0],b[1],b[2])}),this._cD(a,b)},slabInterval:function(){},autoSlab:function(){var a=this._b._dF.update(this._l,this._e);null!==a&&this._e.setNearFar(a.near,a.far),this.requestRedraw()},rockAndRoll:function(a){return a===!0?(this._n.rotation=new RockAndRoll(this._e.rotation(),[0,1,0],2e3),this.requestRedraw()):a===!1&&(this._n.rotation=null,this.requestRedraw()),null!==this._n.rotation},slabMode:function(a,c){c=c||{};var d=b(a,c),e=d.update(this._l,this._e);null!==e&&this._e.setNearFar(e.near,e.far),this._b.slabMode=d,this.requestRedraw()},label:function(a,b,c){var d=new TextLabel(this._,this._bi,this._dB,c,b);return this.add(a,d),d},_do:function(){this._.clearColor(0,0,0,0),this._.disable(this._.BLEND),this._.clear(this._.COLOR_BUFFER_BIT|this._.DEPTH_BUFFER_BIT),this._.clearColor(this._b.background[0],this._b.background[1],this._b.background[2],1),this._.cullFace(this._.FRONT),this._.enable(this._.CULL_FACE),this._bT("select")},pick:function(a){this._bF.bind(),this._do();var b=new Uint8Array(4);if(this._.readPixels(a.x,this._b.height-a.y,1,1,this._.RGBA,this._.UNSIGNED_BYTE,b),this._bF.release(),b.data&&(b=b.data),0===b[3])return null;var d=b[0]|b[1]<<8,e=b[2],f=this._ck.objectForId(d);if(void 0===f)return null;var g=null;return 255!==e&&(g=f.geom.symWithIndex(e)),new c(f,255>e?e:null,g)},add:function(a,b){return b.name(a),this._l.push(b),this._l.sort(function(a,b){return a.order()-b.order()}),this.requestRedraw(),b},_cy:function(a){var b=a.replace(".","\\.").replace("*",".*");return new RegExp("^"+b+"$")},forEach:function(){var a,b="*";2===arguments.length?(a=arguments[1],b=arguments[0]):a=arguments[0];for(var c=this._cy(b),d=0;d<this._l.length;++d){var e=this._l[d];c.test(e.name())&&a(e,d)}},get:function(a){for(var b=0;b<this._l.length;++b)if(this._l[b].name()===a)return this._l[b];return null},hide:function(a){this.forEach(a,function(a){a.hide()})},show:function(a){this.forEach(a,function(a){a.show()})},rm:function(a){for(var b=[],c=this._cy(a),d=0;d<this._l.length;++d){var e=this._l[d];c.test(e.name())?e.destroy():b.push(e)}this._l=b},all:function(){return this._l}},{Viewer:function(a,b){return new d(a,b)}}}();"undefined"!=typeof exports&&(module.exports=pv);